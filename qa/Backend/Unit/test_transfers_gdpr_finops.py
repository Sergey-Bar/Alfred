importuuidimportpytestfromfastapi.testclientimportTestClientclassTestTransferAuth:"""Verifyeverytransferendpointrejectsunauthenticatedrequests."""deftest_create_transfer_no_auth(self,test_client:TestClient):response=test_client.post("/v1/transfers",json={"source_wallet_id":str(uuid.uuid4()),"destination_wallet_id":str(uuid.uuid4()),"amount":"100.00","reason":"Budgetreallocation",},)assertresponse.status_code==401deftest_list_transfers_no_auth(self,test_client:TestClient):response=test_client.get("/v1/transfers")assertresponse.status_code==401deftest_get_transfer_no_auth(self,test_client:TestClient):fake_id=str(uuid.uuid4())response=test_client.get(f"/v1/transfers/{fake_id}")assertresponse.status_code==401deftest_review_transfer_no_auth(self,test_client:TestClient):fake_id=str(uuid.uuid4())response=test_client.post(f"/v1/transfers/{fake_id}/review",json={"action":"approve"},)assertresponse.status_code==401deftest_cancel_transfer_no_auth(self,test_client:TestClient):fake_id=str(uuid.uuid4())response=test_client.post(f"/v1/transfers/{fake_id}/cancel")assertresponse.status_code==401classTestTransferCRUD:"""Testtransfercreateandlistflows."""def_create_wallets(self,test_client,admin_api_key):"""Createsourceanddestinationwalletsfortransfers."""src=test_client.post("/v1/wallets",json={"name":"SourceWallet","hard_limit":"10000.00"},headers=admin_api_key,)dst=test_client.post("/v1/wallets",json={"name":"DestinationWallet","hard_limit":"10000.00"},headers=admin_api_key,)returnsrc.json()["id"],dst.json()["id"]deftest_create_transfer(self,test_client:TestClient,admin_api_key):src_id,dst_id=self._create_wallets(test_client,admin_api_key)response=test_client.post("/v1/transfers",json={"source_wallet_id":src_id,"destination_wallet_id":dst_id,"amount":"500.00","reason":"Projectreallocation",},headers=admin_api_key,)assertresponse.status_code==201data=response.json()assertdata["source_wallet_id"]==src_idassertdata["destination_wallet_id"]==dst_idassert"id"indatadeftest_list_transfers(self,test_client:TestClient,admin_api_key):response=test_client.get("/v1/transfers",headers=admin_api_key)assertresponse.status_code==200classTestGDPRAuth:"""VerifyallGDPRendpointsrequireadminauthentication."""deftest_erasure_no_auth(self,test_client:TestClient):response=test_client.post("/gdpr/erasure",json={"user_id":str(uuid.uuid4()),"reason":"Userrequest"},)assertresponse.status_code==401deftest_subject_access_no_auth(self,test_client:TestClient):response=test_client.post("/gdpr/subject-access",json={"user_id":str(uuid.uuid4())},)assertresponse.status_code==401deftest_portability_no_auth(self,test_client:TestClient):response=test_client.post("/gdpr/portability",json={"user_id":str(uuid.uuid4())},)assertresponse.status_code==401deftest_erasure_status_no_auth(self,test_client:TestClient):response=test_client.get("/gdpr/status/test-id")assertresponse.status_code==401classTestFinOpsAuth:"""VerifyallFinOpsendpointsrequireauthentication."""deftest_create_cost_center_no_auth(self,test_client:TestClient):response=test_client.post("/finops/cost-centers",json={"name":"Engineering","code":"ENG-001"},)assertresponse.status_code==401deftest_list_cost_centers_no_auth(self,test_client:TestClient):response=test_client.get("/finops/cost-centers")assertresponse.status_code==401deftest_create_chargeback_rule_no_auth(self,test_client:TestClient):response=test_client.post("/finops/chargeback-rules",json={"name":"Default","method":"proportional"},)assertresponse.status_code==401deftest_list_chargeback_rules_no_auth(self,test_client:TestClient):response=test_client.get("/finops/chargeback-rules")assertresponse.status_code==401deftest_snowflake_config_no_auth(self,test_client:TestClient):response=test_client.get("/finops/snowflake/config")assertresponse.status_code==401deftest_export_costs_no_auth(self,test_client:TestClient):response=test_client.get("/finops/export")assertresponse.status_code==401