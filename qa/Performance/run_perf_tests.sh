#!/usr/bin/envbash#─────────────────────────────────────────────────────────────set-euopipefail#───Configuration───────────────────────────────────────────SCRIPT_DIR="$(cd"$(dirname"${BASH_SOURCE[0]}")"&&pwd)"SUITE_FILE="${SCRIPT_DIR}/perf_suite.js"RESULTS_DIR="${SCRIPT_DIR}/../results"BASE_URL="${ALFRED_BASE_URL:-http://localhost:8080}"API_KEY="${ALFRED_API_KEY:-test-api-key-load-test}"PROFILE="${1:-smoke}"#ColorsGREEN='\033[0;32m'YELLOW='\033[1;33m'BLUE='\033[0;34m'RED='\033[0;31m'NC='\033[0m'log(){echo-e"${BLUE}[$(date+'%H:%M:%S')]${NC}$*";}ok(){echo-e"${GREEN}[✓]${NC}$*";}err(){echo-e"${RED}[✗]${NC}$*">&2;}#───Validate────────────────────────────────────────────────usage(){cat<<EOFAlfredPerformanceTestRunner(T209+T229)Usage:$0[profile]Profiles:smokeQuick1-minvalidation(CI-friendly)sustained10Kreq/minfor5min,P95<100ms(T209)stressRampto50Kreq/min,findbreakingpointsoak2-hourstabilitytestat6Kreq/minlatency_profileMeasuregatewayoverheadpreciselyEnvironmentVariables:ALFRED_BASE_URLTargetURL(default:http://localhost:8080)ALFRED_API_KEYAPIkeyforauth(default:test-api-key-load-test)Examples:$0smoke#QuickCIcheck$0sustained#Full10Kreq/minvalidationALFRED_BASE_URL=https://staging.alfred.ai$0stressEOF}case"$PROFILE"insmoke|sustained|stress|soak|latency_profile);;-h|--help)usage;exit0;;*)err"Unknownprofile:$PROFILE";usage;exit1;;esac#Checkk6isinstalledif!command-vk6&>/dev/null;thenerr"k6isnotinstalled.Installfromhttps://k6.io/docs/get-started/installation/"exit1fi#Createresultsdirectorymkdir-p"$RESULTS_DIR"#───Pre-flightHealthCheck────────────────────────────────log"Pre-flight:checking$BASE_URL/healthz..."ifcurl-sf--max-time5"$BASE_URL/healthz">/dev/null2>&1;thenok"Gatewayisreachable"elifcurl-sf--max-time5"$BASE_URL/health">/dev/null2>&1;thenok"Gatewayisreachable(/health)"elseerr"Gatewaynotreachableat$BASE_URL"err"Startthegatewayfirst:cdservices/gateway&&gorun."exit1fi#───RunTest────────────────────────────────────────────────echo""echo"╔════════════════════════════════════════════════════════════╗"echo"║AlfredPerformanceTestSuite(T209+T229)║"echo"╠════════════════════════════════════════════════════════════╣"echo"║Profile:$PROFILE"echo"║Target:$BASE_URL"echo"║Results:$RESULTS_DIR/"echo"╚════════════════════════════════════════════════════════════╝"echo""log"Startingk6withprofile:$PROFILE"k6run\--envALFRED_BASE_URL="$BASE_URL"\--envALFRED_API_KEY="$API_KEY"\--envTEST_PROFILE="$PROFILE"\--outjson="$RESULTS_DIR/perf_${PROFILE}_$(date+%Y%m%d_%H%M%S).json"\"$SUITE_FILE"EXIT_CODE=$?echo""if[$EXIT_CODE-eq0];thenok"PerformancetestPASSED(profile:$PROFILE)"ok"Resultssavedto$RESULTS_DIR/"elseerr"PerformancetestFAILED(profile:$PROFILE)—exitcode:$EXIT_CODE"err"Checkthresholdsintheoutputabove"fiexit$EXIT_CODE