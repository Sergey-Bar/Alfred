import{i as M,f as B,e as y,j as e,k as L,l as q}from"./index-BpBXMnYt.js";import{r as a}from"./vendor-CoKE50sv.js";import{F as z}from"./PlusIcon-CvPvxy5e.js";import{F as O}from"./ArrowRightIcon-DPPo99DE.js";function V({title:o,titleId:d,...f},x){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":d},f),o?a.createElement("title",{id:d},o):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const W=a.forwardRef(V);function H(){const{user:o}=M(),{showToast:d}=B(),[f,x]=a.useState([]),[F,v]=a.useState([]),[I,N]=a.useState(!0),[k,g]=a.useState(null),[n,E]=a.useState("all"),[i,p]=a.useState(null),[w,A]=a.useState({top:0,left:0}),j=a.useRef(null),[D,u]=a.useState(!1),[l,h]=a.useState({toUserId:"",amount:"",reason:""}),[_,S]=a.useState(!1);a.useEffect(()=>{b(),C()},[]);async function C(){try{const t=await y.getUsersSimple();v(t.users||t||[])}catch(t){v([]),g(t?.message||"Failed to load users")}}async function P(t){if(t.preventDefault(),!l.toUserId||!l.amount){d("Please select a recipient and enter an amount","error");return}try{S(!0),await y.createTransfer(l.toUserId,parseInt(l.amount),l.reason),d("Transfer successful!","success"),u(!1),h({toUserId:"",amount:"",reason:""}),b()}catch(r){d(r.message||"Transfer failed","error")}finally{S(!1)}}async function b(){try{N(!0);const t=await y.getTransfers(100),m=(t.recent_transfers||t).map(s=>({...s,from_user_name:s.sender,to_user_name:s.recipient,from_user_id:s.sender_id||s.from_user_id||null,to_user_id:s.recipient_id||s.to_user_id||null,from_user_email:s.sender_email||s.from_user_email||null,to_user_email:s.recipient_email||s.to_user_email||null,created_at:s.timestamp||s.created_at}));x(m)}catch(t){g(t?.message||"Failed to load transfers"),x([])}finally{N(!1)}}function $(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}const R=o?.name||"",c=f.filter(t=>n==="all"?!0:n==="sent"?t.from_user_name===R:n==="received"?t.to_user_name===R:!0);function T(t,r,m,s){const U=t.currentTarget.getBoundingClientRect();A({top:U.bottom+window.scrollY+8,left:U.left+window.scrollX}),p({name:r,type:m,email:m==="sender"?s.from_user_email:s.to_user_email,userId:m==="sender"?s.from_user_id:s.to_user_id})}return a.useEffect(()=>{function t(r){j.current&&!j.current.contains(r.target)&&p(null)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),I?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Credit Reallocation"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage and track credit reallocations between users"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2"}),"Reallocate Credits"]})]}),k&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 text-yellow-700 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",k,". Demo data not used."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{g(null),b(),C()},className:"btn btn-primary",children:"Retry"}),e.jsx("a",{href:"mailto:support@example.com",className:"btn btn-secondary",children:"Contact Support"})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(W,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter:"}),e.jsx("div",{className:"flex space-x-2",children:["all","sent","received"].map(t=>e.jsx("button",{onClick:()=>E(t),className:`px-3 py-1 text-sm rounded-full ${n===t?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400 font-medium":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:c.length}),e.jsxs("p",{className:"stat-label",children:[n==="all"?"Total":n==="sent"?"Sent":"Received"," Transfers"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:c.reduce((t,r)=>t+(r.amount||0),0).toLocaleString()}),e.jsxs("p",{className:"stat-label",children:["Total Credits ",n==="sent"?"Sent":n==="received"?"Received":"Reallocated"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:c.length>0?Math.round(c.reduce((t,r)=>t+(r.amount||0),0)/c.length).toLocaleString():0}),e.jsx("p",{className:"stat-label",children:"Average Reallocation"})]})]}),e.jsx("div",{className:"card relative",children:e.jsxs("div",{className:"space-y-4",children:[c.map(t=>e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:r=>T(r,t.from_user_name,"sender",t),className:"font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors text-left",children:t.from_user_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Sender"})]}),e.jsx("div",{className:"flex items-center px-6",children:e.jsxs("div",{className:"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-400 px-4 py-2 rounded-full",children:[e.jsx("span",{className:"font-semibold mr-2",children:t.amount?.toLocaleString()}),e.jsx(O,{className:"h-4 w-4"})]})}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("button",{onClick:r=>T(r,t.to_user_name,"recipient",t),className:"font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors text-right",children:t.to_user_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recipient"})]}),e.jsxs("div",{className:"ml-6 text-right w-48",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.reason||"No reason provided"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:$(t.created_at)})]})]},t.id)),c.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:n==="all"?"No reallocations found":`No ${n} reallocations found`})]})}),i&&e.jsxs("div",{ref:j,className:"fixed z-50 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 min-w-64",style:{top:w.top,left:w.left},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[i.type==="sender"?"Sender":"Recipient"," Info"]}),e.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(L,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:i.name})]}),i.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:i.email})]}),i.userId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"User ID"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-mono",children:i.userId})]}),!i.email&&!i.userId&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"No additional info available"})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(q,{className:"h-6 w-6 mr-2 text-blue-500"}),"Reallocate Credits"]}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(L,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Recipient"}),e.jsxs("select",{value:l.toUserId,onChange:t=>h({...l,toUserId:t.target.value}),className:"input w-full",required:!0,children:[e.jsx("option",{value:"",children:"Select a user..."}),F.filter(t=>t.user_id!==o?.id).map(t=>e.jsxs("option",{value:t.user_id,children:[t.name," (",t.email,")"]},t.user_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount (credits)"}),e.jsx("input",{type:"number",min:"1",value:l.amount,onChange:t=>h({...l,amount:t.target.value}),className:"input w-full",placeholder:"Enter credit amount",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason (optional)"}),e.jsx("textarea",{value:l.reason,onChange:t=>h({...l,reason:t.target.value}),className:"input w-full",rows:3,placeholder:"Business justification for this reallocation"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:_,children:_?"Processing...":"Reallocate Credits"})]})]})]})})]})}export{H as default};
