import{i as Z,f as $,e as b,j as e,k as R,l as M}from"./index-BYTAyHyu.js";import{r as a}from"./vendor-CoKE50sv.js";import{F as J}from"./PlusIcon-CvPvxy5e.js";import{F as W}from"./ArrowRightIcon-DPPo99DE.js";function q({title:c,titleId:o,...h},d){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":o},h),c?a.createElement("title",{id:o},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const z=a.forwardRef(q);function G(){const{user:c}=Z(),{showToast:o}=$(),[h,d]=a.useState([]),[U,j]=a.useState([]),[E,v]=a.useState(!0),[y,I]=a.useState(null),[l,L]=a.useState("all"),[n,g]=a.useState(null),[N,F]=a.useState({top:0,left:0}),f=a.useRef(null),[D,m]=a.useState(!1),[r,x]=a.useState({toUserId:"",amount:"",reason:""}),[w,k]=a.useState(!1);a.useEffect(()=>{_(),A()},[]);async function A(){try{const t=await b.getUsersSimple();j(t.users||t||[])}catch{j([{user_id:"1",name:"Alice Johnson",email:"alice@example.com"},{user_id:"2",name:"Bob Smith",email:"bob@example.com"},{user_id:"3",name:"Carol Williams",email:"carol@example.com"},{user_id:"4",name:"David Brown",email:"david@example.com"},{user_id:"5",name:"Eve Davis",email:"eve@example.com"}])}}async function B(t){if(t.preventDefault(),!r.toUserId||!r.amount){o("Please select a recipient and enter an amount","error");return}try{k(!0),await b.createTransfer(r.toUserId,parseInt(r.amount),r.reason),o("Transfer successful!","success"),m(!1),x({toUserId:"",amount:"",reason:""}),_()}catch(s){o(s.message||"Transfer failed","error")}finally{k(!1)}}async function _(){try{v(!0);const t=await b.getTransfers(100);d(t.recent_transfers||t)}catch(t){I(t.message),d([{id:"1",from_user_name:"Alice Johnson",to_user_name:"Bob Smith",amount:500,reason:"Project deadline support",created_at:"2024-01-15T10:30:00Z"},{id:"2",from_user_name:"Carol Williams",to_user_name:"David Brown",amount:250,reason:"Sprint capacity boost",created_at:"2024-01-14T15:45:00Z"},{id:"3",from_user_name:"Eve Davis",to_user_name:"Alice Johnson",amount:100,reason:"Testing automation",created_at:"2024-01-13T09:15:00Z"},{id:"4",from_user_name:"Bob Smith",to_user_name:"Carol Williams",amount:750,reason:"Research project budget",created_at:"2024-01-12T14:20:00Z"},{id:"5",from_user_name:"David Brown",to_user_name:"Eve Davis",amount:300,reason:"Code review support",created_at:"2024-01-11T11:00:00Z"}])}finally{v(!1)}}function P(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}const S=c?.name||"Alice Johnson",i=h.filter(t=>l==="all"?!0:l==="sent"?t.from_user_name===S:l==="received"?t.to_user_name===S:!0);function C(t,s,p,u){const T=t.currentTarget.getBoundingClientRect();F({top:T.bottom+window.scrollY+8,left:T.left+window.scrollX}),g({name:s,type:p,email:p==="sender"?u.from_user_email:u.to_user_email,userId:p==="sender"?u.from_user_id:u.to_user_id})}return a.useEffect(()=>{function t(s){f.current&&!f.current.contains(s.target)&&g(null)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Credit Reallocation"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage and track credit reallocations between users"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-primary flex items-center",children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),"Reallocate Credits"]})]}),y&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 text-yellow-700 rounded-lg text-sm",children:["Using demo data - API connection failed: ",y]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(z,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Filter:"}),e.jsx("div",{className:"flex space-x-2",children:["all","sent","received"].map(t=>e.jsx("button",{onClick:()=>L(t),className:`px-3 py-1 text-sm rounded-full ${l===t?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400 font-medium":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:i.length}),e.jsxs("p",{className:"stat-label",children:[l==="all"?"Total":l==="sent"?"Sent":"Received"," Transfers"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:i.reduce((t,s)=>t+(s.amount||0),0).toLocaleString()}),e.jsxs("p",{className:"stat-label",children:["Total Credits ",l==="sent"?"Sent":l==="received"?"Received":"Reallocated"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("p",{className:"stat-value",children:i.length>0?Math.round(i.reduce((t,s)=>t+(s.amount||0),0)/i.length).toLocaleString():0}),e.jsx("p",{className:"stat-label",children:"Average Reallocation"})]})]}),e.jsx("div",{className:"card relative",children:e.jsxs("div",{className:"space-y-4",children:[i.map(t=>e.jsxs("div",{className:"flex items-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("button",{onClick:s=>C(s,t.from_user_name,"sender",t),className:"font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors text-left",children:t.from_user_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Sender"})]}),e.jsx("div",{className:"flex items-center px-6",children:e.jsxs("div",{className:"flex items-center bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-400 px-4 py-2 rounded-full",children:[e.jsx("span",{className:"font-semibold mr-2",children:t.amount?.toLocaleString()}),e.jsx(W,{className:"h-4 w-4"})]})}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("button",{onClick:s=>C(s,t.to_user_name,"recipient",t),className:"font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors text-right",children:t.to_user_name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recipient"})]}),e.jsxs("div",{className:"ml-6 text-right w-48",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:t.reason||"No reason provided"}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:P(t.created_at)})]})]},t.id)),i.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:l==="all"?"No reallocations found":`No ${l} reallocations found`})]})}),n&&e.jsxs("div",{ref:f,className:"fixed z-50 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-4 min-w-64",style:{top:N.top,left:N.left},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[n.type==="sender"?"Sender":"Recipient"," Info"]}),e.jsx("button",{onClick:()=>g(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(R,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Name"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.name})]}),n.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:n.email})]}),n.userId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"User ID"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-mono",children:n.userId})]}),!n.email&&!n.userId&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"No additional info available"})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(M,{className:"h-6 w-6 mr-2 text-blue-500"}),"Reallocate Credits"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(R,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Recipient"}),e.jsxs("select",{value:r.toUserId,onChange:t=>x({...r,toUserId:t.target.value}),className:"input w-full",required:!0,children:[e.jsx("option",{value:"",children:"Select a user..."}),U.filter(t=>t.user_id!==c?.id).map(t=>e.jsxs("option",{value:t.user_id,children:[t.name," (",t.email,")"]},t.user_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount (credits)"}),e.jsx("input",{type:"number",min:"1",value:r.amount,onChange:t=>x({...r,amount:t.target.value}),className:"input w-full",placeholder:"Enter credit amount",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason (optional)"}),e.jsx("textarea",{value:r.reason,onChange:t=>x({...r,reason:t.target.value}),className:"input w-full",rows:3,placeholder:"Business justification for this reallocation"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:w,children:w?"Processing...":"Reallocate Credits"})]})]})]})})]})}export{G as default};
