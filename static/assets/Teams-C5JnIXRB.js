import{f as H,e as i,j as e,g as K}from"./index-BYTAyHyu.js";import{r as t}from"./vendor-CoKE50sv.js";import{F as V,D as X}from"./DeleteConfirmDialog-DGVRl-sN.js";import{F as Y}from"./PlusIcon-CvPvxy5e.js";import{F as E}from"./UserPlusIcon-BzzHUuVC.js";import{F as ee}from"./TrashIcon-CJadKJXF.js";function ae({title:r,titleId:c,...u},f){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},u),r?t.createElement("title",{id:c},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const te=t.forwardRef(ae);function me(){const{showToast:r}=H(),[c,u]=t.useState([]),[f,N]=t.useState(!0),[v,D]=t.useState(null),[w,q]=t.useState(""),[F,x]=t.useState(!1),[L,k]=t.useState(!1),[g,T]=t.useState(null),[o,R]=t.useState(null),[$,y]=t.useState(!1),[h,j]=t.useState(null),[A,M]=t.useState(!1),[p,_]=t.useState(""),[S,m]=t.useState([]),[U,C]=t.useState(!1),[n,b]=t.useState({name:"",pool_quota:1e4});t.useEffect(()=>{d()},[]);async function d(){try{N(!0);const l=(await i.getTeams()).map(s=>({team_id:s.id,team_name:s.name,description:s.description,pool_quota:s.common_pool,used_tokens:s.used_pool,remaining_tokens:s.available_pool,usage_percentage:s.common_pool>0?Math.round(s.used_pool/s.common_pool*100):0,member_count:s.member_count}));u(l)}catch(a){D(a.message),u([{team_id:"1",team_name:"Engineering",pool_quota:1e4,used_tokens:6500,remaining_tokens:3500,usage_percentage:65,member_count:8},{team_id:"2",team_name:"Marketing",pool_quota:5e3,used_tokens:4200,remaining_tokens:800,usage_percentage:84,member_count:4},{team_id:"3",team_name:"Research",pool_quota:15e3,used_tokens:12e3,remaining_tokens:3e3,usage_percentage:80,member_count:6},{team_id:"4",team_name:"Support",pool_quota:3e3,used_tokens:1500,remaining_tokens:1500,usage_percentage:50,member_count:3}])}finally{N(!1)}}function O(){T(null),b({name:"",pool_quota:1e4}),x(!0)}function P(a){T(a),b({name:a.team_name,pool_quota:a.pool_quota}),x(!0)}async function z(a){R(a),_(""),m([]),k(!0),C(!0);try{const l=await i.getTeamMembers(a.team_id);m(l||[])}catch{m([{id:"1",name:"Alice Johnson",email:"alice@example.com",is_admin:!0},{id:"2",name:"Bob Smith",email:"bob@example.com",is_admin:!1},{id:"3",name:"Carol Williams",email:"carol@example.com",is_admin:!1}])}finally{C(!1)}}async function B(a){if(a.preventDefault(),!!p.trim())try{await i.addTeamMember(o.team_id,p),r({type:"success",title:"Member Added",message:`${p} added to the team`}),_("");const l=await i.getTeamMembers(o.team_id);m(l||[]),d()}catch(l){r({type:"error",title:"Error",message:l.message||"Failed to add member"})}}async function Q(a,l){try{await i.removeTeamMember(o.team_id,a),r({type:"success",title:"Member Removed",message:`${l} removed from the team`}),m(s=>s.filter(G=>G.id!==a)),d()}catch(s){r({type:"error",title:"Error",message:s.message||"Failed to remove member"})}}async function W(a){a.preventDefault();try{g?(await i.updateTeam(g.team_id,n),r({type:"success",title:"Team Updated",message:`${n.name} has been updated`})):(await i.createTeam(n),r({type:"success",title:"Team Created",message:`${n.name} has been created`})),x(!1),d()}catch(l){r({type:"error",title:"Error",message:l.message||"Failed to save team"})}}function Z(a){j(a),y(!0)}async function I(){if(h){M(!0);try{await i.deleteTeam(h.team_id),r({type:"success",title:"Team Deleted",message:`${h.team_name} has been deleted`}),y(!1),j(null),d()}catch(a){r({type:"error",title:"Error",message:a.message||"Failed to delete team"})}finally{M(!1)}}}function J(a){return a>=90?"bg-red-500":a>=70?"bg-yellow-500":"bg-green-500"}return f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Teams"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage team pools and members"})]}),e.jsxs("button",{onClick:O,className:"btn btn-primary flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 mr-2"}),"Create Team"]})]}),v&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 text-yellow-700 rounded-lg text-sm",children:["Using demo data - API connection failed: ",v]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search teams by name...",className:"input w-full pl-10",value:w,onChange:a=>q(a.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.filter(a=>a.team_name?.toLowerCase().includes(w.toLowerCase())).map(a=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a.team_name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.member_count," members"]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>z(a),className:"p-1 text-gray-400 hover:text-blue-600",title:"Manage members",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>P(a),className:"p-1 text-gray-400 hover:text-blue-600",title:"Edit team",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>Z(a),className:"p-1 text-gray-400 hover:text-red-600",title:"Delete team",children:e.jsx(ee,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Pool Usage"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[a.usage_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${J(a.usage_percentage)}`,style:{width:`${Math.min(a.usage_percentage,100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Used"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.used_tokens?.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Remaining"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.remaining_tokens?.toLocaleString()})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total Quota"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:a.pool_quota?.toLocaleString()})]})]})]},a.team_id))}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:g?"Edit Team":"Create Team"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Team Name"}),e.jsx("input",{type:"text",className:"input",value:n.name,onChange:a=>b({...n,name:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Pool Quota"}),e.jsx("input",{type:"number",className:"input",value:n.pool_quota,onChange:a=>b({...n,pool_quota:parseInt(a.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:g?"Save Changes":"Create Team"})]})]})]})}),L&&o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-6 border border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-white",children:["Manage Members - ",o.team_name]}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Add or remove team members."}),e.jsxs("form",{onSubmit:B,className:"flex space-x-2 mb-6",children:[e.jsx("input",{type:"email",placeholder:"Enter user email...",className:"input flex-1",value:p,onChange:a=>_(a.target.value),required:!0}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"border border-gray-700 rounded-lg divide-y divide-gray-700 max-h-64 overflow-y-auto",children:U?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Loading members..."}):S.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"No members yet"}):S.map(a=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-400",children:a.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`badge ${a.is_admin?"badge-blue":"badge-green"}`,children:a.is_admin?"Admin":"Member"}),e.jsx("button",{onClick:()=>Q(a.id,a.name),className:"p-1 text-gray-400 hover:text-red-600",title:"Remove member",children:e.jsx(te,{className:"h-5 w-5"})})]})]},a.id))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>k(!1),className:"btn btn-secondary",children:"Close"})})]})}),e.jsx(X,{isOpen:$,onClose:()=>{y(!1),j(null)},onConfirm:I,itemName:h?.team_name||"",itemType:"team",loading:A})]})}export{me as default};
