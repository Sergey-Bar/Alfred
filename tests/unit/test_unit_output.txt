============================= test session starts =============================
platform win32 -- Python 3.14.3, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\Alfred
configfile: pyproject.toml
plugins: anyio-4.12.1, base-url-2.1.0, playwright-0.7.2
collecting ... collected 57 items

dev/QA/Backend/Unit/test_api.py::TestHealthEndpoint::test_health_check PASSED [  1%]
dev/QA/Backend/Unit/test_api.py::TestRootEndpoint::test_root PASSED      [  3%]
dev/QA/Backend/Unit/test_api.py::TestRootEndpoint::test_root_spa_mode SKIPPED [  5%]
dev/QA/Backend/Unit/test_api.py::TestUserEndpoints::test_create_user PASSED [  7%]
dev/QA/Backend/Unit/test_api.py::TestUserEndpoints::test_create_user_duplicate_email PASSED [  8%]
dev/QA/Backend/Unit/test_api.py::TestUserEndpoints::test_get_current_user_no_auth PASSED [ 10%]
dev/QA/Backend/Unit/test_api.py::TestUserEndpoints::test_get_current_user_invalid_key PASSED [ 12%]
dev/QA/Backend/Unit/test_api.py::TestChatCompletions::test_chat_completions_no_auth PASSED [ 14%]
dev/QA/Backend/Unit/test_api.py::TestTeamEndpoints::test_create_team PASSED [ 15%]
dev/QA/Backend/Unit/test_api.py::TestLeaderboard::test_get_leaderboard PASSED [ 17%]
dev/QA/Backend/Unit/test_api.py::TestLeaderboard::test_get_leaderboard_invalid_period PASSED [ 19%]
dev/QA/Backend/Unit/test_api_contracts.py::test_get_current_user_contract PASSED [ 21%]
dev/QA/Backend/Unit/test_api_contracts.py::test_admin_users_requires_auth PASSED [ 22%]
dev/QA/Backend/Unit/test_api_contracts.py::test_create_approval_contract FAILED [ 24%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_default_settings PASSED [ 26%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_settings_from_env PASSED [ 28%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_log_level_validation PASSED [ 29%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_environment_validation PASSED [ 31%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_is_production_property PASSED [ 33%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_is_sqlite_property PASSED [ 35%]
dev/QA/Backend/Unit/test_config.py::TestSettings::test_rate_limit_string PASSED [ 36%]
dev/QA/Backend/Unit/test_config.py::TestLogging::test_json_formatter PASSED [ 38%]
dev/QA/Backend/Unit/test_config.py::TestLogging::test_pii_masking PASSED [ 40%]
dev/QA/Backend/Unit/test_config.py::TestLogging::test_get_logger PASSED  [ 42%]
dev/QA/Backend/Unit/test_config.py::TestLogging::test_request_context_vars PASSED [ 43%]
dev/QA/Backend/Unit/test_config.py::TestExceptions::test_quota_exceeded_exception FAILED [ 45%]
dev/QA/Backend/Unit/test_config.py::TestExceptions::test_authentication_exception PASSED [ 47%]
dev/QA/Backend/Unit/test_config.py::TestExceptions::test_resource_not_found_exception FAILED [ 49%]
dev/QA/Backend/Unit/test_config.py::TestExceptions::test_llm_provider_exception FAILED [ 50%]
dev/QA/Backend/Unit/test_middleware.py::TestRateLimitMiddleware::test_rate_limit_allows_requests_within_limit PASSED [ 52%]
dev/QA/Backend/Unit/test_middleware.py::TestRateLimitMiddleware::test_rate_limit_blocks_excess_requests PASSED [ 54%]
dev/QA/Backend/Unit/test_middleware.py::TestRateLimitMiddleware::test_rate_limit_skips_health_endpoint PASSED [ 56%]
dev/QA/Backend/Unit/test_middleware.py::TestRateLimitMiddleware::test_rate_limit_disabled PASSED [ 57%]
dev/QA/Backend/Unit/test_middleware.py::TestRequestContextMiddleware::test_adds_request_id_header PASSED [ 59%]
dev/QA/Backend/Unit/test_middleware.py::TestRequestContextMiddleware::test_uses_provided_request_id PASSED [ 61%]
dev/QA/Backend/Unit/test_middleware.py::TestEfficiencyScorer::test_calculate_efficiency_score PASSED [ 63%]
dev/QA/Backend/Unit/test_middleware.py::TestEfficiencyScorer::test_efficiency_score_rounding PASSED [ 64%]
dev/QA/Backend/Unit/test_quota.py::TestCreditCalculator::test_calculate_cost_gpt4 PASSED [ 66%]
dev/QA/Backend/Unit/test_quota.py::TestCreditCalculator::test_calculate_cost_gpt35 PASSED [ 68%]
dev/QA/Backend/Unit/test_quota.py::TestCreditCalculator::test_estimate_cost PASSED [ 70%]
dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_check_quota_personal_available PASSED [ 71%]
dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_check_quota_personal_exceeded FAILED [ 73%]
dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_check_quota_critical_bypass PASSED [ 75%]
dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_check_quota_vacation_sharing PASSED [ 77%]
dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_deduct_quota_personal PASSED [ 78%]
dev/QA/Backend/Unit/test_quota.py::TestEfficiencyScorer::test_calculate_efficiency_score PASSED [ 80%]
dev/QA/Backend/Unit/test_quota.py::TestEfficiencyScorer::test_calculate_efficiency_score_zero_prompt PASSED [ 82%]
dev/QA/Backend/Unit/test_quota.py::TestEfficiencyScorer::test_calculate_efficiency_high_ratio PASSED [ 84%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestVacationSharing::test_vacation_share_available_when_member_on_vacation PASSED [ 85%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestVacationSharing::test_no_vacation_share_when_no_members_on_vacation PASSED [ 87%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestVacationSharing::test_vacation_share_respects_percentage_limit PASSED [ 89%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestQuotaDeduction::test_deduct_personal_quota PASSED [ 91%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestQuotaDeduction::test_deduct_team_pool PASSED [ 92%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestQuotaDeduction::test_add_quota FAILED [ 94%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestPriorityBypass::test_critical_priority_uses_team_pool PASSED [ 96%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestPriorityBypass::test_normal_priority_cannot_bypass PASSED [ 98%]
dev/QA/Backend/Unit/test_vacation_sharing.py::TestPriorityBypass::test_high_priority_treated_as_normal PASSED [100%]

================================== FAILURES ===================================
________________________ test_create_approval_contract ________________________
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\_backends\_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\runner.py", line 353, in from_call
    |     result: TResult | None = func()
    |                              ~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\runner.py", line 245, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds),
    |             ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\logging.py", line 850, in pytest_runtest_call
    |     yield
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\capture.py", line 900, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\skipping.py", line 268, in pytest_runtest_call
    |     return (yield)
    |             ^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\runner.py", line 179, in pytest_runtest_call
    |     item.runtest()
    |     ~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\python.py", line 1720, in runtest
    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\python.py", line 166, in pytest_pyfunc_call
    |     result = testfunction(**testargs)
    |   File "C:\Projects\Alfred\dev\QA\Backend\Unit\test_api_contracts.py", line 28, in test_create_approval_contract
    |     resp = test_client.post("/v1/approvals", json=body, headers=admin_api_key)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 546, in post
    |     return super().post(
    |            ~~~~~~~~~~~~^
    |         url,
    |         ^^^^
    |     ...<10 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 1144, in post
    |     return self.request(
    |            ~~~~~~~~~~~~^
    |         "POST",
    |         ^^^^^^^
    |     ...<11 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 445, in request
    |     return super().request(
    |            ~~~~~~~~~~~~~~~^
    |         method,
    |         ^^^^^^^
    |     ...<11 lines>...
    |         extensions=extensions,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 825, in request
    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 914, in send
    |     response = self._send_handling_auth(
    |         request,
    |     ...<2 lines>...
    |         history=[],
    |     )
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    |     response = self._send_handling_redirects(
    |         request,
    |         follow_redirects=follow_redirects,
    |         history=history,
    |     )
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    |     response = self._send_single_request(request)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    |     response = transport.handle_request(request)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 348, in handle_request
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 345, in handle_request
    |     portal.call(self.app, scope, receive, send)
    |     ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py", line 334, in call
    |     return cast(T_Retval, self.start_task_soon(func, *args).result())
    |                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py", line 450, in result
    |     return self.__get_result()
    |            ~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py", line 395, in __get_result
    |     raise self._exception
    |   File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py", line 259, in _call_func
    |     retval = await retval_or_awaitable
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\applications.py", line 1138, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\applications.py", line 107, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 240, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    |     create_background_task(emit_approval_requested(
    |                            ~~~~~~~~~~~~~~~~~~~~~~~^
    |         user_id=str(user.id),
    |         ^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |         reason=request_data.reason
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ))
    |     ^
    | TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Projects\Alfred\dev\QA\Backend\Unit\test_api_contracts.py", line 28, in test_create_approval_contract
    resp = test_client.post("/v1/approvals", json=body, headers=admin_api_key)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 546, in post
    return super().post(
           ~~~~~~~~~~~~^
        url,
        ^^^^
    ...<10 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 1144, in post
    return self.request(
           ~~~~~~~~~~~~^
        "POST",
        ^^^^^^^
    ...<11 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 445, in request
    return super().request(
           ~~~~~~~~~~~~~~~^
        method,
        ^^^^^^^
    ...<11 lines>...
        extensions=extensions,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 825, in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 914, in send
    response = self._send_handling_auth(
        request,
    ...<2 lines>...
        history=[],
    )
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
        request,
        follow_redirects=follow_redirects,
        history=history,
    )
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 348, in handle_request
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py", line 345, in handle_request
    portal.call(self.app, scope, receive, send)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py", line 334, in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py", line 450, in result
    return self.__get_result()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py", line 395, in __get_result
    raise self._exception
  File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py", line 259, in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\applications.py", line 1138, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\applications.py", line 107, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 240, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    create_background_task(emit_approval_requested(
                           ~~~~~~~~~~~~~~~~~~~~~~~^
        user_id=str(user.id),
        ^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        reason=request_data.reason
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^
TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'

The above exception was the direct cause of the following exception:
dev\QA\Backend\Unit\test_api_contracts.py:28: in test_create_approval_contract
    resp = test_client.post("/v1/approvals", json=body, headers=admin_api_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py:546: in post
    return super().post(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:1144: in post
    return self.request(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py:445: in request
    return super().request(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:914: in send
    response = self._send_handling_auth(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\httpx\_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py:348: in handle_request
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\testclient.py:345: in handle_request
    portal.call(self.app, scope, receive, send)
c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py:334: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py:450: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\concurrent\futures\_base.py:395: in __get_result
    raise self._exception
c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\from_thread.py:259: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\applications.py:1138: in __call__
    await super().__call__(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\applications.py:107: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py:186: in __call__
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py:164: in __call__
    await self.app(scope, receive, _send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\cors.py:87: in __call__
    await self.app(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py:87: in collapse_excgroups
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dev\backend\app\middleware.py:240: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py:87: in collapse_excgroups
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dev\backend\app\middleware.py:54: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:191: in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py:162: in __exit__
    self.gen.throw(value)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py:87: in collapse_excgroups
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:193: in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dev\backend\app\middleware.py:355: in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:168: in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py:144: in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py:736: in app
    await route.handle(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py:290: in handle
    await self.app(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py:121: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py:53: in wrapped_app
    raise exc
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py:107: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py:426: in app
    raw_response = await run_endpoint_function(
C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py:314: in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
dev\backend\app\routers\governance.py:196: in create_approval_request
    create_background_task(emit_approval_requested(
E   TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
---------------------------- Captured stdout setup ----------------------------
{"timestamp": "2026-02-14T12:50:13.809506+00:00Z", "level": "INFO", "logger": "app.main", "message": "Alfred Core Initialization", "module": "logging_config", "function": "_log_with_extra", "line": 144, "extra": {"v": "1.0.0", "tier": "development", "mode": "DEV"}}
{"timestamp": "2026-02-14T12:50:13.811350+00:00Z", "level": "INFO", "logger": "app.main", "message": "Sandbox Environment: Local tables synchronized.", "module": "logging_config", "function": "_log_with_extra", "line": 144}
{"timestamp": "2026-02-14T12:50:13.816381+00:00Z", "level": "INFO", "logger": "app.main", "message": "Governance: Global Organization settings seeded.", "module": "logging_config", "function": "_log_with_extra", "line": 144}
----------------------------- Captured log setup ------------------------------
INFO     app.main:logging_config.py:144 Alfred Core Initialization
INFO     app.main:logging_config.py:144 Sandbox Environment: Local tables synchronized.
INFO     app.main:logging_config.py:144 Governance: Global Organization settings seeded.
---------------------------- Captured stdout call -----------------------------
{"timestamp": "2026-02-14T12:50:13.854263+00:00Z", "level": "ERROR", "logger": "app.middleware", "message": "Unhandled Exception in Lifecycle: emit_approval_requested() got an unexpected keyword argument 'amount'", "module": "logging_config", "function": "_log_with_extra", "line": 144, "request_id": "02459913-0680-4022-b82d-36d3ae4bbee8", "exception": {"type": "TypeError", "message": "emit_approval_requested() got an unexpected keyword argument 'amount'", "traceback": "  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 81, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"c:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\anyio\\_backends\\_asyncio.py\", line 783, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 54, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 355, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 121, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 107, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 426, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<3 lines>...\n    |     )\n    |     ^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 314, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\routers\\governance.py\", line 196, in create_approval_request\n    |     create_background_task(emit_approval_requested(\n    |                            ~~~~~~~~~~~~~~~~~~~~~~~^\n    |         user_id=str(user.id),\n    |         ^^^^^^^^^^^^^^^^^^^^^\n    |     ...<3 lines>...\n    |         reason=request_data.reason\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ))\n    |     ^\n    | TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 54, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 355, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 121, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 107, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 426, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 314, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\routers\\governance.py\", line 196, in create_approval_request\n    create_background_task(emit_approval_requested(\n                           ~~~~~~~~~~~~~~~~~~~~~~~^\n        user_id=str(user.id),\n        ^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n        reason=request_data.reason\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ))\n    ^\nTypeError: emit_approval_requested() got an unexpected keyword argument 'amount'"}}
{"timestamp": "2026-02-14T12:50:13.885306+00:00Z", "level": "ERROR", "logger": "app.exceptions", "message": "Unhandled Platform Crash: emit_approval_requested() got an unexpected keyword argument 'amount'", "module": "logging_config", "function": "_log_with_extra", "line": 144, "extra": {"err_type": "TypeError", "path": "/v1/approvals"}, "exception": {"type": "TypeError", "message": "emit_approval_requested() got an unexpected keyword argument 'amount'", "traceback": "  + Exception Group Traceback (most recent call last):\n  |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 81, in collapse_excgroups\n  |     yield\n  |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 192, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |                ~~~~~~~~~~~~~~~~~~~~~~~^^\n  |   File \"c:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\anyio\\_backends\\_asyncio.py\", line 783, in __aexit__\n  |     raise BaseExceptionGroup(\n  |         \"unhandled errors in a TaskGroup\", self._exceptions\n  |     ) from None\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 87, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 240, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 54, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |                                    ~~~~~~~~~~~~~~~~~~^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    |     self.gen.throw(value)\n    |     ~~~~~~~~~~~~~~^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 355, in dispatch\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    |     raise app_exc from app_exc.__cause__ or app_exc.__context__\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 121, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 107, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 426, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ...<3 lines>...\n    |     )\n    |     ^\n    |   File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 314, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"C:\\Projects\\Alfred\\dev\\backend\\app\\routers\\governance.py\", line 196, in create_approval_request\n    |     create_background_task(emit_approval_requested(\n    |                            ~~~~~~~~~~~~~~~~~~~~~~~^\n    |         user_id=str(user.id),\n    |         ^^^^^^^^^^^^^^^^^^^^^\n    |     ...<3 lines>...\n    |         reason=request_data.reason\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |     ))\n    |     ^\n    | TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'\n    +------------------------------------\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\cors.py\", line 87, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 240, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 54, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 191, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n                                   ~~~~~~~~~~~~~~~~~~^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\contextlib.py\", line 162, in __exit__\n    self.gen.throw(value)\n    ~~~~~~~~~~~~~~^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_utils.py\", line 87, in collapse_excgroups\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 193, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\middleware.py\", line 355, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 168, in call_next\n    raise app_exc from app_exc.__cause__ or app_exc.__context__\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py\", line 18, in __call__\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 121, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\starlette\\_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 107, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 426, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"C:\\Users\\Sergey\\AppData\\Local\\Python\\pythoncore-3.14-64\\Lib\\site-packages\\fastapi\\routing.py\", line 314, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Projects\\Alfred\\dev\\backend\\app\\routers\\governance.py\", line 196, in create_approval_request\n    create_background_task(emit_approval_requested(\n                           ~~~~~~~~~~~~~~~~~~~~~~~^\n        user_id=str(user.id),\n        ^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n        reason=request_data.reason\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ))\n    ^\nTypeError: emit_approval_requested() got an unexpected keyword argument 'amount'"}}
------------------------------ Captured log call ------------------------------
ERROR    app.middleware:logging_config.py:144 Unhandled Exception in Lifecycle: emit_approval_requested() got an unexpected keyword argument 'amount'
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\_backends\_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    |     create_background_task(emit_approval_requested(
    |                            ~~~~~~~~~~~~~~~~~~~~~~~^
    |         user_id=str(user.id),
    |         ^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |         reason=request_data.reason
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ))
    |     ^
    | TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    create_background_task(emit_approval_requested(
                           ~~~~~~~~~~~~~~~~~~~~~~~^
        user_id=str(user.id),
        ^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        reason=request_data.reason
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^
TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
ERROR    app.exceptions:logging_config.py:144 Unhandled Platform Crash: emit_approval_requested() got an unexpected keyword argument 'amount'
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 81, in collapse_excgroups
  |     yield
  |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "c:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\anyio\_backends\_asyncio.py", line 783, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 240, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    |     create_background_task(emit_approval_requested(
    |                            ~~~~~~~~~~~~~~~~~~~~~~~^
    |         user_id=str(user.id),
    |         ^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |         reason=request_data.reason
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ))
    |     ^
    | TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\cors.py", line 87, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 240, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 54, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_utils.py", line 87, in collapse_excgroups
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\middleware.py", line 355, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 121, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 107, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 426, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\fastapi\routing.py", line 314, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Projects\Alfred\dev\backend\app\routers\governance.py", line 196, in create_approval_request
    create_background_task(emit_approval_requested(
                           ~~~~~~~~~~~~~~~~~~~~~~~^
        user_id=str(user.id),
        ^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        reason=request_data.reason
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ))
    ^
TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
-------------------------- Captured stdout teardown ---------------------------
{"timestamp": "2026-02-14T12:50:15.579960+00:00Z", "level": "INFO", "logger": "app.main", "message": "Alfred Core Shutdown: All subsystems released.", "module": "logging_config", "function": "_log_with_extra", "line": 144}
---------------------------- Captured log teardown ----------------------------
INFO     app.main:logging_config.py:144 Alfred Core Shutdown: All subsystems released.
________________ TestExceptions.test_quota_exceeded_exception _________________
dev\QA\Backend\Unit\test_config.py:208: in test_quota_exceeded_exception
    assert exc.details["approval_process"]["process"] == "Submit request"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'approval_process'
______________ TestExceptions.test_resource_not_found_exception _______________
dev\QA\Backend\Unit\test_config.py:228: in test_resource_not_found_exception
    assert "User not found: user-123" in exc.message
E   AssertionError: assert 'User not found: user-123' in 'Entity Not Found: User (user-123)'
E    +  where 'Entity Not Found: User (user-123)' = ResourceNotFoundException('Entity Not Found: User (user-123)').message
_________________ TestExceptions.test_llm_provider_exception __________________
dev\QA\Backend\Unit\test_config.py:246: in test_llm_provider_exception
    assert exc.details["original_error"] == "Error: 429"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'original_error'
_____________ TestQuotaManager.test_check_quota_personal_exceeded _____________
dev\QA\Backend\Unit\test_quota.py:79: in test_check_quota_personal_exceeded
    assert "approval" in result.message.lower() or "exceeded" in result.message.lower()
E   AssertionError: assert ('approval' in 'organizational credit limit reached.' or 'exceeded' in 'organizational credit limit reached.')
E    +  where 'organizational credit limit reached.' = <built-in method lower of str object at 0x0000017C0E68B640>()
E    +    where <built-in method lower of str object at 0x0000017C0E68B640> = 'Organizational credit limit reached.'.lower
E    +      where 'Organizational credit limit reached.' = QuotaCheckResult(allowed=False, source='none', available_credits=Decimal('0.00'), message='Organizational credit limit reached.', requires_approval=True, approval_instructions={'process': 'Manager Approval Required', 'steps': ['POST /v1/approvals with justification.', 'Wait for Team Admin review.', 'Credits auto-replenish upon approval.'], 'endpoint': '/v1/approvals'}).message
E    +  and   'organizational credit limit reached.' = <built-in method lower of str object at 0x0000017C0E68B640>()
E    +    where <built-in method lower of str object at 0x0000017C0E68B640> = 'Organizational credit limit reached.'.lower
E    +      where 'Organizational credit limit reached.' = QuotaCheckResult(allowed=False, source='none', available_credits=Decimal('0.00'), message='Organizational credit limit reached.', requires_approval=True, approval_instructions={'process': 'Manager Approval Required', 'steps': ['POST /v1/approvals with justification.', 'Wait for Team Admin review.', 'Credits auto-replenish upon approval.'], 'endpoint': '/v1/approvals'}).message
______________________ TestQuotaDeduction.test_add_quota ______________________
dev\QA\Backend\Unit\test_vacation_sharing.py:182: in test_add_quota
    manager.add_quota(test_user, Decimal("500.00"))
    ^^^^^^^^^^^^^^^^^
E   AttributeError: 'QuotaManager' object has no attribute 'add_quota'
============================== warnings summary ===============================
..\..\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\config\__init__.py:1428
  C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\config\__init__.py:1428: PytestConfigWarning: Unknown config option: asyncio_mode
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

..\..\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\litellm\litellm_core_utils\logging_utils.py:273: 15 warnings
  C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\litellm\litellm_core_utils\logging_utils.py:273: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    if asyncio.iscoroutinefunction(func):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED dev/QA/Backend/Unit/test_api_contracts.py::test_create_approval_contract - TypeError: emit_approval_requested() got an unexpected keyword argument 'amount'
FAILED dev/QA/Backend/Unit/test_config.py::TestExceptions::test_quota_exceeded_exception - KeyError: 'approval_process'
FAILED dev/QA/Backend/Unit/test_config.py::TestExceptions::test_resource_not_found_exception - AssertionError: assert 'User not found: user-123' in 'Entity Not Found: User (user-123)'
 +  where 'Entity Not Found: User (user-123)' = ResourceNotFoundException('Entity Not Found: User (user-123)').message
FAILED dev/QA/Backend/Unit/test_config.py::TestExceptions::test_llm_provider_exception - KeyError: 'original_error'
FAILED dev/QA/Backend/Unit/test_quota.py::TestQuotaManager::test_check_quota_personal_exceeded - AssertionError: assert ('approval' in 'organizational credit limit reached.' or 'exceeded' in 'organizational credit limit reached.')
 +  where 'organizational credit limit reached.' = <built-in method lower of str object at 0x0000017C0E68B640>()
 +    where <built-in method lower of str object at 0x0000017C0E68B640> = 'Organizational credit limit reached.'.lower
 +      where 'Organizational credit limit reached.' = QuotaCheckResult(allowed=False, source='none', available_credits=Decimal('0.00'), message='Organizational credit limit reached.', requires_approval=True, approval_instructions={'process': 'Manager Approval Required', 'steps': ['POST /v1/approvals with justification.', 'Wait for Team Admin review.', 'Credits auto-replenish upon approval.'], 'endpoint': '/v1/approvals'}).message
 +  and   'organizational credit limit reached.' = <built-in method lower of str object at 0x0000017C0E68B640>()
 +    where <built-in method lower of str object at 0x0000017C0E68B640> = 'Organizational credit limit reached.'.lower
 +      where 'Organizational credit limit reached.' = QuotaCheckResult(allowed=False, source='none', available_credits=Decimal('0.00'), message='Organizational credit limit reached.', requires_approval=True, approval_instructions={'process': 'Manager Approval Required', 'steps': ['POST /v1/approvals with justification.', 'Wait for Team Admin review.', 'Credits auto-replenish upon approval.'], 'endpoint': '/v1/approvals'}).message
FAILED dev/QA/Backend/Unit/test_vacation_sharing.py::TestQuotaDeduction::test_add_quota - AttributeError: 'QuotaManager' object has no attribute 'add_quota'
============ 6 failed, 50 passed, 1 skipped, 16 warnings in 14.50s ============
