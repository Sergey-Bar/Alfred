#!/bin/bash#ScripttoautomatesecretandcredentialrotationusingHashiCorpVault#CheckifVaultCLIisinstalledif!command-vvault&>/dev/nullthenecho"VaultCLInotfound.InstallingVault..."#InstallVault(exampleforLinux)curl-fsSLhttps://apt.releases.hashicorp.com/gpg|sudoapt-keyadd-sudoapt-add-repository"deb[arch=amd64]https://apt.releases.hashicorp.com$(lsb_release-cs)main"sudoapt-getupdate&&sudoapt-getinstallvaultelseecho"VaultCLIisalreadyinstalled."fi#InitializeVault(ifnotalreadyinitialized)if[!-f/etc/vault.d/vault-init.txt];thenecho"InitializingVault..."vaultoperatorinit>/etc/vault.d/vault-init.txtecho"Vaultinitialized.Savetheunsealkeysandroottokensecurely."elseecho"Vaultisalreadyinitialized."fi#UnsealVaultecho"UnsealingVault..."VAULT_KEYS=$(grep'UnsealKey'/etc/vault.d/vault-init.txt|awk'{print$4}')forkeyin$VAULT_KEYS;dovaultoperatorunseal$keydone#Enablesecretenginesvaultsecretsenable-path=secretkv-v2#Example:Rotatedatabasecredentialsecho"Rotatingdatabasecredentials..."vaultwritedatabase/config/my-database\plugin_name=mysql-database-plugin\connection_url="{{username}}:{{password}}@tcp(127.0.0.1:3306)/"\allowed_roles="my-role"\username="root"\password="rootpassword"vaultwritedatabase/roles/my-role\db_name=my-database\creation_statements="CREATEUSER'{{name}}'@'%'IDENTIFIEDBY'{{password}}';GRANTSELECTON*.*TO'{{name}}'@'%';"\default_ttl="1h"\max_ttl="24h"#Schedulerotation(exampleusingcron)crontab-l>mycron{echo"0****vaultleaserevoke-prefixdatabase/creds/my-role"}>>mycroncrontabmycronrmmycronecho"Secretrotationsetupcomplete."