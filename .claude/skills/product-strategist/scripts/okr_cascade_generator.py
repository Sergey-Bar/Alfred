#!/usr/bin/envpython3"""OKRCascadeGeneratorCreatesalignedOKRsfromcompanystrategydowntoteamlevel"""importjsonfromtypingimportDict,Listfromdatetimeimportdatetime,timedeltaclassOKRGenerator:"""GenerateandcascadeOKRsacrosstheorganization"""def__init__(self):self.okr_templates={'growth':{'objectives':['Accelerateuseracquisitionandmarketexpansion','Achieveproduct-marketfitinnewsegments','Buildsustainablegrowthengine'],'key_results':['IncreaseMAUfrom{current}to{target}','Achieve{target}%MoMgrowthrate','Expandto{target}newmarkets','ReduceCACby{target}%','Improveactivationrateto{target}%']},'retention':{'objectives':['Createlastingcustomervalueandloyalty','Buildbest-in-classuserexperience','Maximizecustomerlifetimevalue'],'key_results':['Improveretentionfrom{current}%to{target}%','IncreaseNPSfrom{current}to{target}','Reducechurntobelow{target}%','Achieve{target}%productstickiness','IncreaseLTV/CACratioto{target}']},'revenue':{'objectives':['Drivesustainablerevenuegrowth','Optimizemonetizationstrategy','Expandrevenuepercustomer'],'key_results':['GrowARRfrom${current}Mto${target}M','IncreaseARPUby{target}%','Launch{target}newrevenuestreams','Achieve{target}%grossmargin','Reducerevenuechurnto{target}%']},'innovation':{'objectives':['Pioneernext-generationproductcapabilities','Establishmarketleadershipthroughinnovation','Buildcompetitivemoat'],'key_results':['Launch{target}breakthroughfeatures','Achieve{target}%ofrevenuefromnewproducts','File{target}patents/IP','Reducetime-to-marketby{target}%','Achieve{target}innovationscore']},'operational':{'objectives':['Buildworld-classproductorganization','Achieveoperationalexcellence','Scaleefficiently'],'key_results':['Improvevelocityby{target}%','Reducecycletimeto{target}days','Achieve{target}%automation','ImproveteamNPSto{target}','Reduceincidentsby{target}%']}}defgenerate_company_okrs(self,strategy:str,metrics:Dict)->Dict:"""Generatecompany-levelOKRsbasedonstrategy"""ifstrategynotinself.okr_templates:strategy='growth'#Defaulttemplate=self.okr_templates[strategy]company_okrs={'level':'Company','quarter':self._get_current_quarter(),'strategy':strategy,'objectives':[]}#Generate3objectivesforiinrange(min(3,len(template['objectives']))):obj={'id':f'CO-{i+1}','title':template['objectives'][i],'key_results':[],'owner':'CEO','status':'draft'}#Add3-5keyresultsperobjectiveforjinrange(3):ifj<len(template['key_results']):kr_template=template['key_results'][j]kr={'id':f'CO-{i+1}-KR{j+1}','title':self._fill_metrics(kr_template,metrics),'current':metrics.get('current',0),'target':metrics.get('target',100),'unit':self._extract_unit(kr_template),'status':'not_started'}obj['key_results'].append(kr)company_okrs['objectives'].append(obj)returncompany_okrsdefcascade_to_product(self,company_okrs:Dict)->Dict:"""CascadecompanyOKRstoproductorganization"""product_okrs={'level':'Product','quarter':company_okrs['quarter'],'parent':'Company','objectives':[]}#Mapcompanyobjectivestoproductobjectivesforcompany_objincompany_okrs['objectives']:product_obj={'id':f'PO-{company_obj["id"].split("-")[1]}','title':self._translate_to_product(company_obj['title']),'parent_objective':company_obj['id'],'key_results':[],'owner':'HeadofProduct','status':'draft'}#Generateproduct-specifickeyresultsforkrincompany_obj['key_results']:product_kr={'id':f'PO-{product_obj["id"].split("-")[1]}-KR{kr["id"].split("KR")[1]}','title':self._translate_kr_to_product(kr['title']),'contributes_to':kr['id'],'current':kr['current'],'target':kr['target']*0.3,#Producttypicallycontributes30%'unit':kr['unit'],'status':'not_started'}product_obj['key_results'].append(product_kr)product_okrs['objectives'].append(product_obj)returnproduct_okrsdefcascade_to_teams(self,product_okrs:Dict)->List[Dict]:"""CascadeproductOKRstoindividualteams"""teams=['Growth','Platform','Mobile','Data']team_okrs=[]forteaminteams:team_okr={'level':'Team','team':team,'quarter':product_okrs['quarter'],'parent':'Product','objectives':[]}#Eachteamtakesrelevantobjectivesforproduct_objinproduct_okrs['objectives']:ifself._is_relevant_for_team(product_obj['title'],team):team_obj={'id':f'{team[:3].upper()}-{product_obj["id"].split("-")[1]}','title':self._translate_to_team(product_obj['title'],team),'parent_objective':product_obj['id'],'key_results':[],'owner':f'{team}PM','status':'draft'}#Addteam-specifickeyresultsforkrinproduct_obj['key_results'][:2]:#Eachteamtakes2KRsteam_kr={'id':f'{team[:3].upper()}-{team_obj["id"].split("-")[1]}-KR{kr["id"].split("KR")[1]}','title':self._translate_kr_to_team(kr['title'],team),'contributes_to':kr['id'],'current':kr['current'],'target':kr['target']/len(teams),'unit':kr['unit'],'status':'not_started'}team_obj['key_results'].append(team_kr)team_okr['objectives'].append(team_obj)ifteam_okr['objectives']:team_okrs.append(team_okr)returnteam_okrsdefgenerate_okr_dashboard(self,all_okrs:Dict)->str:"""GenerateOKRdashboardview"""dashboard=["="*60]dashboard.append("OKRCASCADEDASHBOARD")dashboard.append(f"Quarter:{all_okrs.get('quarter','Q12025')}")dashboard.append("="*60)#CompanyOKRsif'company'inall_okrs:dashboard.append("\nðŸ¢COMPANYOKRS\n")forobjinall_okrs['company']['objectives']:dashboard.append(f"ðŸ“Œ{obj['id']}:{obj['title']}")forkrinobj['key_results']:dashboard.append(f"â””â”€{kr['id']}:{kr['title']}")#ProductOKRsif'product'inall_okrs:dashboard.append("\nðŸš€PRODUCTOKRS\n")forobjinall_okrs['product']['objectives']:dashboard.append(f"ðŸ“Œ{obj['id']}:{obj['title']}")dashboard.append(f"â†³Supports:{obj.get('parent_objective','N/A')}")forkrinobj['key_results']:dashboard.append(f"â””â”€{kr['id']}:{kr['title']}")#TeamOKRsif'teams'inall_okrs:dashboard.append("\nðŸ‘¥TEAMOKRS\n")forteam_okrinall_okrs['teams']:dashboard.append(f"\n{team_okr['team']}Team:")forobjinteam_okr['objectives']:dashboard.append(f"ðŸ“Œ{obj['id']}:{obj['title']}")forkrinobj['key_results']:dashboard.append(f"â””â”€{kr['id']}:{kr['title']}")#AlignmentMatrixdashboard.append("\n\nðŸ“ŠALIGNMENTMATRIX\n")dashboard.append("Companyâ†’Productâ†’Teams")dashboard.append("-"*40)if'company'inall_okrsand'product'inall_okrs:forc_objinall_okrs['company']['objectives']:dashboard.append(f"\n{c_obj['id']}")forp_objinall_okrs['product']['objectives']:ifp_obj.get('parent_objective')==c_obj['id']:dashboard.append(f"â”œâ”€{p_obj['id']}")if'teams'inall_okrs:forteam_okrinall_okrs['teams']:fort_objinteam_okr['objectives']:ift_obj.get('parent_objective')==p_obj['id']:dashboard.append(f"â””â”€{t_obj['id']}({team_okr['team']})")return"\n".join(dashboard)defcalculate_alignment_score(self,all_okrs:Dict)->Dict:"""CalculatealignmentscoreacrossOKRcascade"""scores={'vertical_alignment':0,'horizontal_alignment':0,'coverage':0,'balance':0,'overall':0}#Verticalalignment:Howwelleachlevelsupportstheabovetotal_objectives=0aligned_objectives=0if'product'inall_okrs:forobjinall_okrs['product']['objectives']:total_objectives+=1if'parent_objective'inobj:aligned_objectives+=1if'teams'inall_okrs:forteaminall_okrs['teams']:forobjinteam['objectives']:total_objectives+=1if'parent_objective'inobj:aligned_objectives+=1iftotal_objectives>0:scores['vertical_alignment']=round((aligned_objectives/total_objectives)*100,1)#Horizontalalignment:Howwellteamscoordinateif'teams'inall_okrsandlen(all_okrs['teams'])>1:shared_objectives=set()forteaminall_okrs['teams']:forobjinteam['objectives']:parent=obj.get('parent_objective')ifparent:shared_objectives.add(parent)scores['horizontal_alignment']=min(100,len(shared_objectives)*25)#Coverage:HowmuchofcompanyOKRsarecoveredif'company'inall_okrsand'product'inall_okrs:company_krs=sum(len(obj['key_results'])forobjinall_okrs['company']['objectives'])covered_krs=sum(len(obj['key_results'])forobjinall_okrs['product']['objectives'])ifcompany_krs>0:scores['coverage']=round((covered_krs/company_krs)*100,1)#Balance:Distributionacrossteamsif'teams'inall_okrs:objectives_per_team=[len(team['objectives'])forteaminall_okrs['teams']]ifobjectives_per_team:avg_objectives=sum(objectives_per_team)/len(objectives_per_team)variance=sum((x-avg_objectives)**2forxinobjectives_per_team)/len(objectives_per_team)scores['balance']=round(max(0,100-variance*10),1)#Overallscorescores['overall']=round(sum([scores['vertical_alignment']*0.4,scores['horizontal_alignment']*0.2,scores['coverage']*0.2,scores['balance']*0.2]),1)returnscoresdef_get_current_quarter(self)->str:"""Getcurrentquarter"""now=datetime.now()quarter=(now.month-1)//3+1returnf"Q{quarter}{now.year}"def_fill_metrics(self,template:str,metrics:Dict)->str:"""Filltemplatewithactualmetrics"""result=templateforkey,valueinmetrics.items():result=result.replace(f'{{{key}}}',str(value))returnresultdef_extract_unit(self,kr_template:str)->str:"""ExtractmeasurementunitfromKRtemplate"""if'%'inkr_template:return'%'elif'$'inkr_template:return'$'elif'days'inkr_template.lower():return'days'elif'score'inkr_template.lower():return'points'return'count'def_translate_to_product(self,company_objective:str)->str:"""Translatecompanyobjectivetoproductobjective"""translations={'Accelerateuseracquisition':'Buildviralproductfeatures','Achieveproduct-marketfit':'Validateproducthypotheses','Buildsustainablegrowth':'Createproduct-ledgrowthloops','Createlastingcustomervalue':'Designstickyuserexperiences','Drivesustainablerevenue':'Optimizeproductmonetization','Pioneernext-generation':'Shipinnovativefeatures','Buildworld-class':'Elevateproductexcellence'}forkey,valueintranslations.items():ifkeyincompany_objective:returncompany_objective.replace(key,value)returnf"Product:{company_objective}"def_translate_kr_to_product(self,kr:str)->str:"""TranslateKRtoproductcontext"""product_terms={'MAU':'productMAU','growthrate':'featureadoptionrate','CAC':'productonboardingefficiency','retention':'productretention','NPS':'productNPS','ARR':'product-drivenrevenue','churn':'productchurn'}result=krforterm,replacementinproduct_terms.items():ifterminresult:result=result.replace(term,replacement)breakreturnresultdef_translate_to_team(self,objective:str,team:str)->str:"""Translateobjectivetoteamcontext"""team_focus={'Growth':'acquisitionandactivation','Platform':'infrastructureandreliability','Mobile':'mobileexperience','Data':'analyticsandinsights'}focus=team_focus.get(team,'delivery')returnf"{objective}through{focus}"def_translate_kr_to_team(self,kr:str,team:str)->str:"""TranslateKRtoteamcontext"""returnf"[{team}]{kr}"def_is_relevant_for_team(self,objective:str,team:str)->bool:"""Checkifobjectiveisrelevantforteam"""relevance={'Growth':['acquisition','growth','activation','viral'],'Platform':['infrastructure','reliability','scale','performance'],'Mobile':['mobile','app','ios','android'],'Data':['analytics','metrics','insights','data']}keywords=relevance.get(team,[])objective_lower=objective.lower()returnany(keywordinobjective_lowerforkeywordinkeywords)orteam=='Platform'defmain():importsys#Samplemetricsmetrics={'current':100000,'target':150000,'current_revenue':10,'target_revenue':15,'current_nps':40,'target_nps':60}#Getstrategyfromcommandlineordefaultstrategy=sys.argv[1]iflen(sys.argv)>1else'growth'#GenerateOKRsgenerator=OKRGenerator()#GeneratecompanyOKRscompany_okrs=generator.generate_company_okrs(strategy,metrics)#Cascadetoproductproduct_okrs=generator.cascade_to_product(company_okrs)#Cascadetoteamsteam_okrs=generator.cascade_to_teams(product_okrs)#CombineallOKRsall_okrs={'company':company_okrs,'product':product_okrs,'teams':team_okrs}#Generatedashboarddashboard=generator.generate_okr_dashboard(all_okrs)print(dashboard)#Calculatealignmentalignment=generator.calculate_alignment_score(all_okrs)print("\n\nðŸŽ¯ALIGNMENTSCORES\n"+"-"*40)formetric,scoreinalignment.items():print(f"{metric.replace('_','').title()}:{score}%")#ExportasJSONifrequestediflen(sys.argv)>2andsys.argv[2]=='json':print("\n\nJSONOutput:")print(json.dumps(all_okrs,indent=2))if__name__=="__main__":main()