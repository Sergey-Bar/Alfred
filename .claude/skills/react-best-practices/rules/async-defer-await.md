---title:DeferAwaitUntilNeededimpact:HIGHimpactDescription:avoidsblockingunusedcodepathstags:async,await,conditional,optimization---##DeferAwaitUntilNeededMove`await`operationsintothebrancheswherethey'reactuallyusedtoavoidblockingcodepathsthatdon'tneedthem.**Incorrect(blocksbothbranches):**```typescriptasyncfunctionhandleRequest(userId:string,skipProcessing:boolean){constuserData=awaitfetchUserData(userId)if(skipProcessing){//ReturnsimmediatelybutstillwaitedforuserDatareturn{skipped:true}}//OnlythisbranchusesuserDatareturnprocessUserData(userData)}```**Correct(onlyblockswhenneeded):**```typescriptasyncfunctionhandleRequest(userId:string,skipProcessing:boolean){if(skipProcessing){//Returnsimmediatelywithoutwaitingreturn{skipped:true}}//FetchonlywhenneededconstuserData=awaitfetchUserData(userId)returnprocessUserData(userData)}```**Anotherexample(earlyreturnoptimization):**```typescript//Incorrect:alwaysfetchespermissionsasyncfunctionupdateResource(resourceId:string,userId:string){constpermissions=awaitfetchPermissions(userId)constresource=awaitgetResource(resourceId)if(!resource){return{error:'Notfound'}}if(!permissions.canEdit){return{error:'Forbidden'}}returnawaitupdateResourceData(resource,permissions)}//Correct:fetchesonlywhenneededasyncfunctionupdateResource(resourceId:string,userId:string){constresource=awaitgetResource(resourceId)if(!resource){return{error:'Notfound'}}constpermissions=awaitfetchPermissions(userId)if(!permissions.canEdit){return{error:'Forbidden'}}returnawaitupdateResourceData(resource,permissions)}```Thisoptimizationisespeciallyvaluablewhentheskippedbranchisfrequentlytaken,orwhenthedeferredoperationisexpensive.