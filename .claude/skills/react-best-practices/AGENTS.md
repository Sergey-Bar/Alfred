#ReactBestPractices**Version0.1.0**VercelEngineeringJanuary2026>**Note:**>ThisdocumentismainlyforagentsandLLMstofollowwhenmaintaining,>generating,orrefactoringReactandNext.jscodebasesatVercel.Humans>mayalsofindituseful,butguidancehereisoptimizedforautomation>andconsistencybyAI-assistedworkflows.---##AbstractComprehensiveperformanceoptimizationguideforReactandNext.jsapplications,designedforAIagentsandLLMs.Contains40+rulesacross8categories,prioritizedbyimpactfromcritical(eliminatingwaterfalls,reducingbundlesize)toincremental(advancedpatterns).Eachruleincludesdetailedexplanations,real-worldexamplescomparingincorrectvs.correctimplementations,andspecificimpactmetricstoguideautomatedrefactoringandcodegeneration.---##TableofContents1.[EliminatingWaterfalls](#1-eliminating-waterfalls)—**CRITICAL**-1.1[DeferAwaitUntilNeeded](#11-defer-await-until-needed)-1.2[Dependency-BasedParallelization](#12-dependency-based-parallelization)-1.3[PreventWaterfallChainsinAPIRoutes](#13-prevent-waterfall-chains-in-api-routes)-1.4[Promise.all()forIndependentOperations](#14-promiseall-for-independent-operations)-1.5[StrategicSuspenseBoundaries](#15-strategic-suspense-boundaries)2.[BundleSizeOptimization](#2-bundle-size-optimization)—**CRITICAL**-2.1[AvoidBarrelFileImports](#21-avoid-barrel-file-imports)-2.2[ConditionalModuleLoading](#22-conditional-module-loading)-2.3[DeferNon-CriticalThird-PartyLibraries](#23-defer-non-critical-third-party-libraries)-2.4[DynamicImportsforHeavyComponents](#24-dynamic-imports-for-heavy-components)-2.5[PreloadBasedonUserIntent](#25-preload-based-on-user-intent)3.[Server-SidePerformance](#3-server-side-performance)—**HIGH**-3.1[Cross-RequestLRUCaching](#31-cross-request-lru-caching)-3.2[MinimizeSerializationatRSCBoundaries](#32-minimize-serialization-at-rsc-boundaries)-3.3[ParallelDataFetchingwithComponentComposition](#33-parallel-data-fetching-with-component-composition)-3.4[Per-RequestDeduplicationwithReact.cache()](#34-per-request-deduplication-with-reactcache)-3.5[Useafter()forNon-BlockingOperations](#35-use-after-for-non-blocking-operations)4.[Client-SideDataFetching](#4-client-side-data-fetching)—**MEDIUM-HIGH**-4.1[DeduplicateGlobalEventListeners](#41-deduplicate-global-event-listeners)-4.2[UseSWRforAutomaticDeduplication](#42-use-swr-for-automatic-deduplication)5.[Re-renderOptimization](#5-re-render-optimization)—**MEDIUM**-5.1[DeferStateReadstoUsagePoint](#51-defer-state-reads-to-usage-point)-5.2[ExtracttoMemoizedComponents](#52-extract-to-memoized-components)-5.3[NarrowEffectDependencies](#53-narrow-effect-dependencies)-5.4[SubscribetoDerivedState](#54-subscribe-to-derived-state)-5.5[UseFunctionalsetStateUpdates](#55-use-functional-setstate-updates)-5.6[UseLazyStateInitialization](#56-use-lazy-state-initialization)-5.7[UseTransitionsforNon-UrgentUpdates](#57-use-transitions-for-non-urgent-updates)6.[RenderingPerformance](#6-rendering-performance)—**MEDIUM**-6.1[AnimateSVGWrapperInsteadofSVGElement](#61-animate-svg-wrapper-instead-of-svg-element)-6.2[CSScontent-visibilityforLongLists](#62-css-content-visibility-for-long-lists)-6.3[HoistStaticJSXElements](#63-hoist-static-jsx-elements)-6.4[OptimizeSVGPrecision](#64-optimize-svg-precision)-6.5[PreventHydrationMismatchWithoutFlickering](#65-prevent-hydration-mismatch-without-flickering)-6.6[UseActivityComponentforShow/Hide](#66-use-activity-component-for-showhide)-6.7[UseExplicitConditionalRendering](#67-use-explicit-conditional-rendering)7.[JavaScriptPerformance](#7-javascript-performance)—**LOW-MEDIUM**-7.1[BatchDOMCSSChanges](#71-batch-dom-css-changes)-7.2[BuildIndexMapsforRepeatedLookups](#72-build-index-maps-for-repeated-lookups)-7.3[CachePropertyAccessinLoops](#73-cache-property-access-in-loops)-7.4[CacheRepeatedFunctionCalls](#74-cache-repeated-function-calls)-7.5[CacheStorageAPICalls](#75-cache-storage-api-calls)-7.6[CombineMultipleArrayIterations](#76-combine-multiple-array-iterations)-7.7[EarlyLengthCheckforArrayComparisons](#77-early-length-check-for-array-comparisons)-7.8[EarlyReturnfromFunctions](#78-early-return-from-functions)-7.9[HoistRegExpCreation](#79-hoist-regexp-creation)-7.10[UseLoopforMin/MaxInsteadofSort](#710-use-loop-for-minmax-instead-of-sort)-7.11[UseSet/MapforO(1)Lookups](#711-use-setmap-for-o1-lookups)-7.12[UsetoSorted()Insteadofsort()forImmutability](#712-use-tosorted-instead-of-sort-for-immutability)8.[AdvancedPatterns](#8-advanced-patterns)—**LOW**-8.1[StoreEventHandlersinRefs](#81-store-event-handlers-in-refs)-8.2[useLatestforStableCallbackRefs](#82-uselatest-for-stable-callback-refs)---##1.EliminatingWaterfalls**Impact:CRITICAL**Waterfallsarethe#1performancekiller.Eachsequentialawaitaddsfullnetworklatency.Eliminatingthemyieldsthelargestgains.###1.1DeferAwaitUntilNeeded**Impact:HIGH(avoidsblockingunusedcodepaths)**Move`await`operationsintothebrancheswherethey'reactuallyusedtoavoidblockingcodepathsthatdon'tneedthem.**Incorrect:blocksbothbranches**```typescriptasyncfunctionhandleRequest(userId:string,skipProcessing:boolean){constuserData=awaitfetchUserData(userId)if(skipProcessing){//ReturnsimmediatelybutstillwaitedforuserDatareturn{skipped:true}}//OnlythisbranchusesuserDatareturnprocessUserData(userData)}```**Correct:onlyblockswhenneeded**```typescriptasyncfunctionhandleRequest(userId:string,skipProcessing:boolean){if(skipProcessing){//Returnsimmediatelywithoutwaitingreturn{skipped:true}}//FetchonlywhenneededconstuserData=awaitfetchUserData(userId)returnprocessUserData(userData)}```**Anotherexample:earlyreturnoptimization**```typescript//Incorrect:alwaysfetchespermissionsasyncfunctionupdateResource(resourceId:string,userId:string){constpermissions=awaitfetchPermissions(userId)constresource=awaitgetResource(resourceId)if(!resource){return{error:'Notfound'}}if(!permissions.canEdit){return{error:'Forbidden'}}returnawaitupdateResourceData(resource,permissions)}//Correct:fetchesonlywhenneededasyncfunctionupdateResource(resourceId:string,userId:string){constresource=awaitgetResource(resourceId)if(!resource){return{error:'Notfound'}}constpermissions=awaitfetchPermissions(userId)if(!permissions.canEdit){return{error:'Forbidden'}}returnawaitupdateResourceData(resource,permissions)}```Thisoptimizationisespeciallyvaluablewhentheskippedbranchisfrequentlytaken,orwhenthedeferredoperationisexpensive.###1.2Dependency-BasedParallelization**Impact:CRITICAL(2-10×improvement)**Foroperationswithpartialdependencies,use`better-all`tomaximizeparallelism.Itautomaticallystartseachtaskattheearliestpossiblemoment.**Incorrect:profilewaitsforconfigunnecessarily**```typescriptconst[user,config]=awaitPromise.all([fetchUser(),fetchConfig()])constprofile=awaitfetchProfile(user.id)```**Correct:configandprofileruninparallel**```typescriptimport{all}from'better-all'const{user,config,profile}=awaitall({asyncuser(){returnfetchUser()},asyncconfig(){returnfetchConfig()},asyncprofile(){returnfetchProfile((awaitthis.$.user).id)}})```Reference:[https://github.com/shuding/better-all](https://github.com/shuding/better-all)###1.3PreventWaterfallChainsinAPIRoutes**Impact:CRITICAL(2-10×improvement)**InAPIroutesandServerActions,startindependentoperationsimmediately,evenifyoudon'tawaitthemyet.**Incorrect:configwaitsforauth,datawaitsforboth**```typescriptexportasyncfunctionGET(request:Request){constsession=awaitauth()constconfig=awaitfetchConfig()constdata=awaitfetchData(session.user.id)returnResponse.json({data,config})}```**Correct:authandconfigstartimmediately**```typescriptexportasyncfunctionGET(request:Request){constsessionPromise=auth()constconfigPromise=fetchConfig()constsession=awaitsessionPromiseconst[config,data]=awaitPromise.all([configPromise,fetchData(session.user.id)])returnResponse.json({data,config})}```Foroperationswithmorecomplexdependencychains,use`better-all`toautomaticallymaximizeparallelism(seeDependency-BasedParallelization).###1.4Promise.all()forIndependentOperations**Impact:CRITICAL(2-10×improvement)**Whenasyncoperationshavenointerdependencies,executethemconcurrentlyusing`Promise.all()`.**Incorrect:sequentialexecution,3roundtrips**```typescriptconstuser=awaitfetchUser()constposts=awaitfetchPosts()constcomments=awaitfetchComments()```**Correct:parallelexecution,1roundtrip**```typescriptconst[user,posts,comments]=awaitPromise.all([fetchUser(),fetchPosts(),fetchComments()])```###1.5StrategicSuspenseBoundaries**Impact:HIGH(fasterinitialpaint)**InsteadofawaitingdatainasynccomponentsbeforereturningJSX,useSuspenseboundariestoshowthewrapperUIfasterwhiledataloads.**Incorrect:wrapperblockedbydatafetching**```tsxasyncfunctionPage(){constdata=awaitfetchData()//Blocksentirepagereturn(<div><div>Sidebar</div><div>Header</div><div><DataDisplaydata={data}/></div><div>Footer</div></div>)}```Theentirelayoutwaitsfordataeventhoughonlythemiddlesectionneedsit.**Correct:wrappershowsimmediately,datastreamsin**```tsxfunctionPage(){return(<div><div>Sidebar</div><div>Header</div><div><Suspensefallback={<Skeleton/>}><DataDisplay/></Suspense></div><div>Footer</div></div>)}asyncfunctionDataDisplay(){constdata=awaitfetchData()//Onlyblocksthiscomponentreturn<div>{data.content}</div>}```Sidebar,Header,andFooterrenderimmediately.OnlyDataDisplaywaitsfordata.**Alternative:sharepromiseacrosscomponents**```tsxfunctionPage(){//Startfetchimmediately,butdon'tawaitconstdataPromise=fetchData()return(<div><div>Sidebar</div><div>Header</div><Suspensefallback={<Skeleton/>}><DataDisplaydataPromise={dataPromise}/><DataSummarydataPromise={dataPromise}/></Suspense><div>Footer</div></div>)}functionDataDisplay({dataPromise}:{dataPromise:Promise<Data>}){constdata=use(dataPromise)//Unwrapsthepromisereturn<div>{data.content}</div>}functionDataSummary({dataPromise}:{dataPromise:Promise<Data>}){constdata=use(dataPromise)//Reusesthesamepromisereturn<div>{data.summary}</div>}```Bothcomponentssharethesamepromise,soonlyonefetchoccurs.Layoutrendersimmediatelywhilebothcomponentswaittogether.**WhenNOTtousethispattern:**-Criticaldataneededforlayoutdecisions(affectspositioning)-SEO-criticalcontentabovethefold-Small,fastquerieswheresuspenseoverheadisn'tworthit-Whenyouwanttoavoidlayoutshift(loading→contentjump)**Trade-off:**Fasterinitialpaintvspotentiallayoutshift.ChoosebasedonyourUXpriorities.---##2.BundleSizeOptimization**Impact:CRITICAL**ReducinginitialbundlesizeimprovesTimetoInteractiveandLargestContentfulPaint.###2.1AvoidBarrelFileImports**Impact:CRITICAL(200-800msimportcost,slowbuilds)**Importdirectlyfromsourcefilesinsteadofbarrelfilestoavoidloadingthousandsofunusedmodules.**Barrelfiles**areentrypointsthatre-exportmultiplemodules(e.g.,`index.js`thatdoes`export*from'./module'`).Populariconandcomponentlibrariescanhave**upto10,000re-exports**intheirentryfile.FormanyReactpackages,**ittakes200-800msjusttoimportthem**,affectingbothdevelopmentspeedandproductioncoldstarts.**Whytree-shakingdoesn'thelp:**Whenalibraryismarkedasexternal(notbundled),thebundlercan'toptimizeit.Ifyoubundleittoenabletree-shaking,buildsbecomesubstantiallysloweranalyzingtheentiremodulegraph.**Incorrect:importsentirelibrary**```tsximport{Check,X,Menu}from'lucide-react'//Loads1,583modules,takes~2.8sextraindev//Runtimecost:200-800msoneverycoldstartimport{Button,TextField}from'@mui/material'//Loads2,225modules,takes~4.2sextraindev```**Correct:importsonlywhatyouneed**```tsximportCheckfrom'lucide-react/dist/esm/icons/check'importXfrom'lucide-react/dist/esm/icons/x'importMenufrom'lucide-react/dist/esm/icons/menu'//Loadsonly3modules(~2KBvs~1MB)importButtonfrom'@mui/material/Button'importTextFieldfrom'@mui/material/TextField'//Loadsonlywhatyouuse```**Alternative:Next.js13.5+**```js//next.config.js-useoptimizePackageImportsmodule.exports={experimental:{optimizePackageImports:['lucide-react','@mui/material']}}//Thenyoucankeeptheergonomicbarrelimports:import{Check,X,Menu}from'lucide-react'//Automaticallytransformedtodirectimportsatbuildtime```Directimportsprovide15-70%fasterdevboot,28%fasterbuilds,40%fastercoldstarts,andsignificantlyfasterHMR.Librariescommonlyaffected:`lucide-react`,`@mui/material`,`@mui/icons-material`,`@tabler/icons-react`,`react-icons`,`@headlessui/react`,`@radix-ui/react-*`,`lodash`,`ramda`,`date-fns`,`rxjs`,`react-use`.Reference:[https://vercel.com/blog/how-we-optimized-package-imports-in-next-js](https://vercel.com/blog/how-we-optimized-package-imports-in-next-js)###2.2ConditionalModuleLoading**Impact:HIGH(loadslargedataonlywhenneeded)**Loadlargedataormodulesonlywhenafeatureisactivated.**Example:lazy-loadanimationframes**```tsxfunctionAnimationPlayer({enabled}:{enabled:boolean}){const[frames,setFrames]=useState<Frame[]|null>(null)useEffect(()=>{if(enabled&&!frames&&typeofwindow!=='undefined'){import('./animation-frames.js').then(mod=>setFrames(mod.frames)).catch(()=>setEnabled(false))}},[enabled,frames])if(!frames)return<Skeleton/>return<Canvasframes={frames}/>}```The`typeofwindow!=='undefined'`checkpreventsbundlingthismoduleforSSR,optimizingserverbundlesizeandbuildspeed.###2.3DeferNon-CriticalThird-PartyLibraries**Impact:MEDIUM(loadsafterhydration)**Analytics,logging,anderrortrackingdon'tblockuserinteraction.Loadthemafterhydration.**Incorrect:blocksinitialbundle**```tsximport{Analytics}from'@vercel/analytics/react'exportdefaultfunctionRootLayout({children}){return(<html><body>{children}<Analytics/></body></html>)}```**Correct:loadsafterhydration**```tsximportdynamicfrom'next/dynamic'constAnalytics=dynamic(()=>import('@vercel/analytics/react').then(m=>m.Analytics),{ssr:false})exportdefaultfunctionRootLayout({children}){return(<html><body>{children}<Analytics/></body></html>)}```###2.4DynamicImportsforHeavyComponents**Impact:CRITICAL(directlyaffectsTTIandLCP)**Use`next/dynamic`tolazy-loadlargecomponentsnotneededoninitialrender.**Incorrect:Monacobundleswithmainchunk~300KB**```tsximport{MonacoEditor}from'./monaco-editor'functionCodePanel({code}:{code:string}){return<MonacoEditorvalue={code}/>}```**Correct:Monacoloadsondemand**```tsximportdynamicfrom'next/dynamic'constMonacoEditor=dynamic(()=>import('./monaco-editor').then(m=>m.MonacoEditor),{ssr:false})functionCodePanel({code}:{code:string}){return<MonacoEditorvalue={code}/>}```###2.5PreloadBasedonUserIntent**Impact:MEDIUM(reducesperceivedlatency)**Preloadheavybundlesbeforethey'reneededtoreduceperceivedlatency.**Example:preloadonhover/focus**```tsxfunctionEditorButton({onClick}:{onClick:()=>void}){constpreload=()=>{if(typeofwindow!=='undefined'){voidimport('./monaco-editor')}}return(<buttononMouseEnter={preload}onFocus={preload}onClick={onClick}>OpenEditor</button>)}```**Example:preloadwhenfeatureflagisenabled**```tsxfunctionFlagsProvider({children,flags}:Props){useEffect(()=>{if(flags.editorEnabled&&typeofwindow!=='undefined'){voidimport('./monaco-editor').then(mod=>mod.init())}},[flags.editorEnabled])return<FlagsContext.Providervalue={flags}>{children}</FlagsContext.Provider>}```The`typeofwindow!=='undefined'`checkpreventsbundlingpreloadedmodulesforSSR,optimizingserverbundlesizeandbuildspeed.---##3.Server-SidePerformance**Impact:HIGH**Optimizingserver-siderenderinganddatafetchingeliminatesserver-sidewaterfallsandreducesresponsetimes.###3.1Cross-RequestLRUCaching**Impact:HIGH(cachesacrossrequests)**`React.cache()`onlyworkswithinonerequest.Fordatasharedacrosssequentialrequests(userclicksbuttonAthenbuttonB),useanLRUcache.**Implementation:**```typescriptimport{LRUCache}from'lru-cache'constcache=newLRUCache<string,any>({max:1000,ttl:5*60*1000//5minutes})exportasyncfunctiongetUser(id:string){constcached=cache.get(id)if(cached)returncachedconstuser=awaitdb.user.findUnique({where:{id}})cache.set(id,user)returnuser}//Request1:DBquery,resultcached//Request2:cachehit,noDBquery```Usewhensequentialuseractionshitmultipleendpointsneedingthesamedatawithinseconds.**WithVercel's[FluidCompute](https://vercel.com/docs/fluid-compute):**LRUcachingisespeciallyeffectivebecausemultipleconcurrentrequestscansharethesamefunctioninstanceandcache.ThismeansthecachepersistsacrossrequestswithoutneedingexternalstoragelikeRedis.**Intraditionalserverless:**Eachinvocationrunsinisolation,soconsiderRedisforcross-processcaching.Reference:[https://github.com/isaacs/node-lru-cache](https://github.com/isaacs/node-lru-cache)###3.2MinimizeSerializationatRSCBoundaries**Impact:HIGH(reducesdatatransfersize)**TheReactServer/ClientboundaryserializesallobjectpropertiesintostringsandembedsthemintheHTMLresponseandsubsequentRSCrequests.Thisserializeddatadirectlyimpactspageweightandloadtime,so**sizemattersalot**.Onlypassfieldsthattheclientactuallyuses.**Incorrect:serializesall50fields**```tsxasyncfunctionPage(){constuser=awaitfetchUser()//50fieldsreturn<Profileuser={user}/>}'useclient'functionProfile({user}:{user:User}){return<div>{user.name}</div>//uses1field}```**Correct:serializesonly1field**```tsxasyncfunctionPage(){constuser=awaitfetchUser()return<Profilename={user.name}/>}'useclient'functionProfile({name}:{name:string}){return<div>{name}</div>}```###3.3ParallelDataFetchingwithComponentComposition**Impact:CRITICAL(eliminatesserver-sidewaterfalls)**ReactServerComponentsexecutesequentiallywithinatree.Restructurewithcompositiontoparallelizedatafetching.**Incorrect:SidebarwaitsforPage'sfetchtocomplete**```tsxexportdefaultasyncfunctionPage(){constheader=awaitfetchHeader()return(<div><div>{header}</div><Sidebar/></div>)}asyncfunctionSidebar(){constitems=awaitfetchSidebarItems()return<nav>{items.map(renderItem)}</nav>}```**Correct:bothfetchsimultaneously**```tsxasyncfunctionHeader(){constdata=awaitfetchHeader()return<div>{data}</div>}asyncfunctionSidebar(){constitems=awaitfetchSidebarItems()return<nav>{items.map(renderItem)}</nav>}exportdefaultfunctionPage(){return(<div><Header/><Sidebar/></div>)}```**Alternativewithchildrenprop:**```tsxasyncfunctionLayout({children}:{children:ReactNode}){constheader=awaitfetchHeader()return(<div><div>{header}</div>{children}</div>)}asyncfunctionSidebar(){constitems=awaitfetchSidebarItems()return<nav>{items.map(renderItem)}</nav>}exportdefaultfunctionPage(){return(<Layout><Sidebar/></Layout>)}```###3.4Per-RequestDeduplicationwithReact.cache()**Impact:MEDIUM(deduplicateswithinrequest)**Use`React.cache()`forserver-siderequestdeduplication.Authenticationanddatabasequeriesbenefitmost.**Usage:**```typescriptimport{cache}from'react'exportconstgetCurrentUser=cache(async()=>{constsession=awaitauth()if(!session?.user?.id)returnnullreturnawaitdb.user.findUnique({where:{id:session.user.id}})})```Withinasinglerequest,multiplecallsto`getCurrentUser()`executethequeryonlyonce.###3.5Useafter()forNon-BlockingOperations**Impact:MEDIUM(fasterresponsetimes)**UseNext.js's`after()`toscheduleworkthatshouldexecuteafteraresponseissent.Thispreventslogging,analytics,andothersideeffectsfromblockingtheresponse.**Incorrect:blocksresponse**```tsximport{logUserAction}from'@/app/utils'exportasyncfunctionPOST(request:Request){//PerformmutationawaitupdateDatabase(request)//LoggingblockstheresponseconstuserAgent=request.headers.get('user-agent')||'unknown'awaitlogUserAction({userAgent})returnnewResponse(JSON.stringify({status:'success'}),{status:200,headers:{'Content-Type':'application/json'}})}```**Correct:non-blocking**```tsximport{after}from'next/server'import{headers,cookies}from'next/headers'import{logUserAction}from'@/app/utils'exportasyncfunctionPOST(request:Request){//PerformmutationawaitupdateDatabase(request)//Logafterresponseissentafter(async()=>{constuserAgent=(awaitheaders()).get('user-agent')||'unknown'constsessionCookie=(awaitcookies()).get('session-id')?.value||'anonymous'logUserAction({sessionCookie,userAgent})})returnnewResponse(JSON.stringify({status:'success'}),{status:200,headers:{'Content-Type':'application/json'}})}```Theresponseissentimmediatelywhilelogginghappensinthebackground.**Commonusecases:**-Analyticstracking-Auditlogging-Sendingnotifications-Cacheinvalidation-Cleanuptasks**Importantnotes:**-`after()`runseveniftheresponsefailsorredirects-WorksinServerActions,RouteHandlers,andServerComponentsReference:[https://nextjs.org/docs/app/api-reference/functions/after](https://nextjs.org/docs/app/api-reference/functions/after)---##4.Client-SideDataFetching**Impact:MEDIUM-HIGH**Automaticdeduplicationandefficientdatafetchingpatternsreduceredundantnetworkrequests.###4.1DeduplicateGlobalEventListeners**Impact:LOW(singlelistenerforNcomponents)**Use`useSWRSubscription()`toshareglobaleventlistenersacrosscomponentinstances.**Incorrect:Ninstances=Nlisteners**```tsxfunctionuseKeyboardShortcut(key:string,callback:()=>void){useEffect(()=>{consthandler=(e:KeyboardEvent)=>{if(e.metaKey&&e.key===key){callback()}}window.addEventListener('keydown',handler)return()=>window.removeEventListener('keydown',handler)},[key,callback])}```Whenusingthe`useKeyboardShortcut`hookmultipletimes,eachinstancewillregisteranewlistener.**Correct:Ninstances=1listener**```tsximportuseSWRSubscriptionfrom'swr/subscription'//Module-levelMaptotrackcallbacksperkeyconstkeyCallbacks=newMap<string,Set<()=>void>>()functionuseKeyboardShortcut(key:string,callback:()=>void){//RegisterthiscallbackintheMapuseEffect(()=>{if(!keyCallbacks.has(key)){keyCallbacks.set(key,newSet())}keyCallbacks.get(key)!.add(callback)return()=>{constset=keyCallbacks.get(key)if(set){set.delete(callback)if(set.size===0){keyCallbacks.delete(key)}}}},[key,callback])useSWRSubscription('global-keydown',()=>{consthandler=(e:KeyboardEvent)=>{if(e.metaKey&&keyCallbacks.has(e.key)){keyCallbacks.get(e.key)!.forEach(cb=>cb())}}window.addEventListener('keydown',handler)return()=>window.removeEventListener('keydown',handler)})}functionProfile(){//MultipleshortcutswillsharethesamelisteneruseKeyboardShortcut('p',()=>{/*...*/})useKeyboardShortcut('k',()=>{/*...*/})//...}```###4.2UseSWRforAutomaticDeduplication**Impact:MEDIUM-HIGH(automaticdeduplication)**SWRenablesrequestdeduplication,caching,andrevalidationacrosscomponentinstances.**Incorrect:nodeduplication,eachinstancefetches**```tsxfunctionUserList(){const[users,setUsers]=useState([])useEffect(()=>{fetch('/api/users').then(r=>r.json()).then(setUsers)},[])}```**Correct:multipleinstancesshareonerequest**```tsximportuseSWRfrom'swr'functionUserList(){const{data:users}=useSWR('/api/users',fetcher)}```**Forimmutabledata:**```tsximport{useImmutableSWR}from'@/lib/swr'functionStaticContent(){const{data}=useImmutableSWR('/api/config',fetcher)}```**Formutations:**```tsximport{useSWRMutation}from'swr/mutation'functionUpdateButton(){const{trigger}=useSWRMutation('/api/user',updateUser)return<buttononClick={()=>trigger()}>Update</button>}```Reference:[https://swr.vercel.app](https://swr.vercel.app)---##5.Re-renderOptimization**Impact:MEDIUM**Reducingunnecessaryre-rendersminimizeswastedcomputationandimprovesUIresponsiveness.###5.1DeferStateReadstoUsagePoint**Impact:MEDIUM(avoidsunnecessarysubscriptions)**Don'tsubscribetodynamicstate(searchParams,localStorage)ifyouonlyreaditinsidecallbacks.**Incorrect:subscribestoallsearchParamschanges**```tsxfunctionShareButton({chatId}:{chatId:string}){constsearchParams=useSearchParams()consthandleShare=()=>{constref=searchParams.get('ref')shareChat(chatId,{ref})}return<buttononClick={handleShare}>Share</button>}```**Correct:readsondemand,nosubscription**```tsxfunctionShareButton({chatId}:{chatId:string}){consthandleShare=()=>{constparams=newURLSearchParams(window.location.search)constref=params.get('ref')shareChat(chatId,{ref})}return<buttononClick={handleShare}>Share</button>}```###5.2ExtracttoMemoizedComponents**Impact:MEDIUM(enablesearlyreturns)**Extractexpensiveworkintomemoizedcomponentstoenableearlyreturnsbeforecomputation.**Incorrect:computesavatarevenwhenloading**```tsxfunctionProfile({user,loading}:Props){constavatar=useMemo(()=>{constid=computeAvatarId(user)return<Avatarid={id}/>},[user])if(loading)return<Skeleton/>return<div>{avatar}</div>}```**Correct:skipscomputationwhenloading**```tsxconstUserAvatar=memo(functionUserAvatar({user}:{user:User}){constid=useMemo(()=>computeAvatarId(user),[user])return<Avatarid={id}/>})functionProfile({user,loading}:Props){if(loading)return<Skeleton/>return(<div><UserAvataruser={user}/></div>)}```**Note:**Ifyourprojecthas[ReactCompiler](https://react.dev/learn/react-compiler)enabled,manualmemoizationwith`memo()`and`useMemo()`isnotnecessary.Thecompilerautomaticallyoptimizesre-renders.###5.3NarrowEffectDependencies**Impact:LOW(minimizeseffectre-runs)**Specifyprimitivedependenciesinsteadofobjectstominimizeeffectre-runs.**Incorrect:re-runsonanyuserfieldchange**```tsxuseEffect(()=>{console.log(user.id)},[user])```**Correct:re-runsonlywhenidchanges**```tsxuseEffect(()=>{console.log(user.id)},[user.id])```**Forderivedstate,computeoutsideeffect:**```tsx//Incorrect:runsonwidth=767,766,765...useEffect(()=>{if(width<768){enableMobileMode()}},[width])//Correct:runsonlyonbooleantransitionconstisMobile=width<768useEffect(()=>{if(isMobile){enableMobileMode()}},[isMobile])```###5.4SubscribetoDerivedState**Impact:MEDIUM(reducesre-renderfrequency)**Subscribetoderivedbooleanstateinsteadofcontinuousvaluestoreducere-renderfrequency.**Incorrect:re-rendersoneverypixelchange**```tsxfunctionSidebar(){constwidth=useWindowWidth()//updatescontinuouslyconstisMobile=width<768return<navclassName={isMobile?'mobile':'desktop'}>}```**Correct:re-rendersonlywhenbooleanchanges**```tsxfunctionSidebar(){constisMobile=useMediaQuery('(max-width:767px)')return<navclassName={isMobile?'mobile':'desktop'}>}```###5.5UseFunctionalsetStateUpdates**Impact:MEDIUM(preventsstaleclosuresandunnecessarycallbackrecreations)**Whenupdatingstatebasedonthecurrentstatevalue,usethefunctionalupdateformofsetStateinsteadofdirectlyreferencingthestatevariable.Thispreventsstaleclosures,eliminatesunnecessarydependencies,andcreatesstablecallbackreferences.**Incorrect:requiresstateasdependency**```tsxfunctionTodoList(){const[items,setItems]=useState(initialItems)//Callbackmustdependonitems,recreatedoneveryitemschangeconstaddItems=useCallback((newItems:Item[])=>{setItems([...items,...newItems])},[items])//❌itemsdependencycausesrecreations//RiskofstaleclosureifdependencyisforgottenconstremoveItem=useCallback((id:string)=>{setItems(items.filter(item=>item.id!==id))},[])//❌Missingitemsdependency-willusestaleitems!return<ItemsEditoritems={items}onAdd={addItems}onRemove={removeItem}/>}```Thefirstcallbackisrecreatedeverytime`items`changes,whichcancausechildcomponentstore-renderunnecessarily.Thesecondcallbackhasastaleclosurebug—itwillalwaysreferencetheinitial`items`value.**Correct:stablecallbacks,nostaleclosures**```tsxfunctionTodoList(){const[items,setItems]=useState(initialItems)//Stablecallback,neverrecreatedconstaddItems=useCallback((newItems:Item[])=>{setItems(curr=>[...curr,...newItems])},[])//✅Nodependenciesneeded//Alwaysuseslateststate,nostaleclosureriskconstremoveItem=useCallback((id:string)=>{setItems(curr=>curr.filter(item=>item.id!==id))},[])//✅Safeandstablereturn<ItemsEditoritems={items}onAdd={addItems}onRemove={removeItem}/>}```**Benefits:**1.**Stablecallbackreferences**-Callbacksdon'tneedtoberecreatedwhenstatechanges2.**Nostaleclosures**-Alwaysoperatesonthelateststatevalue3.**Fewerdependencies**-Simplifiesdependencyarraysandreducesmemoryleaks4.**Preventsbugs**-EliminatesthemostcommonsourceofReactclosurebugs**Whentousefunctionalupdates:**-AnysetStatethatdependsonthecurrentstatevalue-InsideuseCallback/useMemowhenstateisneeded-Eventhandlersthatreferencestate-Asyncoperationsthatupdatestate**Whendirectupdatesarefine:**-Settingstatetoastaticvalue:`setCount(0)`-Settingstatefromprops/argumentsonly:`setName(newName)`-Statedoesn'tdependonpreviousvalue**Note:**Ifyourprojecthas[ReactCompiler](https://react.dev/learn/react-compiler)enabled,thecompilercanautomaticallyoptimizesomecases,butfunctionalupdatesarestillrecommendedforcorrectnessandtopreventstaleclosurebugs.###5.6UseLazyStateInitialization**Impact:MEDIUM(wastedcomputationoneveryrender)**Passafunctionto`useState`forexpensiveinitialvalues.Withoutthefunctionform,theinitializerrunsoneveryrendereventhoughthevalueisonlyusedonce.**Incorrect:runsoneveryrender**```tsxfunctionFilteredList({items}:{items:Item[]}){//buildSearchIndex()runsonEVERYrender,evenafterinitializationconst[searchIndex,setSearchIndex]=useState(buildSearchIndex(items))const[query,setQuery]=useState('')//Whenquerychanges,buildSearchIndexrunsagainunnecessarilyreturn<SearchResultsindex={searchIndex}query={query}/>}functionUserProfile(){//JSON.parserunsoneveryrenderconst[settings,setSettings]=useState(JSON.parse(localStorage.getItem('settings')||'{}'))return<SettingsFormsettings={settings}onChange={setSettings}/>}```**Correct:runsonlyonce**```tsxfunctionFilteredList({items}:{items:Item[]}){//buildSearchIndex()runsONLYoninitialrenderconst[searchIndex,setSearchIndex]=useState(()=>buildSearchIndex(items))const[query,setQuery]=useState('')return<SearchResultsindex={searchIndex}query={query}/>}functionUserProfile(){//JSON.parserunsonlyoninitialrenderconst[settings,setSettings]=useState(()=>{conststored=localStorage.getItem('settings')returnstored?JSON.parse(stored):{}})return<SettingsFormsettings={settings}onChange={setSettings}/>}```UselazyinitializationwhencomputinginitialvaluesfromlocalStorage/sessionStorage,buildingdatastructures(indexes,maps),readingfromtheDOM,orperformingheavytransformations.Forsimpleprimitives(`useState(0)`),directreferences(`useState(props.value)`),orcheapliterals(`useState({})`),thefunctionformisunnecessary.###5.7UseTransitionsforNon-UrgentUpdates**Impact:MEDIUM(maintainsUIresponsiveness)**Markfrequent,non-urgentstateupdatesastransitionstomaintainUIresponsiveness.**Incorrect:blocksUIoneveryscroll**```tsxfunctionScrollTracker(){const[scrollY,setScrollY]=useState(0)useEffect(()=>{consthandler=()=>setScrollY(window.scrollY)window.addEventListener('scroll',handler,{passive:true})return()=>window.removeEventListener('scroll',handler)},[])}```**Correct:non-blockingupdates**```tsximport{startTransition}from'react'functionScrollTracker(){const[scrollY,setScrollY]=useState(0)useEffect(()=>{consthandler=()=>{startTransition(()=>setScrollY(window.scrollY))}window.addEventListener('scroll',handler,{passive:true})return()=>window.removeEventListener('scroll',handler)},[])}```---##6.RenderingPerformance**Impact:MEDIUM**Optimizingtherenderingprocessreducestheworkthebrowserneedstodo.###6.1AnimateSVGWrapperInsteadofSVGElement**Impact:LOW(enableshardwareacceleration)**Manybrowsersdon'thavehardwareaccelerationforCSS3animationsonSVGelements.WrapSVGina`<div>`andanimatethewrapperinstead.**Incorrect:animatingSVGdirectly-nohardwareacceleration**```tsxfunctionLoadingSpinner(){return(<svgclassName="animate-spin"width="24"height="24"viewBox="002424"><circlecx="12"cy="12"r="10"stroke="currentColor"/></svg>)}```**Correct:animatingwrapperdiv-hardwareaccelerated**```tsxfunctionLoadingSpinner(){return(<divclassName="animate-spin"><svgwidth="24"height="24"viewBox="002424"><circlecx="12"cy="12"r="10"stroke="currentColor"/></svg></div>)}```ThisappliestoallCSStransformsandtransitions(`transform`,`opacity`,`translate`,`scale`,`rotate`).ThewrapperdivallowsbrowserstouseGPUaccelerationforsmootheranimations.###6.2CSScontent-visibilityforLongLists**Impact:HIGH(fasterinitialrender)**Apply`content-visibility:auto`todeferoff-screenrendering.**CSS:**```css.message-item{content-visibility:auto;contain-intrinsic-size:080px;}```**Example:**```tsxfunctionMessageList({messages}:{messages:Message[]}){return(<divclassName="overflow-y-autoh-screen">{messages.map(msg=>(<divkey={msg.id}className="message-item"><Avataruser={msg.author}/><div>{msg.content}</div></div>))}</div>)}```For1000messages,browserskipslayout/paintfor~990off-screenitems(10×fasterinitialrender).###6.3HoistStaticJSXElements**Impact:LOW(avoidsre-creation)**ExtractstaticJSXoutsidecomponentstoavoidre-creation.**Incorrect:recreateselementeveryrender**```tsxfunctionLoadingSkeleton(){return<divclassName="animate-pulseh-20bg-gray-200"/>}functionContainer(){return(<div>{loading&&<LoadingSkeleton/>}</div>)}```**Correct:reusessameelement**```tsxconstloadingSkeleton=(<divclassName="animate-pulseh-20bg-gray-200"/>)functionContainer(){return(<div>{loading&&loadingSkeleton}</div>)}```ThisisespeciallyhelpfulforlargeandstaticSVGnodes,whichcanbeexpensivetorecreateoneveryrender.**Note:**Ifyourprojecthas[ReactCompiler](https://react.dev/learn/react-compiler)enabled,thecompilerautomaticallyhoistsstaticJSXelementsandoptimizescomponentre-renders,makingmanualhoistingunnecessary.###6.4OptimizeSVGPrecision**Impact:LOW(reducesfilesize)**ReduceSVGcoordinateprecisiontodecreasefilesize.TheoptimalprecisiondependsontheviewBoxsize,butingeneralreducingprecisionshouldbeconsidered.**Incorrect:excessiveprecision**```svg<pathd="M10.29384720.847362L30.93847240.192837"/>```**Correct:1decimalplace**```svg<pathd="M10.320.8L30.940.2"/>```**AutomatewithSVGO:**```bashnpxsvgo--precision=1--multipassicon.svg```###6.5PreventHydrationMismatchWithoutFlickering**Impact:MEDIUM(avoidsvisualflickerandhydrationerrors)**Whenrenderingcontentthatdependsonclient-sidestorage(localStorage,cookies),avoidbothSSRbreakageandpost-hydrationflickeringbyinjectingasynchronousscriptthatupdatestheDOMbeforeReacthydrates.**Incorrect:breaksSSR**```tsxfunctionThemeWrapper({children}:{children:ReactNode}){//localStorageisnotavailableonserver-throwserrorconsttheme=localStorage.getItem('theme')||'light'return(<divclassName={theme}>{children}</div>)}```Server-siderenderingwillfailbecause`localStorage`isundefined.**Incorrect:visualflickering**```tsxfunctionThemeWrapper({children}:{children:ReactNode}){const[theme,setTheme]=useState('light')useEffect(()=>{//Runsafterhydration-causesvisibleflashconststored=localStorage.getItem('theme')if(stored){setTheme(stored)}},[])return(<divclassName={theme}>{children}</div>)}```Componentfirstrenderswithdefaultvalue(`light`),thenupdatesafterhydration,causingavisibleflashofincorrectcontent.**Correct:noflicker,nohydrationmismatch**```tsxfunctionThemeWrapper({children}:{children:ReactNode}){return(<><divid="theme-wrapper">{children}</div><scriptdangerouslySetInnerHTML={{__html:`(function(){try{vartheme=localStorage.getItem('theme')||'light';varel=document.getElementById('theme-wrapper');if(el)el.className=theme;}catch(e){}})();`,}}/></>)}```Theinlinescriptexecutessynchronouslybeforeshowingtheelement,ensuringtheDOMalreadyhasthecorrectvalue.Noflickering,nohydrationmismatch.Thispatternisespeciallyusefulforthemetoggles,userpreferences,authenticationstates,andanyclient-onlydatathatshouldrenderimmediatelywithoutflashingdefaultvalues.###6.6UseActivityComponentforShow/Hide**Impact:MEDIUM(preservesstate/DOM)**UseReact's`<Activity>`topreservestate/DOMforexpensivecomponentsthatfrequentlytogglevisibility.**Usage:**```tsximport{Activity}from'react'functionDropdown({isOpen}:Props){return(<Activitymode={isOpen?'visible':'hidden'}><ExpensiveMenu/></Activity>)}```Avoidsexpensivere-rendersandstateloss.###6.7UseExplicitConditionalRendering**Impact:LOW(preventsrendering0orNaN)**Useexplicitternaryoperators(`?:`)insteadof`&&`forconditionalrenderingwhentheconditioncanbe`0`,`NaN`,orotherfalsyvaluesthatrender.**Incorrect:renders"0"whencountis0**```tsxfunctionBadge({count}:{count:number}){return(<div>{count&&<spanclassName="badge">{count}</span>}</div>)}//Whencount=0,renders:<div>0</div>//Whencount=5,renders:<div><spanclass="badge">5</span></div>```**Correct:rendersnothingwhencountis0**```tsxfunctionBadge({count}:{count:number}){return(<div>{count>0?<spanclassName="badge">{count}</span>:null}</div>)}//Whencount=0,renders:<div></div>//Whencount=5,renders:<div><spanclass="badge">5</span></div>```---##7.JavaScriptPerformance**Impact:LOW-MEDIUM**Micro-optimizationsforhotpathscanadduptomeaningfulimprovements.###7.1BatchDOMCSSChanges**Impact:MEDIUM(reducesreflows/repaints)**Avoidchangingstylesonepropertyatatime.GroupmultipleCSSchangestogetherviaclassesor`cssText`tominimizebrowserreflows.**Incorrect:multiplereflows**```typescriptfunctionupdateElementStyles(element:HTMLElement){//Eachlinetriggersareflowelement.style.width='100px'element.style.height='200px'element.style.backgroundColor='blue'element.style.border='1pxsolidblack'}```**Correct:addclass-singlereflow**```typescript//CSSfile.highlighted-box{width:100px;height:200px;background-color:blue;border:1pxsolidblack;}//JavaScriptfunctionupdateElementStyles(element:HTMLElement){element.classList.add('highlighted-box')}```**Correct:changecssText-singlereflow**```typescriptfunctionupdateElementStyles(element:HTMLElement){element.style.cssText=`width:100px;height:200px;background-color:blue;border:1pxsolidblack;`}```**Reactexample:**```tsx//Incorrect:changingstylesonebyonefunctionBox({isHighlighted}:{isHighlighted:boolean}){constref=useRef<HTMLDivElement>(null)useEffect(()=>{if(ref.current&&isHighlighted){ref.current.style.width='100px'ref.current.style.height='200px'ref.current.style.backgroundColor='blue'}},[isHighlighted])return<divref={ref}>Content</div>}//Correct:toggleclassfunctionBox({isHighlighted}:{isHighlighted:boolean}){return(<divclassName={isHighlighted?'highlighted-box':''}>Content</div>)}```PreferCSSclassesoverinlinestyleswhenpossible.Classesarecachedbythebrowserandprovidebetterseparationofconcerns.###7.2BuildIndexMapsforRepeatedLookups**Impact:LOW-MEDIUM(1Mopsto2Kops)**Multiple`.find()`callsbythesamekeyshoulduseaMap.**Incorrect(O(n)perlookup):**```typescriptfunctionprocessOrders(orders:Order[],users:User[]){returnorders.map(order=>({...order,user:users.find(u=>u.id===order.userId)}))}```**Correct(O(1)perlookup):**```typescriptfunctionprocessOrders(orders:Order[],users:User[]){constuserById=newMap(users.map(u=>[u.id,u]))returnorders.map(order=>({...order,user:userById.get(order.userId)}))}```Buildmaponce(O(n)),thenalllookupsareO(1).For1000orders×1000users:1Mops→2Kops.###7.3CachePropertyAccessinLoops**Impact:LOW-MEDIUM(reduceslookups)**Cacheobjectpropertylookupsinhotpaths.**Incorrect:3lookups×Niterations**```typescriptfor(leti=0;i<arr.length;i++){process(obj.config.settings.value)}```**Correct:1lookuptotal**```typescriptconstvalue=obj.config.settings.valueconstlen=arr.lengthfor(leti=0;i<len;i++){process(value)}```###7.4CacheRepeatedFunctionCalls**Impact:MEDIUM(avoidredundantcomputation)**Useamodule-levelMaptocachefunctionresultswhenthesamefunctioniscalledrepeatedlywiththesameinputsduringrender.**Incorrect:redundantcomputation**```typescriptfunctionProjectList({projects}:{projects:Project[]}){return(<div>{projects.map(project=>{//slugify()called100+timesforsameprojectnamesconstslug=slugify(project.name)return<ProjectCardkey={project.id}slug={slug}/>})}</div>)}```**Correct:cachedresults**```typescript//Module-levelcacheconstslugifyCache=newMap<string,string>()functioncachedSlugify(text:string):string{if(slugifyCache.has(text)){returnslugifyCache.get(text)!}constresult=slugify(text)slugifyCache.set(text,result)returnresult}functionProjectList({projects}:{projects:Project[]}){return(<div>{projects.map(project=>{//Computedonlyonceperuniqueprojectnameconstslug=cachedSlugify(project.name)return<ProjectCardkey={project.id}slug={slug}/>})}</div>)}```**Simplerpatternforsingle-valuefunctions:**```typescriptletisLoggedInCache:boolean|null=nullfunctionisLoggedIn():boolean{if(isLoggedInCache!==null){returnisLoggedInCache}isLoggedInCache=document.cookie.includes('auth=')returnisLoggedInCache}//ClearcachewhenauthchangesfunctiononAuthChange(){isLoggedInCache=null}```UseaMap(notahook)soitworkseverywhere:utilities,eventhandlers,notjustReactcomponents.Reference:[https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast](https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast)###7.5CacheStorageAPICalls**Impact:LOW-MEDIUM(reducesexpensiveI/O)**`localStorage`,`sessionStorage`,and`document.cookie`aresynchronousandexpensive.Cachereadsinmemory.**Incorrect:readsstorageoneverycall**```typescriptfunctiongetTheme(){returnlocalStorage.getItem('theme')??'light'}//Called10times=10storagereads```**Correct:Mapcache**```typescriptconststorageCache=newMap<string,string|null>()functiongetLocalStorage(key:string){if(!storageCache.has(key)){storageCache.set(key,localStorage.getItem(key))}returnstorageCache.get(key)}functionsetLocalStorage(key:string,value:string){localStorage.setItem(key,value)storageCache.set(key,value)//keepcacheinsync}```UseaMap(notahook)soitworkseverywhere:utilities,eventhandlers,notjustReactcomponents.**Cookiecaching:**```typescriptletcookieCache:Record<string,string>|null=nullfunctiongetCookie(name:string){if(!cookieCache){cookieCache=Object.fromEntries(document.cookie.split(';').map(c=>c.split('=')))}returncookieCache[name]}```**Important:invalidateonexternalchanges**```typescriptwindow.addEventListener('storage',(e)=>{if(e.key)storageCache.delete(e.key)})document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'){storageCache.clear()}})```Ifstoragecanchangeexternally(anothertab,server-setcookies),invalidatecache:###7.6CombineMultipleArrayIterations**Impact:LOW-MEDIUM(reducesiterations)**Multiple`.filter()`or`.map()`callsiteratethearraymultipletimes.Combineintooneloop.**Incorrect:3iterations**```typescriptconstadmins=users.filter(u=>u.isAdmin)consttesters=users.filter(u=>u.isTester)constinactive=users.filter(u=>!u.isActive)```**Correct:1iteration**```typescriptconstadmins:User[]=[]consttesters:User[]=[]constinactive:User[]=[]for(constuserofusers){if(user.isAdmin)admins.push(user)if(user.isTester)testers.push(user)if(!user.isActive)inactive.push(user)}```###7.7EarlyLengthCheckforArrayComparisons**Impact:MEDIUM-HIGH(avoidsexpensiveoperationswhenlengthsdiffer)**Whencomparingarrayswithexpensiveoperations(sorting,deepequality,serialization),checklengthsfirst.Iflengthsdiffer,thearrayscannotbeequal.Inreal-worldapplications,thisoptimizationisespeciallyvaluablewhenthecomparisonrunsinhotpaths(eventhandlers,renderloops).**Incorrect:alwaysrunsexpensivecomparison**```typescriptfunctionhasChanges(current:string[],original:string[]){//Alwayssortsandjoins,evenwhenlengthsdifferreturncurrent.sort().join()!==original.sort().join()}```TwoO(nlogn)sortsrunevenwhen`current.length`is5and`original.length`is100.Thereisalsooverheadofjoiningthearraysandcomparingthestrings.**Correct(O(1)lengthcheckfirst):**```typescriptfunctionhasChanges(current:string[],original:string[]){//Earlyreturniflengthsdifferif(current.length!==original.length){returntrue}//Onlysort/joinwhenlengthsmatchconstcurrentSorted=current.toSorted()constoriginalSorted=original.toSorted()for(leti=0;i<currentSorted.length;i++){if(currentSorted[i]!==originalSorted[i]){returntrue}}returnfalse}```Thisnewapproachismoreefficientbecause:-Itavoidstheoverheadofsortingandjoiningthearrayswhenlengthsdiffer-Itavoidsconsumingmemoryforthejoinedstrings(especiallyimportantforlargearrays)-Itavoidsmutatingtheoriginalarrays-Itreturnsearlywhenadifferenceisfound###7.8EarlyReturnfromFunctions**Impact:LOW-MEDIUM(avoidsunnecessarycomputation)**Returnearlywhenresultisdeterminedtoskipunnecessaryprocessing.**Incorrect:processesallitemsevenafterfindinganswer**```typescriptfunctionvalidateUsers(users:User[]){lethasError=falseleterrorMessage=''for(constuserofusers){if(!user.email){hasError=trueerrorMessage='Emailrequired'}if(!user.name){hasError=trueerrorMessage='Namerequired'}//Continuescheckingallusersevenaftererrorfound}returnhasError?{valid:false,error:errorMessage}:{valid:true}}```**Correct:returnsimmediatelyonfirsterror**```typescriptfunctionvalidateUsers(users:User[]){for(constuserofusers){if(!user.email){return{valid:false,error:'Emailrequired'}}if(!user.name){return{valid:false,error:'Namerequired'}}}return{valid:true}}```###7.9HoistRegExpCreation**Impact:LOW-MEDIUM(avoidsrecreation)**Don'tcreateRegExpinsiderender.Hoisttomodulescopeormemoizewith`useMemo()`.**Incorrect:newRegExpeveryrender**```tsxfunctionHighlighter({text,query}:Props){constregex=newRegExp(`(${query})`,'gi')constparts=text.split(regex)return<>{parts.map((part,i)=>...)}</>}```**Correct:memoizeorhoist**```tsxconstEMAIL_REGEX=/^[^\s@]+@[^\s@]+\.[^\s@]+$/functionHighlighter({text,query}:Props){constregex=useMemo(()=>newRegExp(`(${escapeRegex(query)})`,'gi'),[query])constparts=text.split(regex)return<>{parts.map((part,i)=>...)}</>}```**Warning:globalregexhasmutablestate**```typescriptconstregex=/foo/gregex.test('foo')//true,lastIndex=3regex.test('foo')//false,lastIndex=0```Globalregex(`/g`)hasmutable`lastIndex`state:###7.10UseLoopforMin/MaxInsteadofSort**Impact:LOW(O(n)insteadofO(nlogn))**Findingthesmallestorlargestelementonlyrequiresasinglepassthroughthearray.Sortingiswastefulandslower.**Incorrect(O(nlogn)-sorttofindlatest):**```typescriptinterfaceProject{id:stringname:stringupdatedAt:number}functiongetLatestProject(projects:Project[]){constsorted=[...projects].sort((a,b)=>b.updatedAt-a.updatedAt)returnsorted[0]}```Sortstheentirearrayjusttofindthemaximumvalue.**Incorrect(O(nlogn)-sortforoldestandnewest):**```typescriptfunctiongetOldestAndNewest(projects:Project[]){constsorted=[...projects].sort((a,b)=>a.updatedAt-b.updatedAt)return{oldest:sorted[0],newest:sorted[sorted.length-1]}}```Stillsortsunnecessarilywhenonlymin/maxareneeded.**Correct(O(n)-singleloop):**```typescriptfunctiongetLatestProject(projects:Project[]){if(projects.length===0)returnnullletlatest=projects[0]for(leti=1;i<projects.length;i++){if(projects[i].updatedAt>latest.updatedAt){latest=projects[i]}}returnlatest}functiongetOldestAndNewest(projects:Project[]){if(projects.length===0)return{oldest:null,newest:null}letoldest=projects[0]letnewest=projects[0]for(leti=1;i<projects.length;i++){if(projects[i].updatedAt<oldest.updatedAt)oldest=projects[i]if(projects[i].updatedAt>newest.updatedAt)newest=projects[i]}return{oldest,newest}}```Singlepassthroughthearray,nocopying,nosorting.**Alternative:Math.min/Math.maxforsmallarrays**```typescriptconstnumbers=[5,2,8,1,9]constmin=Math.min(...numbers)constmax=Math.max(...numbers)```Thisworksforsmallarraysbutcanbeslowerforverylargearraysduetospreadoperatorlimitations.Usetheloopapproachforreliability.###7.11UseSet/MapforO(1)Lookups**Impact:LOW-MEDIUM(O(n)toO(1))**ConvertarraystoSet/Mapforrepeatedmembershipchecks.**Incorrect(O(n)percheck):**```typescriptconstallowedIds=['a','b','c',...]items.filter(item=>allowedIds.includes(item.id))```**Correct(O(1)percheck):**```typescriptconstallowedIds=newSet(['a','b','c',...])items.filter(item=>allowedIds.has(item.id))```###7.12UsetoSorted()Insteadofsort()forImmutability**Impact:MEDIUM-HIGH(preventsmutationbugsinReactstate)**`.sort()`mutatesthearrayinplace,whichcancausebugswithReactstateandprops.Use`.toSorted()`tocreateanewsortedarraywithoutmutation.**Incorrect:mutatesoriginalarray**```typescriptfunctionUserList({users}:{users:User[]}){//Mutatestheusersproparray!constsorted=useMemo(()=>users.sort((a,b)=>a.name.localeCompare(b.name)),[users])return<div>{sorted.map(renderUser)}</div>}```**Correct:createsnewarray**```typescriptfunctionUserList({users}:{users:User[]}){//Createsnewsortedarray,originalunchangedconstsorted=useMemo(()=>users.toSorted((a,b)=>a.name.localeCompare(b.name)),[users])return<div>{sorted.map(renderUser)}</div>}```**WhythismattersinReact:**1.Props/statemutationsbreakReact'simmutabilitymodel-Reactexpectspropsandstatetobetreatedasread-only2.Causesstaleclosurebugs-Mutatingarraysinsideclosures(callbacks,effects)canleadtounexpectedbehavior**Browsersupport:fallbackforolderbrowsers**```typescript//Fallbackforolderbrowsersconstsorted=[...items].sort((a,b)=>a.value-b.value)````.toSorted()`isavailableinallmodernbrowsers(Chrome110+,Safari16+,Firefox115+,Node.js20+).Forolderenvironments,usespreadoperator:**Otherimmutablearraymethods:**-`.toSorted()`-immutablesort-`.toReversed()`-immutablereverse-`.toSpliced()`-immutablesplice-`.with()`-immutableelementreplacement---##8.AdvancedPatterns**Impact:LOW**Advancedpatternsforspecificcasesthatrequirecarefulimplementation.###8.1StoreEventHandlersinRefs**Impact:LOW(stablesubscriptions)**Storecallbacksinrefswhenusedineffectsthatshouldn'tre-subscribeoncallbackchanges.**Incorrect:re-subscribesoneveryrender**```tsxfunctionuseWindowEvent(event:string,handler:()=>void){useEffect(()=>{window.addEventListener(event,handler)return()=>window.removeEventListener(event,handler)},[event,handler])}```**Correct:stablesubscription**```tsximport{useEffectEvent}from'react'functionuseWindowEvent(event:string,handler:()=>void){constonEvent=useEffectEvent(handler)useEffect(()=>{window.addEventListener(event,onEvent)return()=>window.removeEventListener(event,onEvent)},[event])}```**Alternative:use`useEffectEvent`ifyou'reonlatestReact:**`useEffectEvent`providesacleanerAPIforthesamepattern:itcreatesastablefunctionreferencethatalwayscallsthelatestversionofthehandler.###8.2useLatestforStableCallbackRefs**Impact:LOW(preventseffectre-runs)**Accesslatestvaluesincallbackswithoutaddingthemtodependencyarrays.Preventseffectre-runswhileavoidingstaleclosures.**Implementation:**```typescriptfunctionuseLatest<T>(value:T){constref=useRef(value)useEffect(()=>{ref.current=value},[value])returnref}```**Incorrect:effectre-runsoneverycallbackchange**```tsxfunctionSearchInput({onSearch}:{onSearch:(q:string)=>void}){const[query,setQuery]=useState('')useEffect(()=>{consttimeout=setTimeout(()=>onSearch(query),300)return()=>clearTimeout(timeout)},[query,onSearch])}```**Correct:stableeffect,freshcallback**```tsxfunctionSearchInput({onSearch}:{onSearch:(q:string)=>void}){const[query,setQuery]=useState('')constonSearchRef=useLatest(onSearch)useEffect(()=>{consttimeout=setTimeout(()=>onSearchRef.current(query),300)return()=>clearTimeout(timeout)},[query])}```---##References1.[https://react.dev](https://react.dev)2.[https://nextjs.org](https://nextjs.org)3.[https://swr.vercel.app](https://swr.vercel.app)4.[https://github.com/shuding/better-all](https://github.com/shuding/better-all)5.[https://github.com/isaacs/node-lru-cache](https://github.com/isaacs/node-lru-cache)6.[https://vercel.com/blog/how-we-optimized-package-imports-in-next-js](https://vercel.com/blog/how-we-optimized-package-imports-in-next-js)7.[https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast](https://vercel.com/blog/how-we-made-the-vercel-dashboard-twice-as-fast)