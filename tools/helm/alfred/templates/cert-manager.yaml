#AlfredCertificateManagerResources#{{-if.Values.certManager.enabled}}---#───Let'sEncryptStagingIssuer(fortesting)─────────────apiVersion:cert-manager.io/v1kind:ClusterIssuermetadata:name:{{include"alfred.fullname".}}-letsencrypt-staginglabels:{{-include"alfred.labels".|nindent4}}app.kubernetes.io/component:tlsspec:acme:server:https://acme-staging-v02.api.letsencrypt.org/directoryemail:{{.Values.certManager.email}}privateKeySecretRef:name:{{include"alfred.fullname".}}-letsencrypt-staging-keysolvers:{{-if.Values.certManager.dns01.enabled}}-dns01:{{-if.Values.certManager.dns01.route53.enabled}}route53:region:{{.Values.certManager.dns01.route53.region}}{{-if.Values.certManager.dns01.route53.hostedZoneID}}hostedZoneID:{{.Values.certManager.dns01.route53.hostedZoneID}}{{-end}}{{-end}}{{-if.Values.certManager.dns01.cloudflare.enabled}}cloudflare:apiTokenSecretRef:name:{{include"alfred.fullname".}}-cloudflare-tokenkey:api-token{{-end}}{{-else}}-http01:ingress:class:{{.Values.ingress.className}}{{-end}}---#───Let'sEncryptProductionIssuer────────────────────────apiVersion:cert-manager.io/v1kind:ClusterIssuermetadata:name:{{include"alfred.fullname".}}-letsencrypt-prodlabels:{{-include"alfred.labels".|nindent4}}app.kubernetes.io/component:tlsspec:acme:server:https://acme-v02.api.letsencrypt.org/directoryemail:{{.Values.certManager.email}}privateKeySecretRef:name:{{include"alfred.fullname".}}-letsencrypt-prod-keysolvers:{{-if.Values.certManager.dns01.enabled}}-dns01:{{-if.Values.certManager.dns01.route53.enabled}}route53:region:{{.Values.certManager.dns01.route53.region}}{{-if.Values.certManager.dns01.route53.hostedZoneID}}hostedZoneID:{{.Values.certManager.dns01.route53.hostedZoneID}}{{-end}}{{-end}}{{-if.Values.certManager.dns01.cloudflare.enabled}}cloudflare:apiTokenSecretRef:name:{{include"alfred.fullname".}}-cloudflare-tokenkey:api-token{{-end}}{{-else}}-http01:ingress:class:{{.Values.ingress.className}}{{-end}}---#───AlfredTLSCertificate─────────────────────────────────apiVersion:cert-manager.io/v1kind:Certificatemetadata:name:{{include"alfred.fullname".}}-tlsnamespace:{{.Release.Namespace}}labels:{{-include"alfred.labels".|nindent4}}app.kubernetes.io/component:tlsspec:secretName:{{.Values.certManager.secretName|default"alfred-tls"}}issuerRef:name:{{include"alfred.fullname".}}-letsencrypt-{{.Values.certManager.issuerStage|default"prod"}}kind:ClusterIssuer#Renewalwindow:renew30daysbeforeexpiry(defaultLEcerts=90days)renewBefore:{{.Values.certManager.renewBefore|default"720h"}}duration:{{.Values.certManager.duration|default"2160h"}}#DNSnamescoveredbythiscertificatednsNames:{{-range.Values.certManager.dnsNames}}-{{.}}{{-end}}#Privatekeysettings—enforceECDSAP-256forTLS1.3performanceprivateKey:algorithm:ECDSAsize:256rotationPolicy:Always#OCSPstaplingandusageusages:-serverauth-clientauth---#───InternalmTLSCertificate(service-to-service)─────────{{-if.Values.certManager.mtls.enabled}}apiVersion:cert-manager.io/v1kind:Certificatemetadata:name:{{include"alfred.fullname".}}-mtls-gatewaynamespace:{{.Release.Namespace}}labels:{{-include"alfred.labels".|nindent4}}app.kubernetes.io/component:mtlsspec:secretName:{{include"alfred.fullname".}}-mtls-gatewayissuerRef:name:{{include"alfred.fullname".}}-internal-cakind:Issuerduration:720h#30daysrenewBefore:168h#Renew7daysbeforeexpirydnsNames:-{{include"alfred.fullname".}}-gateway-{{include"alfred.fullname".}}-gateway.{{.Release.Namespace}}.svc-{{include"alfred.fullname".}}-gateway.{{.Release.Namespace}}.svc.cluster.localprivateKey:algorithm:ECDSAsize:256rotationPolicy:Alwaysusages:-serverauth-clientauth---apiVersion:cert-manager.io/v1kind:Certificatemetadata:name:{{include"alfred.fullname".}}-mtls-backendnamespace:{{.Release.Namespace}}labels:{{-include"alfred.labels".|nindent4}}app.kubernetes.io/component:mtlsspec:secretName:{{include"alfred.fullname".}}-mtls-backendissuerRef:name:{{include"alfred.fullname".}}-internal-cakind:Issuerduration:720hrenewBefore:168hdnsNames:-{{include"alfred.fullname".}}-backend-{{include"alfred.fullname".}}-backend.{{.Release.Namespace}}.svc-{{include"alfred.fullname".}}-backend.{{.Release.Namespace}}.svc.cluster.localprivateKey:algorithm:ECDSAsize:256rotationPolicy:Alwaysusages:-serverauth-clientauth---#Self-signedCAforinternalmTLSapiVersion:cert-manager.io/v1kind:Issuermetadata:name:{{include"alfred.fullname".}}-internal-canamespace:{{.Release.Namespace}}labels:{{-include"alfred.labels".|nindent4}}spec:ca:secretName:{{include"alfred.fullname".}}-internal-ca-key---#Self-signedrootfortheinternalCAapiVersion:cert-manager.io/v1kind:Certificatemetadata:name:{{include"alfred.fullname".}}-internal-canamespace:{{.Release.Namespace}}labels:{{-include"alfred.labels".|nindent4}}spec:isCA:trueduration:87600h#10yearsrenewBefore:8760h#1yearbeforesecretName:{{include"alfred.fullname".}}-internal-ca-keycommonName:alfred-internal-caprivateKey:algorithm:ECDSAsize:256issuerRef:name:{{include"alfred.fullname".}}-selfsignkind:Issuer---apiVersion:cert-manager.io/v1kind:Issuermetadata:name:{{include"alfred.fullname".}}-selfsignnamespace:{{.Release.Namespace}}spec:selfSigned:{}{{-end}}{{-end}}