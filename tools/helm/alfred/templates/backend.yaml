#AlfredBackendDeployment#apiVersion:apps/v1kind:Deploymentmetadata:name:{{include"alfred.fullname".}}-backendlabels:{{-include"alfred.backend.labels".|nindent4}}spec:{{-ifnot.Values.backend.autoscaling.enabled}}replicas:{{.Values.backend.replicaCount}}{{-end}}selector:matchLabels:{{-include"alfred.backend.selectorLabels".|nindent6}}template:metadata:annotations:checksum/config:{{include(print$.Template.BasePath"/configmap.yaml").|sha256sum}}labels:{{-include"alfred.backend.selectorLabels".|nindent8}}spec:{{-with.Values.global.imagePullSecrets}}imagePullSecrets:{{-toYaml.|nindent8}}{{-end}}serviceAccountName:{{include"alfred.serviceAccountName".}}securityContext:{{-toYaml.Values.podSecurityContext|nindent8}}containers:-name:backendsecurityContext:{{-toYaml.Values.securityContext|nindent12}}image:"{{.Values.global.imageRegistry}}{{.Values.backend.image.repository}}:{{.Values.backend.image.tag}}"imagePullPolicy:{{.Values.backend.image.pullPolicy}}ports:-name:httpcontainerPort:8000protocol:TCPenv:-name:DATABASE_URLvalueFrom:secretKeyRef:name:{{include"alfred.fullname".}}-secretskey:database-url-name:REDIS_URLvalueFrom:secretKeyRef:name:{{include"alfred.fullname".}}-secretskey:redis-url-name:JWT_SECRETvalueFrom:secretKeyRef:name:{{include"alfred.fullname".}}-secretskey:jwt-secret{{-range$key,$value:=.Values.backend.env}}-name:{{$key}}value:{{$value|quote}}{{-end}}livenessProbe:{{-toYaml.Values.backend.livenessProbe|nindent12}}readinessProbe:{{-toYaml.Values.backend.readinessProbe|nindent12}}resources:{{-toYaml.Values.backend.resources|nindent12}}volumeMounts:-name:tmpmountPath:/tmpvolumes:-name:tmpemptyDir:{}{{-with.Values.nodeSelector}}nodeSelector:{{-toYaml.|nindent8}}{{-end}}{{-with.Values.affinity}}affinity:{{-toYaml.|nindent8}}{{-end}}{{-with.Values.tolerations}}tolerations:{{-toYaml.|nindent8}}{{-end}}---apiVersion:v1kind:Servicemetadata:name:{{include"alfred.fullname".}}-backendlabels:{{-include"alfred.backend.labels".|nindent4}}spec:type:{{.Values.backend.service.type}}ports:-port:{{.Values.backend.service.port}}targetPort:httpprotocol:TCPname:httpselector:{{-include"alfred.backend.selectorLabels".|nindent4}}---{{-if.Values.backend.autoscaling.enabled}}apiVersion:autoscaling/v2kind:HorizontalPodAutoscalermetadata:name:{{include"alfred.fullname".}}-backendlabels:{{-include"alfred.backend.labels".|nindent4}}spec:scaleTargetRef:apiVersion:apps/v1kind:Deploymentname:{{include"alfred.fullname".}}-backendminReplicas:{{.Values.backend.autoscaling.minReplicas}}maxReplicas:{{.Values.backend.autoscaling.maxReplicas}}metrics:-type:Resourceresource:name:cputarget:type:UtilizationaverageUtilization:{{.Values.backend.autoscaling.targetCPUUtilizationPercentage}}-type:Resourceresource:name:memorytarget:type:UtilizationaverageUtilization:{{.Values.backend.autoscaling.targetMemoryUtilizationPercentage}}{{-end}}