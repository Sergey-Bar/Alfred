"usestrict";var__createBinding=(this&&this.__createBinding)||(Object.create?(function(o,m,k,k2){if(k2===undefined)k2=k;vardesc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"indesc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){returnm[k];}};}Object.defineProperty(o,k2,desc);}):(function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];}));var__setModuleDefault=(this&&this.__setModuleDefault)||(Object.create?(function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v});}):function(o,v){o["default"]=v;});var__importStar=(this&&this.__importStar)||function(mod){if(mod&&mod.__esModule)returnmod;varresult={};if(mod!=null)for(varkinmod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);returnresult;};Object.defineProperty(exports,"__esModule",{value:true});exports.activateSidebar=void0;constvscode=__importStar(require("vscode"));consthttps=require('https');consthttp=require('http');functionactivateSidebar(context){constviewType='alfredSidebar';context.subscriptions.push(vscode.window.registerWebviewViewProvider(viewType,newSidebarProvider(context)));//Registerrefreshcommandcontext.subscriptions.push(vscode.commands.registerCommand('alfred.refreshTransferHistory',()=>{//Findtheactivewebviewandrefreshit//Thiswillbehandledbytheprovider}));}exports.activateSidebar=activateSidebar;classSidebarProvider{constructor(context){this.context=context;}resolveWebviewView(webviewView){this.webviewView=webviewView;webviewView.webview.options={enableScripts:true,localResourceRoots:[this.context.extensionUri]};webviewView.webview.html=this.getHtmlContent();//HandlemessagesfromthewebviewwebviewView.webview.onDidReceiveMessage(async(message)=>{switch(message.type){case'refresh':awaitthis.refreshTransferHistory();break;case'error':vscode.window.showErrorMessage(`Alfred:${message.message}`);break;}},undefined,this.context.subscriptions);//Initialloadthis.refreshTransferHistory();}asyncrefreshTransferHistory(){if(!this.webviewView)return;try{constconfig=vscode.workspace.getConfiguration('alfred');constapiUrl=config.get('apiUrl','http://localhost:8000');constapiKey=config.get('apiKey');if(!apiKey){this.webviewView.webview.postMessage({type:'error',message:'APIkeynotconfigured.Pleasesetalfred.apiKeyinsettings.'});return;}consturl=newURL(`${apiUrl}/v1/governance/users/me/transfers`);constdata=awaitthis.makeHttpRequest(url,apiKey);this.webviewView.webview.postMessage({type:'transfers',data:data.transfers||[]});}catch(error){this.webviewView.webview.postMessage({type:'error',message:errorinstanceofError?error.message:'Unknownerroroccurred'});}}asyncmakeHttpRequest(url,apiKey){returnnewPromise((resolve,reject)=>{constisHttps=url.protocol==='https:';constclient=isHttps?https:http;constoptions={hostname:url.hostname,port:url.port||(isHttps?443:80),path:url.pathname+url.search,method:'GET',headers:{'Authorization':`Bearer${apiKey}`,'Content-Type':'application/json','User-Agent':'Alfred-VSCode-Extension/1.0'}};constreq=client.request(options,(res)=>{letbody='';res.on('data',(chunk)=>{body+=chunk;});res.on('end',()=>{if(res.statusCode&&res.statusCode>=200&&res.statusCode<300){try{resolve(JSON.parse(body));}catch(e){reject(newError('InvalidJSONresponse'));}}else{reject(newError(`HTTP${res.statusCode}:${body}`));}});});req.on('error',(err)=>{reject(err);});req.setTimeout(10000,()=>{req.destroy();reject(newError('Requesttimeout'));});req.end();});}getHtmlContent(){constnonce=getNonce();return`<!DOCTYPEhtml><htmllang="en"><head><metacharset="UTF-8"><metaname="viewport"content="width=device-width,initial-scale=1.0"><metahttp-equiv="Content-Security-Policy"content="default-src'none';style-src'unsafe-inline';script-src'nonce-${nonce}';"><title>AlfredTransferHistory</title><style>body{font-family:var(--vscode-font-family);font-size:var(--vscode-font-size);background-color:var(--vscode-editor-background);color:var(--vscode-editor-foreground);margin:0;padding:10px;}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}.title{font-weight:bold;font-size:1.1em;}.refresh-btn{background:none;border:none;color:var(--vscode-foreground);cursor:pointer;padding:2px;}.refresh-btn:hover{color:var(--vscode-textLink-foreground);}.transfer-item{border:1pxsolidvar(--vscode-panel-border);border-radius:3px;padding:8px;margin-bottom:8px;background-color:var(--vscode-input-background);}.transfer-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}.transfer-type{font-weight:bold;padding:2px6px;border-radius:3px;font-size:0.9em;}.transfer-type.sent{background-color:var(--vscode-notificationsErrorIcon-foreground);color:white;}.transfer-type.received{background-color:var(--vscode-notificationsInfoIcon-foreground);color:white;}.transfer-amount{font-weight:bold;color:var(--vscode-textLink-foreground);}.transfer-user{color:var(--vscode-descriptionForeground);font-size:0.9em;}.transfer-message{margin-top:4px;font-style:italic;color:var(--vscode-descriptionForeground);}.transfer-timestamp{font-size:0.8em;color:var(--vscode-descriptionForeground);margin-top:4px;}.loading{text-align:center;padding:20px;color:var(--vscode-descriptionForeground);}.error{color:var(--vscode-notificationsErrorIcon-foreground);padding:10px;border:1pxsolidvar(--vscode-notificationsErrorIcon-foreground);border-radius:3px;margin-bottom:10px;}.empty{text-align:center;padding:20px;color:var(--vscode-descriptionForeground);}</style></head><body><divclass="header"><divclass="title">TransferHistory</div><buttonclass="refresh-btn"onclick="refresh()"title="Refresh">&#x21bb;</button></div><divid="content"><divclass="loading">Loadingtransferhistory...</div></div><scriptnonce="${nonce}">constvscode=acquireVsCodeApi();lettransfers=[];functionrefresh(){vscode.postMessage({type:'refresh'});document.getElementById('content').innerHTML='<divclass="loading">Loadingtransferhistory...</div>';}functionformatTimestamp(timestamp){constdate=newDate(timestamp);returndate.toLocaleString();}functionformatAmount(amount){returnparseFloat(amount).toFixed(2);}functionrenderTransfers(transferData){if(!transferData||transferData.length===0){return'<divclass="empty">Notransfersfound</div>';}returntransferData.map(transfer=>\`<divclass="transfer-item"><divclass="transfer-header"><spanclass="transfer-type\${transfer.type}">\${transfer.type.toUpperCase()}</span><spanclass="transfer-amount">\${formatAmount(transfer.amount)}credits</span></div><divclass="transfer-user">\${transfer.other_user.name}(\${transfer.other_user.email})</div>\${transfer.message?\`<divclass="transfer-message">\${transfer.message}</div>\`:''}<divclass="transfer-timestamp">\${formatTimestamp(transfer.timestamp)}</div></div>\`).join('');}functionrenderError(message){return\`<divclass="error">\${message}</div>\`;}window.addEventListener('message',event=>{constmessage=event.data;constcontent=document.getElementById('content');switch(message.type){case'transfers':content.innerHTML=renderTransfers(message.data);break;case'error':content.innerHTML=renderError(message.message);break;}});//Initialloadrefresh();</script></body></html>`;}}functiongetNonce(){lettext='';constpossible='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';for(leti=0;i<32;i++){text+=possible.charAt(Math.floor(Math.random()*possible.length));}returntext;}//#sourceMappingURL=sidebar.js.map