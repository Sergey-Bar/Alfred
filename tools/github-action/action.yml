#AlfredGitHubAction-AICostGate#name:"AlfredCostGate"description:"EnforceAIcostbudgetsandquotasinyourCI/CDpipeline"author:"AlfredAI"branding:icon:"shield"color:"blue"inputs:api-key:description:"AlfredAPIkey"required:trueapi-url:description:"AlfredAPIURL"required:falsedefault:"https://api.alfred.ai"budget-limit:description:"Maximumcostallowedforthisrun(USD)"required:falsedefault:"5.00"fail-on-exceeded:description:"Failtheworkflowifbudgetisexceeded"required:falsedefault:"true"check-balance:description:"Checkwalletbalancebeforeproceeding"required:falsedefault:"true"min-balance:description:"Minimumrequiredbalancetoproceed(USD)"required:falsedefault:"1.00"report-usage:description:"PostusagereportasPRcomment"required:falsedefault:"true"outputs:balance:description:"Currentwalletbalance"run-cost:description:"CostofAIoperationsinthisrun"budget-remaining:description:"Remainingbudgetforthisrun"status:description:"Gatestatus(passed/failed/warning)"runs:using:"composite"steps:-name:CheckAlfredBalanceif:inputs.check-balance=='true'shell:bashenv:ALFRED_API_KEY:${{inputs.api-key}}ALFRED_API_URL:${{inputs.api-url}}MIN_BALANCE:${{inputs.min-balance}}run:|echo"üîçCheckingAlfredwalletbalance..."RESPONSE=$(curl-s-w"\n%{http_code}"\-H"Authorization:Bearer$ALFRED_API_KEY"\-H"Content-Type:application/json"\"$ALFRED_API_URL/v1/wallets/me")HTTP_CODE=$(echo"$RESPONSE"|tail-1)BODY=$(echo"$RESPONSE"|sed'$d')if["$HTTP_CODE"!="200"];thenecho"‚ùåFailedtocheckbalance:$BODY"exit1fiBALANCE=$(echo"$BODY"|jq-r'.balance//0')echo"üí∞Currentbalance:\$$BALANCE"#Comparebalancetominimumif(($(echo"$BALANCE<$MIN_BALANCE"|bc-l)));thenecho"‚ùåInsufficientbalance:\$$BALANCE<\$$MIN_BALANCErequired"exit1fiecho"balance=$BALANCE">>$GITHUB_OUTPUTecho"‚úÖBalancecheckpassed"-name:InitializeCostTrackingshell:bashenv:ALFRED_API_KEY:${{inputs.api-key}}ALFRED_API_URL:${{inputs.api-url}}run:|echo"üìäInitializingcosttrackingforrun$GITHUB_RUN_ID..."#Storestarttimestampecho"ALFRED_RUN_START=$(date-u+%Y-%m-%dT%H:%M:%SZ)">>$GITHUB_ENVecho"ALFRED_RUN_ID=$GITHUB_RUN_ID">>$GITHUB_ENV#GetstartingbalanceforcostcalculationRESPONSE=$(curl-s\-H"Authorization:Bearer$ALFRED_API_KEY"\"$ALFRED_API_URL/v1/wallets/me")START_BALANCE=$(echo"$RESPONSE"|jq-r'.balance//0')echo"ALFRED_START_BALANCE=$START_BALANCE">>$GITHUB_ENVecho"‚úÖCosttrackinginitialized"-name:SetBudgetEnvironmentshell:bashrun:|echo"ALFRED_BUDGET_LIMIT=${{inputs.budget-limit}}">>$GITHUB_ENVecho"ALFRED_FAIL_ON_EXCEEDED=${{inputs.fail-on-exceeded}}">>$GITHUB_ENV