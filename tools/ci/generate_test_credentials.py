"""Generate`tests/fixtures/credentials.py`fromenvironmentvariables.Usage:CIpipelinesshouldsetrequiredsecretsasenvironmentvariablesandinvokethisscriptbeforerunningtests.ThegeneratedfileshouldNOTbecommittedtosourcecontrol."""importjsonimportloggingimportosimportsysfrompathlibimportPathlogger=logging.getLogger(__name__)DEFAULT_KEYS=["TEST_ADMIN_PASSWORD","TEST_PASSWORD","TEST_API_KEY","ADMIN_PASSWORD","API_KEY",]defmain()->None:out_dir=Path("tests/fixtures")out_dir.mkdir(parents=True,exist_ok=True)out_file=out_dir/"credentials.py"keys_env=os.getenv("TEST_CREDENTIAL_KEYS")ifkeys_env:keys=[k.strip()forkinkeys_env.split(",")ifk.strip()]else:keys=DEFAULT_KEYScreds={k:os.getenv(k)forkinkeysifos.getenv(k)}ifnotcreds:logger.warning("Nocredentialsfoundinenvironment.Nofilewillbecreated.")ifout_file.exists():out_file.unlink()sys.exit(0)without_file.open("w",encoding="utf-8")asf:f.write("#Auto-generatedbydev/ci/generate_test_credentials.py-DONOTCOMMITthisfile\n")f.write("#ProvidesecretsviaCIorlocalenvvars.\n")f.write("CREDENTIALS=")json.dump(creds,f,indent=4)f.write("\n")logger.info("Wrotecredentialsto%s",out_file)if__name__=="__main__":main()