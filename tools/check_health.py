"""SimplescripttoverifytheFastAPIapphealthandtestDBvisibility.Run:`pythontools/check_health.py`"""importosfrompathlibimportPathfromfastapi.testclientimportTestClient#Ensurereposervices/backendisonpathwhenscriptisexecutedfromreporootroot=Path(__file__).resolve().parents[2]src_backend=root/"services"/"backend"importsysifstr(src_backend)notinsys.path:sys.path.insert(0,str(src_backend))#Preferafile-backedtestDBsobothappandfixturescanobserveitwhenusedinCItmp=Path(root)/".pytest_tmp"tmp.mkdir(exist_ok=True)os.environ.setdefault("DATABASE_URL",f"sqlite:///{tmp/'health_check.db'}")os.environ.setdefault("ENVIRONMENT","test")try:importapp.mainasmainexceptExceptionase:print("Failedtoimportapp.main:",e)raiseclient=TestClient(main.app)#Ensuretablesexistontheapplication'sengineforameaningfulusers_countchecktry:fromsqlmodelimportSQLModelimportapp.databaseas_app_dbSQLModel.metadata.create_all(_app_db.engine)exceptExceptionas_:passforpathin("/health","/test/users_count"):resp=client.get(path)print(path,resp.status_code,resp.text)