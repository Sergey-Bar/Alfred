# Penetration Testing Preparation Guide

[AI GENERATED - GOVERNANCE PROTOCOL]
──────────────────────────────────────────────────────────────
Model: Claude Opus 4.6
Tier: L2
Logic: Comprehensive pentest preparation documentation.
Root Cause: Sprint task T196 — Pentest preparation document.
Context: Prepares Alfred for third-party security assessment.
Suitability: L2 — Standard security documentation.
──────────────────────────────────────────────────────────────

## Executive Summary

This document prepares Alfred for penetration testing by third-party security assessors. It covers scope, methodology, credentials, and expected test areas.

## 1. Scope Definition

### 1.1 In-Scope Components

| Component          | URL/Endpoint                   | Description                   |
| ------------------ | ------------------------------ | ----------------------------- |
| Frontend Dashboard | `https://app.alfred.ai`        | React SPA for user management |
| Backend API        | `https://api.alfred.ai/v1/*`   | FastAPI REST endpoints        |
| Gateway Proxy      | `https://proxy.alfred.ai/v1/*` | Go gateway for AI routing     |
| WebSocket          | `wss://api.alfred.ai/ws/*`     | Real-time notifications       |
| Authentication     | OAuth2/JWT endpoints           | SSO and API key auth          |

### 1.2 Out-of-Scope

- Third-party LLM provider APIs (OpenAI, Anthropic, etc.)
- Cloud infrastructure (AWS/GCP root access)
- Physical security
- Social engineering against employees

### 1.3 Testing Windows

| Environment | Window             | Notes                         |
| ----------- | ------------------ | ----------------------------- |
| Staging     | 24/7               | Full testing allowed          |
| Production  | Tue-Thu 2-6 AM UTC | Limited, non-destructive only |

## 2. Test Credentials

### 2.1 Test Accounts

| Role         | Email                          | Purpose                  |
| ------------ | ------------------------------ | ------------------------ |
| Super Admin  | `pentest-admin@alfred.ai`      | Full platform access     |
| Team Admin   | `pentest-team-admin@alfred.ai` | Team management          |
| Regular User | `pentest-user@alfred.ai`       | Standard user access     |
| Read-Only    | `pentest-readonly@alfred.ai`   | Minimal permissions      |
| Expired User | `pentest-expired@alfred.ai`    | Disabled account testing |

> **Note:** Credentials will be provided via secure channel (1Password or similar)

### 2.2 API Keys

API keys for each role will be provisioned with appropriate scopes:

```
ak_pentest_admin_xxxxx    - all scopes
ak_pentest_user_xxxxx     - read, completions
ak_pentest_readonly_xxxxx - read only
ak_pentest_revoked_xxxxx  - revoked key for testing
```

### 2.3 Test Wallets

Each test account has a dedicated wallet with:

- Balance: $1,000.00 test credits
- Hard limit: $2,000.00
- Soft limit: $500.00

## 3. Testing Areas

### 3.1 Authentication & Authorization

| Test ID  | Description                                    | Priority |
| -------- | ---------------------------------------------- | -------- |
| AUTH-001 | JWT token validation and expiry                | Critical |
| AUTH-002 | API key authentication bypass attempts         | Critical |
| AUTH-003 | SSO/OAuth2 flow manipulation                   | Critical |
| AUTH-004 | Role escalation between user/admin/super_admin | Critical |
| AUTH-005 | Session fixation and hijacking                 | High     |
| AUTH-006 | Concurrent session handling                    | Medium   |
| AUTH-007 | Password reset token security                  | High     |
| AUTH-008 | MFA bypass attempts                            | Critical |

### 3.2 API Security

| Test ID | Description                                     | Priority |
| ------- | ----------------------------------------------- | -------- |
| API-001 | Input validation and injection (SQLi, XSS)      | Critical |
| API-002 | Rate limiting effectiveness                     | High     |
| API-003 | IDOR vulnerabilities in resource access         | Critical |
| API-004 | Mass assignment vulnerabilities                 | High     |
| API-005 | API versioning security                         | Medium   |
| API-006 | GraphQL introspection/injection (if applicable) | High     |
| API-007 | File upload validation                          | High     |
| API-008 | Error message information disclosure            | Medium   |

### 3.3 Business Logic

| Test ID | Description                          | Priority |
| ------- | ------------------------------------ | -------- |
| BIZ-001 | Credit manipulation and double-spend | Critical |
| BIZ-002 | Wallet balance race conditions       | Critical |
| BIZ-003 | Transfer approval bypass             | Critical |
| BIZ-004 | Quota enforcement bypass             | High     |
| BIZ-005 | Policy/rule bypass attempts          | High     |
| BIZ-006 | Experiment manipulation              | Medium   |
| BIZ-007 | Audit log tampering                  | Critical |

### 3.4 Data Protection

| Test ID  | Description                     | Priority |
| -------- | ------------------------------- | -------- |
| DATA-001 | PII exposure in logs/responses  | Critical |
| DATA-002 | API key exposure                | Critical |
| DATA-003 | Provider credentials exposure   | Critical |
| DATA-004 | GDPR data access/deletion       | High     |
| DATA-005 | Data residency enforcement      | High     |
| DATA-006 | Encryption at rest verification | High     |
| DATA-007 | Encryption in transit (TLS)     | Critical |

### 3.5 Infrastructure

| Test ID   | Description               | Priority |
| --------- | ------------------------- | -------- |
| INFRA-001 | Container escape attempts | Critical |
| INFRA-002 | Network segmentation      | High     |
| INFRA-003 | Secret management (Vault) | Critical |
| INFRA-004 | CI/CD pipeline security   | High     |
| INFRA-005 | Kubernetes RBAC           | High     |

## 4. Rules of Engagement

### 4.1 Permitted Actions

- All non-destructive testing techniques
- Automated scanning with rate limiting
- Manual exploitation of discovered vulnerabilities
- Social engineering simulation (pre-approved only)

### 4.2 Prohibited Actions

- Denial of Service attacks
- Data destruction
- Accessing data of real users
- Testing third-party provider APIs
- Lateral movement to non-scoped systems

### 4.3 Communication

| Contact       | Role          | Email              | Phone           |
| ------------- | ------------- | ------------------ | --------------- |
| Sergey Bar    | Security Lead | sergey@alfred.ai   | +1-xxx-xxx-xxxx |
| Security Team | On-call       | security@alfred.ai | -               |

**Emergency Contact:** For critical findings, contact immediately via Signal or encrypted email.

## 5. Reporting Requirements

### 5.1 Finding Classification

| Severity      | CVSS     | Response SLA |
| ------------- | -------- | ------------ |
| Critical      | 9.0-10.0 | 24 hours     |
| High          | 7.0-8.9  | 72 hours     |
| Medium        | 4.0-6.9  | 7 days       |
| Low           | 0.1-3.9  | 30 days      |
| Informational | N/A      | Next release |

### 5.2 Report Contents

Each finding should include:

- Unique identifier (e.g., ALFRED-2024-001)
- CVSS score and vector
- Affected component(s)
- Steps to reproduce
- Proof of concept (non-destructive)
- Recommended remediation
- References (CWE, OWASP, etc.)

### 5.3 Deliverables

1. **Daily Status Report** - Summary of testing activities
2. **Draft Report** - Within 5 business days of completion
3. **Final Report** - After Alfred review and confirmation
4. **Executive Summary** - Non-technical overview

## 6. Environment Details

### 6.1 Architecture Overview

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Client    │────▶│   Gateway   │────▶│   Backend   │
│  (Browser)  │     │    (Go)     │     │  (FastAPI)  │
└─────────────┘     └─────────────┘     └─────────────┘
                           │                   │
                           ▼                   ▼
                    ┌─────────────┐     ┌─────────────┐
                    │    Redis    │     │ PostgreSQL  │
                    │   (Cache)   │     │  (Database) │
                    └─────────────┘     └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ LLM Providers│
                    │ (OpenAI,    │
                    │  Anthropic) │
                    └─────────────┘
```

### 6.2 Technology Stack

| Layer    | Technology         | Version |
| -------- | ------------------ | ------- |
| Frontend | React + Vite       | 19.x    |
| Backend  | FastAPI + SQLModel | 0.0.x   |
| Gateway  | Go + Chi           | 1.21+   |
| Database | PostgreSQL         | 15.x    |
| Cache    | Redis              | 7.x     |
| Auth     | JWT + OAuth2       | -       |
| Secrets  | HashiCorp Vault    | 1.x     |

### 6.3 Key Endpoints

See `docs/api_documentation.md` for full OpenAPI specification.

## 7. Security Controls in Place

### 7.1 Current Protections

- JWT with RS256 signing
- API key hashing with Argon2
- Rate limiting (100 req/min default)
- CORS with strict origins
- CSP headers on frontend
- Input validation via Pydantic
- SQL injection prevention via ORM
- Audit logging with hash chains

### 7.2 Known Limitations

Document any known issues or temporary bypasses here for tester awareness.

## 8. Appendix

### A. Regulatory Context

- SOC 2 Type II (In Progress)
- GDPR (EU Data Residency)
- PCI DSS (Not applicable — no payment processing)

### B. Previous Assessment Findings

_No previous third-party assessments conducted._

### C. Change Log

| Date       | Version | Author        | Changes          |
| ---------- | ------- | ------------- | ---------------- |
| 2024-01-XX | 1.0     | Security Team | Initial document |

---

**Classification:** Confidential — For Authorized Pentest Team Only
