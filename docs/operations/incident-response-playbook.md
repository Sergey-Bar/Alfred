#AlfredIncidentResponsePlaybook>**Classification:**Internal—OperationsCritical>**Owner:**SergeyBar+SREOn-call>**ReviewCycle:**Monthlyreview,semi-annualdrill>**Version:**2.0|**LastUpdated:**2026-02-20---##TableofContents1.[GeneralIncidentProcess](#1-general-incident-process)2.[SeverityClassification](#2-severity-classification)3.[IncidentScenarios(15)](#3-incident-scenarios)-[INC-01:DatabaseUnreachable](#inc-01-database-unreachable)-[INC-02:LLMProviderDown(Single)](#inc-02-llm-provider-down-single)-[INC-03:LLMProviderDown(Multiple/All)](#inc-03-llm-provider-down-multiple--all)-[INC-04:GatewayLatencySpike(P95>150ms)](#inc-04-gateway-latency-spike-p95--150ms)-[INC-05:Redis/CacheFailure](#inc-05-redis--cache-failure)-[INC-06:AuthenticationSystemFailure](#inc-06-authentication-system-failure)-[INC-07:Quota/WalletHardLimitExhaustion(Mass)](#inc-07-quota--wallet-hard-limit-exhaustion-mass)-[INC-08:CreditLeakage/Double-Spend](#inc-08-credit-leakage--double-spend)-[INC-09:AuditLogChainBreak](#inc-09-audit-log-chain-break)-[INC-10:APIRateLimitStorm](#inc-10-api-rate-limit-storm)-[INC-11:MemoryLeak/OOM](#inc-11-memory-leak--oom)-[INC-12:DeploymentFailure/BadRelease](#inc-12-deployment-failure--bad-release)-[INC-13:CertificateExpiry/TLSFailure](#inc-13-certificate-expiry--tls-failure)-[INC-14:DataBreach/PIIExposure](#inc-14-data-breach--pii-exposure)-[INC-15:SemanticCachePoisoning](#inc-15-semantic-cache-poisoning)4.[Post-IncidentProcess](#4-post-incident-process)5.[DiagnosticCommandsReference](#5-diagnostic-commands-reference)6.[CommunicationTemplates](#6-communication-templates)---##1.GeneralIncidentProcessEveryincidentfollowsthislifecycle:```DETECT→TRIAGE→MITIGATE→RESOLVE→POST-MORTEM```###Roles|Role|Responsibility||---------------------------|------------------------------------------------------------||**IncidentCommander(IC)**|Coordinatesresponse,ownscommunication,decidesescalation||**PrimaryResponder**|Hands-ondebuggingandremediation||**CommunicationsLead**|Updatesstakeholders,statuspage,Slackchannels||**Scribe**|Documentstimeline,actions,decisionsinreal-time|###First5Minutes(EveryIncident)1.**Acknowledge**thePagerDutyalertwithin2minutes2.**Open**anincidentchannel:`#inc-YYYY-MM-DD-<short-name>`3.**Classify**severityusingthematrixbelow4.**Announce**in`#incidents`:"INCopened—SEV-X—[briefdescription]"5.**Begin**triageusingtherelevantscenarioplaybook---##2.SeverityClassification|Severity|Criteria|ResponseSLA|Escalation||---------|------------------------------------------------|-----------------|---------------------||**SEV-1**|Completeoutage,datalossrisk,securitybreach|Immediate|IC+SergeyBar+SRE||**SEV-2**|Partialdegradation,singleproviderdown|<15min|IC+SRE||**SEV-3**|Non-critical:dashboardlag,exportissues|<1hour|On-callengineer||**SEV-4**|Cosmetic,loggingnoise,minorUIbugs|Nextbusinessday|Ticketonly|---##3.IncidentScenarios---###INC-01:DatabaseUnreachable**Severity:**SEV-1**Impact:**Allwriteoperationsfail.Readsmayservestalecache.Newuserrequestsget500errors.**SLABreach:**Immediate—blocksallledgeroperations.####Symptoms-`500InternalServerError`onallPOST/PUTendpoints-Healthendpoint`/health`returns`database:unhealthy`-Logsshow`sqlalchemy.exc.OperationalError:couldnotconnecttoserver`-PagerDutyalert:`SYSTEM_ERROR`with`databaseconnectivity`indetails####Triage(0-5min)```bash#1.VerifyDBconnectivityfromtheAPIcontainerdockercomposeexecapipython-c"fromsqlalchemyimportcreate_engine,texte=create_engine('$DATABASE_URL')withe.connect()asc:print(c.execute(text('SELECT1')).scalar())"#2.CheckPostgreSQLstatusdockercomposeexecdbpg_isready-Ualfred#3.Checkconnectionpoolmetricscurl-shttp://localhost:8000/metrics|grepdb_pool#4.CheckdiskspaceonDBhostdockercomposeexecdbdf-h/var/lib/postgresql/data```####Mitigation1.**Connectionpoolexhaustion?**→RestarttheAPIservicetoreleaseconnections:```bashdockercomposerestartapi```2.**PostgreSQLcrashed?**→RestarttheDBcontainer:```bashdockercomposerestartdb#Waitforrecovery,thencheck:dockercomposeexecdbpg_isready-Ualfred```3.**Diskfull?**→Emergencycleanup:```bashdockercomposeexecdbpsql-Ualfred-dalfred-c"VACUUMFULL;"#OrclearoldWALfilesifarchiveisbackedup```4.**Corruption?**→Restorefrombackup(seeDRRunbookSection4.3):```bashdockercomposeexecdbpg_restore-Ualfred-dalfred/backups/alfred-latest.dump```####ResolutionVerification```bashcurl-shttp://localhost:8000/health|jq'.database'#Expected:"healthy"```---###INC-02:LLMProviderDown(Single)**Severity:**SEV-2**Impact:**Requestsroutedtothefailedproviderreturn502.Failovershouldhandlewithin500ms.**SLABreach:**Onlyiffailoverfailsorlatency>500ms.####Symptoms-`502BadGateway`on`/v1/chat/completions`forspecificmodels-SLAmonitoralert:`SYSTEM_ERROR`withprovidername-Provider-specificerrorratespikesabove5%-Grafanadashboardshowssingle-providererrorspike####Triage(0-5min)```bash#1.Checkproviderstatuspage#OpenAI:https://status.openai.com#Anthropic:https://status.anthropic.com#Google:https://status.cloud.google.com#2.Checkper-providererrorratesviaSLAmonitorcurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics.provider_error_rates'#3.Checkrecentproxylogsforthefailingproviderdockercomposelogsapi--since5m|grep-i"provider.*error\|502\|timeout"```####Mitigation1.**Confirmfailoverisactive**—Alfred'scircuitbreakershouldauto-routetoalternateproviderswithin500ms2.**Iffailovernotworking**—Manuallydisabletheprovider:```bashcurl-XPOSThttp://localhost:8000/v1/governance/providers/disable\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"provider":"<provider_name>","reason":"INC-02:provideroutage"}'```3.**Notifyaffectedusers**iftheproviderserveshigh-priorityworkloads####ResolutionVerification```bash#Verifyerrorratedroppedafterproviderrecoveryorfailovercurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics.provider_error_rate_pct'#Expected:<5.0```---###INC-03:LLMProviderDown(Multiple/All)**Severity:**SEV-1**Impact:**Allchatcompletionrequestsfail.AlfredcannotproxyanyAIrequests.**SLABreach:**Immediate—coreplatformfunctionalityoffline.####Symptoms-`502BadGateway`onall`/v1/chat/completions`requestsregardlessofmodel-Providererrorrate>90%-Multipleproviderstatuspagesshowingincidents-Semanticcachemaystillservecachedresponses####Triage(0-5min)```bash#1.CheckALLproviderstatuspagessimultaneously#2.Verifyit'snotanegressnetworkissuefromoursidedockercomposeexecapicurl-shttps://api.openai.com/v1/models\-H"Authorization:Bearer$OPENAI_KEY"|head-1dockercomposeexecapicurl-shttps://api.anthropic.com/v1/messages\-H"x-api-key:$ANTHROPIC_KEY"-H"anthropic-version:2023-06-01"|head-1#3.CheckDNSresolutiondockercomposeexecapinslookupapi.openai.com```####Mitigation1.**Networkissueonourside?**→CheckVPC/firewallrules,restartnetworkstack2.**Multi-provideroutage?**→Enable"cache-only"mode—serveonlycachedresponses:```bash#Semanticcachecontinuesservingpreviouslyseenqueries#Enablestrictcache-onlytoavoid502errorscurl-XPOSThttp://localhost:8000/v1/governance/settings\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"cache_only_mode":true}'```3.**Poststatuspageupdate:**"AlfredisexperiencingdegradedAIserviceduetoupstreamprovideroutages.Cachedresponsesremainavailable."4.**Monitorproviderstatuspages**forrecoveryannouncements####ResolutionVerification```bash#Testalivechatcompletioncurl-shttp://localhost:8000/v1/chat/completions\-H"Authorization:Bearer$TEST_KEY"\-H"Content-Type:application/json"\-d'{"model":"gpt-4o","messages":[{"role":"user","content":"ping"}]}'\|jq'.choices[0].message.content'```---###INC-04:GatewayLatencySpike(P95>150ms)**Severity:**SEV-2**Impact:**AllrequestsslowerthanSLAtarget.Userexperiencedegraded.**SLABreach:**P95>150msoverhead.####Symptoms-SLAmonitoralert:`HIGH_LATENCY`withP95value-Grafanashowslatencypercentilespike-Usersreportslowresponsetimes-Healthendpointstillreturns200butslowly####Triage(0-5min)```bash#1.CheckcurrentSLAmetricscurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics'#2.Checksystemresourcesdockerstats--no-stream--format"table{{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}"#3.CheckDBqueryperformancedockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTpid,now()-pg_stat_activity.query_startASduration,queryFROMpg_stat_activityWHEREstate!='idle'ORDERBYdurationDESCLIMIT10;"#4.CheckRedislatencydockercomposeexecredisredis-cli--latency-i1-c10```####Mitigation1.**Connectionpoolexhaustion?**→Increasepoolsizeorrestart:```bash#Checkactiveconnectionsdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTcount(*)FROMpg_stat_activity;"#Restarttoclearpooldockercomposerestartapi```2.**SlowDBqueries?**→Killlong-runningqueries:```bashdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTpg_terminate_backend(pid)FROMpg_stat_activityWHEREduration>interval'30seconds'ANDstate!='idle';"```3.**HighCPU?**→Scalehorizontallyifavailable,orrestarttoclear4.**GCpressure/memory?**→Checkformemoryleaks(seeINC-11)####ResolutionVerification```bash#P95shouldreturnto<150mswithin5minutescurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics.p95_latency_ms'```---###INC-05:Redis/CacheFailure**Severity:**SEV-2**Impact:**Semanticcachedisabled(allcachemisses).Ratelimitingfallsbacktoin-memory.Sessiondatamaybelost.**SLABreach:**Cachehitratedropsto0%.####Symptoms-SLAmonitoralert:`SYSTEM_ERROR`with`cache_hit_rate_pct:0.0`-Logsshow`redis.exceptions.ConnectionError`-Ratelimitingfallsbacktolocalin-memorylimiter-Increasedlatencyaseveryrequesthitsproviders####Triage(0-5min)```bash#1.CheckRedisconnectivitydockercomposeexecredisredis-cliping#Expected:PONG#2.CheckRedismemoryusagedockercomposeexecredisredis-cliinfomemory|grepused_memory_human#3.CheckRedisslowlogdockercomposeexecredisredis-clislowlogget10#4.Checkifmaxmemoryreacheddockercomposeexecredisredis-cliconfiggetmaxmemorydockercomposeexecredisredis-cliinfomemory|grepused_memory_peak_human```####Mitigation1.**Rediscrashed?**→Restart:```bashdockercomposerestartredis#Waitforrecoverydockercomposeexecredisredis-cliping```2.**OOM?**→Increasemaxmemoryorflushnon-criticaldata:```bashdockercomposeexecredisredis-cliconfigsetmaxmemory2gb#Orevictlow-prioritycacheentriesdockercomposeexecredisredis-cli--scan--pattern"alfred:cache:*"|head-100|xargsredis-clidel```3.**Networkpartition?**→CheckDockernetwork:```bashdockernetworkinspectalfred_default```####ResolutionVerification```bashdockercomposeexecredisredis-cliping#Expected:PONG#Cachehitrateshouldrecoverwithinwindow_seconds(300s)```---###INC-06:AuthenticationSystemFailure**Severity:**SEV-1**Impact:**Nouserscanauthenticate.AllAPIrequestsreturn401.**SLABreach:**Immediate—platforminaccessible.####Symptoms-Allrequestsreturn`401Unauthorized`-IncludingpreviouslyvalidAPIkeys-Healthendpointworks(noauthrequired)butallotherendpointsfail-Logsshowauthenticationmiddlewareerrors####Triage(0-5min)```bash#1.Testwithaknown-goodadminkeycurl-shttp://localhost:8000/v1/users/me\-H"Authorization:Bearer$ADMIN_KEY"|jq.#2.CheckifAPIkeyhashingworksdockercomposeexecapipython-c"importhashlibtest='test-key-123'print(hashlib.sha256(test.encode()).hexdigest())"#3.CheckDBusertableisaccessibledockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTcount(*)FROMusers;"#4.Checkauthmiddlewarelogsdockercomposelogsapi--since5m|grep-i"auth\|401\|unauthori"```####Mitigation1.**DBconnectionissue?**→FollowINC-01procedure2.**Baddeploymentchangedauthlogic?**→Rollbacktopreviousversion:```bashdockercomposepullapidockercomposeup-dapi```3.**Hashalgorithmchanged?**→Thisisacriticalbug.Rollbackimmediately.4.**SSO/JWTproviderdown?**→FallbacktoAPIkeyauth:```bash#DisableSSOrequirementtemporarilyviaenvdockercomposeexecapienvSSO_REQUIRED=falsedockercomposerestartapi```####ResolutionVerification```bashcurl-shttp://localhost:8000/v1/users/me\-H"Authorization:Bearer$ADMIN_KEY"|jq'.email'#Expected:adminuseremail```---###INC-07:Quota/WalletHardLimitExhaustion(Mass)**Severity:**SEV-2**Impact:**Multipleusers/teamssimultaneouslyhittinghardlimits.Legitimateworkblocked.**SLABreach:**IfcausedbyAlfredbug(incorrectdeductions),SEV-1.####Symptoms-Spikein`402PaymentRequired`responses-Multipleusersreportingblockedrequests-PagerDutyalert:`QUOTA_EXCEEDED`frommultipleusers-Walletbalancesunexpectedlyatzero####Triage(0-5min)```bash#1.Checkhowmanyusersareathardlimitdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTcount(*),CASEWHENused_tokens>=personal_quotaTHEN'at_limit'WHENused_tokens>=personal_quota*0.9THEN'near_limit'ELSE'ok'ENDASstatusFROMusersGROUPBYstatus;"#2.Checkrecentdeductionsforanomaliesdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTuser_id,count(*),sum(amount)astotal_deductedFROMrequest_logsWHEREcreated_at>now()-interval'1hour'GROUPBYuser_idORDERBYtotal_deductedDESCLIMIT20;"#3.Checkifacostcalculationbuginflateddeductionsdockercomposelogsapi--since30m|grep-i"credit_calc\|deduct\|cost"```####Mitigation1.**Legitimateusagespike?**→Temporarilyraisequotasforaffectedusers:```bashcurl-XPOSThttp://localhost:8000/v1/wallets/<wallet_id>/topup\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"amount":5000,"reason":"INC-07emergencytopup"}'```2.**Bugincreditcalculation?**→ThisisSEV-1.Rollbackthedeployment.3.**Billingresetdidn'trun?**→Triggermanualwalletreset:```bashdockercomposeexecapipython-c"fromapp.wallet_resetimportwallet_reset_cronimportasyncio;asyncio.run(wallet_reset_cron())"```####ResolutionVerification```bash#Verifyaffecteduserscanmakerequestsagaincurl-shttp://localhost:8000/v1/chat/completions\-H"Authorization:Bearer$AFFECTED_USER_KEY"\-H"Content-Type:application/json"\-d'{"model":"gpt-4o-mini","messages":[{"role":"user","content":"test"}]}'\-o/dev/null-w'%{http_code}'#Expected:200```---###INC-08:CreditLeakage/Double-Spend**Severity:**SEV-1(L4—LedgerCritical)**Impact:**Creditsdeductedincorrectly—eithernotdeducted(leakage)ordeductedtwice(double-spend).Financialintegritycompromised.**SLABreach:**Immediate—ledgerintegrityviolation.####Symptoms-AuditlogshowsduplicatetransactionIDsforthesamerequest-Userbalancesdon'tmatchexpectedvaluesafterrequests-Requestcount×averagecost≠totaldeductions-`RefundManager`processingrefundsforrequeststhatweren'tcharged####Triage(0-5min)```bash#1.CheckforduplicatetransactionIDsdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTrequest_id,count(*)asdeduction_countFROMrequest_logsWHEREcreated_at>now()-interval'1hour'GROUPBYrequest_idHAVINGcount(*)>1ORDERBYdeduction_countDESC;"#2.Reconcile:comparedeductionsvsrequestcountdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTuser_id,count(*)asrequests,sum(CASEWHENamount>0THENamountELSE0END)astotal_deducted,sum(CASEWHENamount<0THENabs(amount)ELSE0END)astotal_refundedFROMrequest_logsWHEREcreated_at>now()-interval'1hour'GROUPBYuser_idORDERBYtotal_deductedDESCLIMIT20;"#3.Checkauditlogforanygapscurl-shttp://localhost:8000/v1/admin/audit-logs/verify\-XPOST-H"Authorization:Bearer$ADMIN_KEY"|jq.```####Mitigation1.**Pauseallproxytraffic**ifdouble-spendisconfirmed:```bash#Enablemaintenancemodecurl-XPOSThttp://localhost:8000/v1/governance/settings\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"maintenance_mode":true,"reason":"INC-08:ledgerintegritycheck"}'```2.**Identifytherootcause**—checkrecentdeploymentsto`logic.py`or`wallets.py`3.**Rollback**ifintroducedbyrecentchange4.**Manualreconciliation**—calculatecorrectbalancesandapplycorrections:```bash#Issueidempotentrefundsfordouble-deductedamounts#(eachrefundmustreferencetheoriginaltransaction_id)```5.**ESCALATETOSERGEYBAR**—Allledgerissuesrequireownerreview####ResolutionVerification```bash#Re-runauditlogverificationcurl-shttp://localhost:8000/v1/admin/audit-logs/verify\-XPOST-H"Authorization:Bearer$ADMIN_KEY"|jq'.valid'#Expected:true```---###INC-09:AuditLogChainBreak**Severity:**SEV-2(SEV-1ifduringcomplianceaudit)**Impact:**Immutableaudittrailintegritycompromised.Hashchainverificationfails.**SLABreach:**Complianceviolationifnotresolvedbeforenextaudit.####Symptoms-`POST/v1/admin/audit-logs/verify`returns`{"valid":false}`-`first_break_at`fieldidentifiesthefirstcorruptedentry-Mayindicatedatatamperingormigrationerror####Triage(0-5min)```bash#1.Runchainverificationcurl-shttp://localhost:8000/v1/admin/audit-logs/verify\-XPOST-H"Authorization:Bearer$ADMIN_KEY"|jq.#2.Inspectthebrokenentrydockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTid,action,actor_user_id,created_at,previous_hash,hashFROMaudit_logsWHEREid='<first_break_at_id>';"#3.Checksurroundingentriesdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTid,action,created_at,hash,previous_hashFROMaudit_logsORDERBYcreated_atLIMIT5OFFSET(SELECTcount(*)-3FROMaudit_logsWHEREcreated_at<='<break_timestamp>');"```####Mitigation1.**Identifyrootcause:**-Migrationerror→entriesmayhavebeenwrittenwithouthashchain-ManualDBedit→someonemodifiedaudit_logsdirectly(policyviolation)-Racecondition→concurrentwriterscomputedincorrectprevious_hash2.**Ifmigrationerror:**Addmissinghashesbyre-computingthechainforwardfromthebreakpoint3.**Iftamperingsuspected:**Preserveforensicevidence,notifySergeyBar+SecurityLeadimmediately4.**DONOT**UPDATEorDELETEauditlogentries—thisviolatesimmutability####ResolutionVerification```bashcurl-shttp://localhost:8000/v1/admin/audit-logs/verify\-XPOST-H"Authorization:Bearer$ADMIN_KEY"|jq'.valid'#Expected:true(afterchainrepair)```---###INC-10:APIRateLimitStorm**Severity:**SEV-2**Impact:**Legitimateusersrate-limitedduetoeitheraDDoSoralegitimatetrafficspike.**SLABreach:**Iflegitimatetrafficisblocked.####Symptoms-Spikein`429TooManyRequests`responses-Ratelimitmiddlewarelogsshowhighrejectionrate-Redisratelimitcounterssaturated-Maybecausedbyrunawayclientscriptoractualattack####Triage(0-5min)```bash#1.IdentifytopIPs/keysbeingrate-limiteddockercomposelogsapi--since5m|grep"429\|rate.limit"|\awk'{print$NF}'|sort|uniq-c|sort-rn|head20#2.CheckRedisratelimitcountersdockercomposeexecredisredis-cli--scan--pattern"alfred:ratelimit:*"|wc-l#3.Checkifit'sasingleclientordistributeddockercomposelogsapi--since5m|grep"429"|\grep-oP'client_ip=\K[^]+'|sort|uniq-c|sort-rn|head10```####Mitigation1.**Singleabusiveclient?**→Blockatthegatewaylevel:```bash#AddIPtoblocklistcurl-XPOSThttp://localhost:8000/v1/governance/block\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"ip":"<offending_ip>","reason":"INC-10:ratelimitabuse"}'```2.**Legitimatetrafficspike?**→Temporarilyraiseratelimits:```bash#Increaseper-keylimitexportRATE_LIMIT_PER_MINUTE=120#Defaultis60dockercomposerestartapi```3.**DDoS?**→EnableCloudflareUnderAttackMode,blockatCDNlevel####ResolutionVerification```bash#429rateshouldreturntobaselinedockercomposelogsapi--since2m|grep"429"|wc-l#Expected:<10```---###INC-11:MemoryLeak/OOM**Severity:**SEV-2**Impact:**APIservicekilledbyOOM.Requestsfailduringrestart.**SLABreach:**DowntimeduringOOMkill.####Symptoms-Containerkilled:`dockercomposelogsapi|grep"Killed\|OOM"`-Graduallyincreasingmemoryusagevisiblein`dockerstats`-Pythontraceback:`MemoryError`-PodevictedinKubernetes:`kubectldescribepod|grepOOMKilled`####Triage(0-10min)```bash#1.Checkcurrentmemoryusagedockerstats--no-stream--format"table{{.Name}}\t{{.MemUsage}}\t{{.MemPerc}}"#2.CheckOOMkillhistorydmesg|grep-i"oom\|killed"|tail-20#3.Ifstillrunning,getamemoryprofiledockercomposeexecapipython-c"importtracemalloctracemalloc.start()#...snapshotsnapshot=tracemalloc.take_snapshot()forstatinsnapshot.statistics('lineno')[:10]:print(stat)"```####Mitigation1.**Immediaterelief**—Restarttheservicewithincreasedmemorylimit:```bashdockercomposerestartapi#OrinK8s,increasememoryrequest/limit```2.**Identifytheleak**—commoncausesinAlfred:-Unboundedtiktokenencodercache-Largeresponsebodiesstoredinmemory-SQLAlchemysessionleaks(sessionsnotclosed)-Backgroundtaskaccumulation3.**Applymemorylimits**topreventimpactonothercontainers:```yaml#docker-compose.ymlservices:api:mem_limit:512mmemswap_limit:512m```####ResolutionVerification```bash#Memoryusageshouldstabilizeafterrestartdockerstatsapi--no-stream--format"{{.MemUsage}}"#Monitorfor10minutes—shouldnotexceed512MB```---###INC-12:DeploymentFailure/BadRelease**Severity:**SEV-1ifcausingoutage,SEV-2ifpartial**Impact:**Newreleaseintroducedabug.Servicedegradedorbroken.**SLABreach:**Dependsonimpact.####Symptoms-Spikein500errorsimmediatelyafterdeployment-Newerrorpatternsinlogsnotseenbefore-Healthcheckfails-Testsuitepassedbutproductionbehaviordiffers####Triage(0-5min)```bash#1.Confirmwhenthelastdeploymenthappenedgitlog--oneline-5origin/maindockerinspectapi--format'{{.Created}}'#2.Compareerrorratebefore/afterdeploydockercomposelogsapi--since30m|grep-c"500\|Error\|Exception"#3.CheckifDBmigrationwaspartofthedeployalembic-csrc/backend/config/alembic.inicurrentalembic-csrc/backend/config/alembic.inihistory-5```####Mitigation1.**Rollbackimmediately**—don'tdebuginproduction:```bash#DockerComposedockercomposepullapiworkerdockercomposeup-dapiworker--force-recreate#Ordeployspecificprevioustag:#IMAGE_TAG=v1.2.3dockercomposeup-dapi```2.**IfDBmigrationwasapplied**—downgrade:```bashalembic-csrc/backend/config/alembic.inidowngrade-1```3.**Document**therollbackreasonforpost-mortem####ResolutionVerification```bash#Errorrateshoulddroptobaselinecurl-shttp://localhost:8000/health|jq.#Allserviceshealthy```**ROLLBACKcommentblock(includeinallL3/L4codechanges):**```python#ROLLBACK:Torevertthischange:#1.Run:alembicdowngrade-1#2.Deploytag:v<previous-tag>#3.Notify:SergeyBar+on-callengineer```---###INC-13:CertificateExpiry/TLSFailure**Severity:**SEV-1**Impact:**HTTPSconnectionsfail.Allclientsgetcertificateerrors.**SLABreach:**Immediate—serviceunreachable.####Symptoms-Clientsreport`SSL_ERROR_EXPIRED_CERT_ALERT`orsimilar-`curl-vhttps://alfred.example.com`showscertificateexpired-Let'sEncrypt/cert-managerrenewalfailed####Triage(0-5min)```bash#1.Checkcertificateexpiryecho|openssls_client-connectalfred.example.com:4432>/dev/null|\opensslx509-noout-dates#2.Checkcert-manager(Kubernetes)kubectlgetcertificates-nalfredkubectldescribecertificatealfred-tls-nalfred#3.Checkrenewallogskubectllogs-ncert-managerdeployment/cert-manager|tail-50```####Mitigation1.**Forcecertificaterenewal:**```bash#cert-managerkubectldeletecertificatealfred-tls-nalfred#cert-managerwillre-createit#Let'sEncryptmanualcertbotrenew--force-renewal```2.**Emergencyself-signedcert**(temporary,causesbrowserwarnings):```bashopensslreq-x509-nodes-days1-newkeyrsa:2048\-keyout/tmp/emergency.key-out/tmp/emergency.crt\-subj"/CN=alfred.example.com"```####ResolutionVerification```bashecho|openssls_client-connectalfred.example.com:4432>/dev/null|\opensslx509-noout-dates#Verifynewexpirydateisinthefuture```---###INC-14:DataBreach/PIIExposure**Severity:**SEV-1(SecurityCritical)**Impact:**Personaldataexposed.GDPR/SOC2compliancerisk.Potentiallegalliability.**SLABreach:**Immediate.Securityincidentresponserequired.####Symptoms-PIIdetectedinlogs(email,names,APIkeysincleartext)-Unauthorizedaccesstouserdataendpoints-Securityscanneralert-Externalreportofdataexposure####Triage(0-5min)1.**DONOT**deleteormodifyanylogsordata—preserveforensicevidence2.**Assessscope:**Whatdatawasexposed?Howmanyusersaffected?3.**Identifyvector:**Howdidtheexposureoccur?```bash#1.CheckforPIIinrecentlogsdockercomposelogsapi--since1h|grep-iE"password|secret|api.key|ssn|@.*\.com"#2.Checkforunauthorizedaccessdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTaction,actor_user_id,target_type,created_atFROMaudit_logsWHEREactionIN('data_export','user_read','gdpr_export')ANDcreated_at>now()-interval'24hours'ORDERBYcreated_atDESC;"#3.CheckAPIkeyusageforanomaliesdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTu.email,count(*)asreq_count,max(rl.created_at)aslast_requestFROMrequest_logsrlJOINusersuONrl.user_id=u.idWHERErl.created_at>now()-interval'24hours'GROUPBYu.emailORDERBYreq_countDESCLIMIT20;"```####Mitigation1.**Containtheexposureimmediately:**```bash#RevokecompromisedAPIkeyscurl-XPOSThttp://localhost:8000/v1/admin/users/<user_id>/rotate-key\-H"Authorization:Bearer$ADMIN_KEY"```2.**Blocktheattackvector**(firewallrule,disableendpoint,etc.)3.**Notifyimmediately:**-SergeyBar(Owner)-SecurityLead-Legal(ifGDPR-regulatedusersaffected)4.**Preserveevidence**—takesnapshotsoflogsandDBstate5.**RunGDPRerasure**forexposedusersifrequested:```bashcurl-XPOSThttp://localhost:8000/v1/gdpr/erasure/<user_id>\-H"Authorization:Bearer$ADMIN_KEY"```####ResolutionVerification-Allcompromisedkeysrotated-Attackvectorclosed-Incidentdocumentedincompliancelog-Affectedusersnotified(GDPRArticle34ifapplicable)---###INC-15:SemanticCachePoisoning**Severity:**SEV-2**Impact:**Cachereturningincorrectormanipulatedresponses.Usersreceivewronganswers.**SLABreach:**Dataintegritycompromise.####Symptoms-Usersreportreceivingresponsesthatdon'tmatchtheirqueries-Cachehitrateanomalouslyhigh(>80%)-Responsescontaincontentfromunrelatedqueries-Similaritythresholdmaybetooloose####Triage(0-5min)```bash#1.Checkcachehitratecurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics.cache_hit_rate_pct'#2.Checkrecentcacheentries(Redis)dockercomposeexecredisredis-cli--scan--pattern"alfred:cache:*"|wc-l#3.Verifyasuspiciouscacheentrydockercomposeexecredisredis-cliget"alfred:cache:<suspicious_key>"|python-mjson.tool```####Mitigation1.**Flushthecacheimmediately:**```bashdockercomposeexecredisredis-cli--scan--pattern"alfred:cache:*"|\xargs-I{}redis-clidel{}```2.**Tightensimilaritythreshold**topreventfalsematches:```bash#Increaseminimumsimilarityscoreforcachehitscurl-XPOSThttp://localhost:8000/v1/governance/settings\-H"Authorization:Bearer$ADMIN_KEY"\-H"Content-Type:application/json"\-d'{"cache_similarity_threshold":0.98}'```3.**Investigatethesource**—wasthisaninjectionattackormisconfiguration?####ResolutionVerification```bash#Cachehitrateshouldnormalizeafterflush#Verifyresponsesarecorrectbytestingknownqueriescurl-shttp://localhost:8000/v1/chat/completions\-H"Authorization:Bearer$TEST_KEY"\-H"Content-Type:application/json"\-d'{"model":"gpt-4o-mini","messages":[{"role":"user","content":"Whatis2+2?"}]}'\|jq'.choices[0].message.content'#Expected:acorrectanswer(e.g.,"4")```---##4.Post-IncidentProcess###Within1HourofResolution1.Updatestatuspage:"Resolved"2.Postsummaryin`#incidents`channel3.Schedulepost-mortemwithin48hours###Post-MortemTemplate```markdown##Post-Mortem:INC-YYYY-MM-DD-<name>**Date:**YYYY-MM-DD**Duration:**HH:MM**Severity:**SEV-X**IncidentCommander:**[name]###Summary[Oneparagraph:whathappened,whowasaffected,howlong]###Timeline|Time(UTC)|Event||----------|---------------------||HH:MM|Alertfired||HH:MM|ICacknowledged||HH:MM|Rootcauseidentified||HH:MM|Mitigationapplied||HH:MM|Resolutionconfirmed|###RootCause[Technicalexplanationofwhatwentwrong]###Impact-Usersaffected:[number]-Duration:[minutes]-Revenueimpact:[ifapplicable]###ActionItems|ID|Action|Owner|DueDate|Status||---|--------|--------|--------|-----------||1|[action]|[person]|[date]|[open/done]|###LessonsLearned-Whatwentwell-Whatwentpoorly-Whatwe'llchange```---##5.DiagnosticCommandsReference###QuickHealthCheck```bash#All-in-onehealthcheckcurl-shttp://localhost:8000/health|jq.curl-shttp://localhost:8000/v1/health|jq.```###DatabaseDiagnostics```bash#Activeconnectionsdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTcount(*)FROMpg_stat_activity;"#Slowqueriesdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTpid,now()-query_startASduration,left(query,80)FROMpg_stat_activityWHEREstate='active'ORDERBYdurationDESCLIMIT10;"#Tablesizesdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTrelname,pg_size_pretty(pg_total_relation_size(relid))FROMpg_catalog.pg_statio_user_tablesORDERBYpg_total_relation_size(relid)DESCLIMIT10;"#Recentauditlogsdockercomposeexecdbpsql-Ualfred-dalfred-c"SELECTid,actor_user_id,action,target_type,created_atFROMaudit_logsORDERBYcreated_atDESCLIMIT20;"```###RedisDiagnostics```bash#Connectiontestdockercomposeexecredisredis-cliping#Memoryusagedockercomposeexecredisredis-cliinfomemory#Keycountbypatterndockercomposeexecredisredis-cli--scan--pattern"alfred:*"|cut-d:-f1-2|sort|uniq-c|sort-rn#Slowlogdockercomposeexecredisredis-clislowlogget10```###SLAMonitor```bash#Currentmetricscurl-shttp://localhost:8000/v1/notifications/sla/metrics\-H"Authorization:Bearer$ADMIN_KEY"|jq'.metrics'#Triggerthresholdcheckcurl-shttp://localhost:8000/v1/notifications/sla/check\-XPOST-H"Authorization:Bearer$ADMIN_KEY"|jq.#Currentthresholdscurl-shttp://localhost:8000/v1/notifications/sla/thresholds\-H"Authorization:Bearer$ADMIN_KEY"|jq'.thresholds'```---##6.CommunicationTemplates###StatusPage—Investigating>**[Investigating]ElevatederrorratesonAlfredAPI**>>WeareinvestigatingreportsofelevatederrorratesontheAlfredAPI.Somerequestsmaybefailingorexperiencingincreasedlatency.Wewillprovideanupdatewithin15minutes.###StatusPage—Identified>**[Identified]Provideroutageaffectingchatcompletions**>>Wehaveidentifiedtherootcauseasanoutagewithourupstreamprovider[name].Failoverroutinghasbeenactivated.Somerequestsmayexperienceslightlyhigherlatency.Wearemonitoringthesituation.###StatusPage—Resolved>**[Resolved]Provideroutageaffectingchatcompletions**>>Theupstreamprovideroutagehasbeenresolved.Allservicesareoperatingnormally.Totalduration:XXminutes.Apost-mortemwillbepublishedwithin48hours.###UserNotification—DataIncident>**ImportantSecurityNotice**>>Weidentifiedandresolvedasecurityincidenton[date]thatmayhaveaffectedyouraccount.[Briefdescriptionofwhathappenedandwhatdatawasinvolved.]>>**Whatwe'vedone:**[Actionstaken]>**Whatyoushoulddo:**[Recommendedactions,e.g.,rotateAPIkeys]>>Ifyouhavequestions,contactsecurity@alfred.ai.---_AlfredIncidentResponsePlaybook—InternalUseOnly__Version2.0—February2026__Maintainedby:SergeyBar+SRETeam_