import{f as D,e as h,j as e,c as q,d as R,k as E}from"./index-BpBXMnYt.js";import{r as t}from"./vendor-CoKE50sv.js";import{F as $}from"./PlusIcon-CvPvxy5e.js";import{F as M}from"./ClockIcon-DqX5lot2.js";function P({title:a,titleId:n,...m},g){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":n},m),a?t.createElement("title",{id:n},a):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Q=t.forwardRef(P);function B(){const{showToast:a}=D(),[n,m]=t.useState([]),[g,f]=t.useState(!0),[p,y]=t.useState(null),[c,_]=t.useState("pending"),[A,u]=t.useState(!1),[r,j]=t.useState({amount:"",reason:""}),[N,v]=t.useState(!1),[w,x]=t.useState(null);t.useEffect(()=>{d()},[]);async function d(){try{f(!0);const s=await h.getPendingApprovals(),o=(Array.isArray(s)?s:s.approvals||[]).map(l=>({...l,user_name:l.user_name||"Unknown User",user_email:l.user_email||"",requested_amount:l.requested_credits||l.requested_amount,approved_amount:l.approved_credits||l.approved_amount}));m(o)}catch(s){y(s?.message||"Failed to load approvals"),m([])}finally{f(!1)}}async function S(s){if(s.preventDefault(),!r.amount||!r.reason){a("Please enter amount and reason","error");return}try{v(!0),await h.createApprovalRequest(parseInt(r.amount),r.reason),a("Quota request submitted successfully","success"),u(!1),j({amount:"",reason:""}),d()}catch(i){a(i.message||"Failed to submit request","error")}finally{v(!1)}}async function F(s,i=null){try{x(s),await h.approveRequest(s,i),a("Request approved","success"),d()}catch(o){a(o.message||"Failed to approve request","error")}finally{x(null)}}async function C(s){const i=prompt("Reason for rejection (optional):");try{x(s),await h.rejectRequest(s,i||""),a("Request rejected","success"),d()}catch(o){a(o.message||"Failed to reject request","error")}finally{x(null)}}function L(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}const k=n.filter(s=>c==="all"?!0:s.status===c),b={pending:n.filter(s=>s.status==="pending").length,approved:n.filter(s=>s.status==="approved").length,rejected:n.filter(s=>s.status==="rejected").length};return g?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quota Approvals"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage quota increase requests"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn btn-primary flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),"Request Quota"]})]}),p&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-900/30 text-yellow-400 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",p,". Demo data not used."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{y(null),d()},className:"btn btn-primary",children:"Retry"}),e.jsx("a",{href:"mailto:support@example.com",className:"btn btn-secondary",children:"Contact Support"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-yellow-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:b.pending}),e.jsx("p",{className:"stat-label",children:"Pending"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-8 w-8 text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:b.approved}),e.jsx("p",{className:"stat-label",children:"Approved"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-8 w-8 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:b.rejected}),e.jsx("p",{className:"stat-label",children:"Rejected"})]})]})})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"flex space-x-2",children:["pending","approved","rejected","all"].map(s=>e.jsx("button",{onClick:()=>_(s),className:`px-4 py-2 text-sm rounded-lg ${c===s?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400 font-medium":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"space-y-4",children:[k.map(s=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mr-3",children:s.user_name}),e.jsx("span",{className:`badge ${s.status==="pending"?"badge-yellow":s.status==="approved"?"badge-green":"badge-red"}`,children:s.status})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:s.user_email}),e.jsxs("div",{className:"flex items-center text-sm mb-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:s.reason})]}),e.jsx("p",{className:"text-xs text-gray-400",children:L(s.created_at)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:[(s.requested_credits||s.requested_amount)?.toLocaleString()," tokens"]}),s.status==="approved"&&(s.approved_credits||s.approved_amount)&&e.jsxs("p",{className:"text-sm text-green-500",children:["Approved: ",(s.approved_credits||s.approved_amount).toLocaleString()]}),s.status==="rejected"&&s.rejection_reason&&e.jsx("p",{className:"text-sm text-red-400",children:s.rejection_reason}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs("button",{onClick:()=>F(s.id,s.requested_credits||s.requested_amount),disabled:w===s.id,className:"btn btn-sm bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs("button",{onClick:()=>C(s.id),disabled:w===s.id,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})]})},s.id)),k.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:["No ",c==="all"?"":c," requests found"]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Request Additional Quota"}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(E,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount Requested (tokens)"}),e.jsx("input",{type:"number",min:"1",value:r.amount,onChange:s=>j({...r,amount:s.target.value}),className:"input w-full",placeholder:"e.g., 5000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason / Justification"}),e.jsx("textarea",{value:r.reason,onChange:s=>j({...r,reason:s.target.value}),className:"input w-full",rows:4,placeholder:"Explain why you need additional tokens...",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:N,children:N?"Submitting...":"Submit Request"})]})]})]})})]})}export{B as default};
