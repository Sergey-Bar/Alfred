import{f as J,e as i,j as e,g as K}from"./index-BpBXMnYt.js";import{r as a}from"./vendor-CoKE50sv.js";import{F as V,a as X,D as Y}from"./DeleteConfirmDialog--tgzEXph.js";import{F as ee}from"./PlusIcon-CvPvxy5e.js";import{F as E}from"./UserPlusIcon-BzzHUuVC.js";function te({title:l,titleId:c,...x},f){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},x),l?a.createElement("title",{id:c},l):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M22 10.5h-6m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM4 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 10.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const ae=a.forwardRef(te);function oe(){const{showToast:l}=J(),[c,x]=a.useState([]),[f,w]=a.useState(!0),[_,y]=a.useState(null),[k,F]=a.useState(""),[L,u]=a.useState(!1),[R,T]=a.useState(!1),[h,M]=a.useState(null),[m,$]=a.useState(null),[q,j]=a.useState(!1),[g,N]=a.useState(null),[A,C]=a.useState(!1),[p,v]=a.useState(""),[S,d]=a.useState([]),[U,D]=a.useState(!1),[n,b]=a.useState({name:"",pool_quota:1e4});a.useEffect(()=>{o()},[]);async function o(){try{w(!0);const r=(await i.getTeams()).map(s=>({team_id:s.id,team_name:s.name,description:s.description,pool_quota:s.common_pool,used_tokens:s.used_pool,remaining_tokens:s.available_pool,usage_percentage:s.common_pool>0?Math.round(s.used_pool/s.common_pool*100):0,member_count:s.member_count}));x(r)}catch(t){y(t?.message||"Failed to load teams"),x([])}finally{w(!1)}}function O(){M(null),b({name:"",pool_quota:1e4}),u(!0)}function P(t){M(t),b({name:t.team_name,pool_quota:t.pool_quota}),u(!0)}async function z(t){$(t),v(""),d([]),T(!0),D(!0);try{const r=await i.getTeamMembers(t.team_id);d(r||[])}catch(r){d([]),y(r?.message||"Failed to load team members")}finally{D(!1)}}async function Q(t){if(t.preventDefault(),!!p.trim())try{await i.addTeamMember(m.team_id,p),l({type:"success",title:"Member Added",message:`${p} added to the team`}),v("");const r=await i.getTeamMembers(m.team_id);d(r||[]),o()}catch(r){l({type:"error",title:"Error",message:r.message||"Failed to add member"})}}async function Z(t,r){try{await i.removeTeamMember(m.team_id,t),l({type:"success",title:"Member Removed",message:`${r} removed from the team`}),d(s=>s.filter(H=>H.id!==t)),o()}catch(s){l({type:"error",title:"Error",message:s.message||"Failed to remove member"})}}async function B(t){t.preventDefault();try{h?(await i.updateTeam(h.team_id,n),l({type:"success",title:"Team Updated",message:`${n.name} has been updated`})):(await i.createTeam(n),l({type:"success",title:"Team Created",message:`${n.name} has been created`})),u(!1),o()}catch(r){l({type:"error",title:"Error",message:r.message||"Failed to save team"})}}function I(t){N(t),j(!0)}async function W(){if(g){C(!0);try{await i.deleteTeam(g.team_id),l({type:"success",title:"Team Deleted",message:`${g.team_name} has been deleted`}),j(!1),N(null),o()}catch(t){l({type:"error",title:"Error",message:t.message||"Failed to delete team"})}finally{C(!1)}}}function G(t){return t>=90?"bg-red-500":t>=70?"bg-yellow-500":"bg-green-500"}return f?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Teams"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage team pools and members"})]}),e.jsxs("button",{onClick:O,className:"btn btn-primary flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Create Team"]})]}),_&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 text-yellow-700 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",_,". Demo data not used."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{y(null),o()},className:"btn btn-primary",children:"Retry"}),e.jsx("a",{href:"mailto:support@example.com",className:"btn btn-secondary",children:"Contact Support"})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search teams by name...",className:"input w-full pl-10",value:k,onChange:t=>F(t.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.filter(t=>t.team_name?.toLowerCase().includes(k.toLowerCase())).map(t=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.team_name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.member_count," members"]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>z(t),className:"p-1 text-gray-400 hover:text-blue-600",title:"Manage members",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>P(t),className:"p-1 text-gray-400 hover:text-blue-600",title:"Edit team",children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>I(t),className:"p-1 text-gray-400 hover:text-red-600",title:"Delete team",children:e.jsx(X,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Pool Usage"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[t.usage_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${G(t.usage_percentage)}`,style:{width:`${Math.min(t.usage_percentage,100)}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Used"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.used_tokens?.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Remaining"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.remaining_tokens?.toLocaleString()})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total Quota"}),e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:t.pool_quota?.toLocaleString()})]})]})]},t.team_id))}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:h?"Edit Team":"Create Team"}),e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Team Name"}),e.jsx("input",{type:"text",className:"input",value:n.name,onChange:t=>b({...n,name:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Pool Quota"}),e.jsx("input",{type:"number",className:"input",value:n.pool_quota,onChange:t=>b({...n,pool_quota:parseInt(t.target.value)}),required:!0})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:h?"Save Changes":"Create Team"})]})]})]})}),R&&m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-6 border border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-white",children:["Manage Members - ",m.team_name]}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Add or remove team members."}),e.jsxs("form",{onSubmit:Q,className:"flex space-x-2 mb-6",children:[e.jsx("input",{type:"email",placeholder:"Enter user email...",className:"input flex-1",value:p,onChange:t=>v(t.target.value),required:!0}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"border border-gray-700 rounded-lg divide-y divide-gray-700 max-h-64 overflow-y-auto",children:U?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Loading members..."}):S.length===0?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"No members yet"}):S.map(t=>e.jsxs("div",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400",children:t.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`badge ${t.is_admin?"badge-blue":"badge-green"}`,children:t.is_admin?"Admin":"Member"}),e.jsx("button",{onClick:()=>Z(t.id,t.name),className:"p-1 text-gray-400 hover:text-red-600",title:"Remove member",children:e.jsx(ae,{className:"h-5 w-5"})})]})]},t.id))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>T(!1),className:"btn btn-secondary",children:"Close"})})]})}),e.jsx(Y,{isOpen:q,onClose:()=>{j(!1),N(null)},onConfirm:W,itemName:g?.team_name||"",itemType:"team",loading:A})]})}export{oe as default};
