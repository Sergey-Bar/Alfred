## Alfred Helm Chart Configuration
## Recommended by CODE REVIEW: Enhanced Helm chart structure
## 
## Full configuration reference available at:
## https://github.com/AlfredDev/alfred/docs/DEPLOYMENT.md

## Application replica count
replicaCount: 2

## Container image configuration
image:
  repository: ghcr.io/AlfredDev/alfred
  tag: latest
  pullPolicy: IfNotPresent

## Service configuration
service:
  type: ClusterIP
  port: 8000
  annotations: {}
    # cloud.google.com/neg: '{"ingress": true}'
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"

## Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations: {}
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: staging.alfred.dev
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: alfred-tls
    #   hosts:
    #     - staging.alfred.dev

## Resource limits (CODE REVIEW: Already configured)
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

## Node selector for pod assignment
nodeSelector: {}
  # kubernetes.io/arch: amd64

## Tolerations for pod assignment
tolerations: []
  # - key: "dedicated"
  #   operator: "Equal"
  #   value: "ai-workloads"
  #   effect: "NoSchedule"

## Affinity and anti-affinity
affinity: {}
  # podAntiAffinity:
  #   preferredDuringSchedulingIgnoredDuringExecution:
  #   - weight: 100
  #     podAffinityTerm:
  #       labelSelector:
  #         matchExpressions:
  #         - key: app.kubernetes.io/name
  #           operator: In
  #           values:
  #           - alfred
  #       topologyKey: kubernetes.io/hostname

## Horizontal Pod Autoscaler
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
 
## Monitoring configuration
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
      # prometheus: kube-prometheus

## Redis configuration for caching and queues
redis:
  enabled: true
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  service:
    port: 6379
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  persistence:
    enabled: true
    size: 2Gi
    storageClass: ""

## Background worker configuration
worker:
  enabled: true
  replicaCount: 1
  image:
    repository: ghcr.io/AlfredDev/alfred
    tag: latest
  command: ["rq","worker","-u"]
  args: []
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

## PostgreSQL configuration (external database recommended)
postgresql:
  enabled: false
  # If using internal PostgreSQL (not recommended for production)
  # enabled: true
  # postgresqlVersion: "16"  # CODE REVIEW: Upgraded to PostgreSQL 16
  # postgresqlDatabase: alfred
  # postgresqlUsername: alfred
  # persistence:
  #   size: 10Gi

## Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001
  capabilities:
    drop:
      - ALL

## Pod Security Policy
podSecurityContext:
  fsGroup: 1001

## Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""
