============================= test session starts =============================
platform win32 -- Python 3.14.3, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\python.exe
cachedir: .pytest_cache
rootdir: C:\Projects\Alfred
configfile: pyproject.toml
plugins: anyio-4.12.1, base-url-2.1.0, playwright-0.7.2
collecting ... collected 1 item

dev/QA/Backend/Unit/test_api.py::TestHealthEndpoint::test_health_check ERROR [100%]

=================================== ERRORS ====================================
___________ ERROR at setup of TestHealthEndpoint.test_health_check ____________

engine = Engine(sqlite:///:memory:)
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x0000019BCC2DA060>

    @pytest.fixture(scope="function")
    def test_client(engine, monkeypatch):
        """Create FastAPI test client with isolated database."""
>       import app.main as main_module

dev\QA\Backend\conftest.py:110: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    """
    Alfred - Enterprise AI Credit Governance Platform
    Core API Gateway & Orchestration Engine (Modular Entry Point)
    
    [ARCHITECTURAL ROLE]
    This is the lean entry point for the Alfred platform. It orchestrates the
    request lifecycle by mounting domain-specific routers and configuring
    application-wide middleware and lifespan events.
    """
    
    import os
    from contextlib import asynccontextmanager
    from typing import AsyncGenerator
    
    from fastapi import FastAPI, Request
    from fastapi.middleware.cors import CORSMiddleware
    from fastapi.responses import FileResponse, JSONResponse
    from fastapi.staticfiles import StaticFiles
    from sqlmodel import Session, SQLModel, select
    
    from .config import settings
    from .database import engine
    from .dependencies import get_session
    from .exceptions import setup_exception_handlers
    from .integrations import (
        get_notification_manager,
        setup_notifications,
        setup_sso
    )
    from .logging_config import get_logger, setup_logging
    from .middleware import setup_middleware
    from .models import OrgSettings
>   from .dashboard import router as dashboard_router

dev\backend\app\main.py:33: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    """
    Alfred - Enterprise AI Credit Governance Platform
    Administrative Analytics & Dashboard API
    
    [ARCHITECTURAL ROLE]
    This module provides the 'Intelligence Layer' for Alfred. It aggregates raw
    transactional data (RequestLogs, Transfers) into high-level KPIs that allow
    administrators to:
    1. Monitoring: Real-time tracking of token burn rates and budget utilization.
    2. Forecasting: Identify cost trends and model usage patterns.
    3. Governance: Audit pending approvals and team pool balances.
    4. Behavior: Gamified performance metrics (Efficiency Leaderboard).
    
    [PERFORMANCE STRATEGY]
    N+1 Mitigation: We use bulk-fetching and mapping techniques to avoid the
    common 'N+1 Query' trap when resolving User/Team names for large lists of logs.
    """
    
    from datetime import datetime, timedelta, timezone
    from decimal import Decimal
    from typing import Any, Dict, List, Optional
    
    from fastapi import APIRouter, Depends, Query
    from sqlmodel import Session, and_, func, select
    
    from .dependencies import get_session, require_admin, get_current_user
    from .models import ApprovalRequest, RequestLog, Team, TeamMemberLink, TokenTransfer, User
>   from .schemas import (
        ApprovalStats,
        CostTrendPoint,
        DashboardLeaderboardEntry,
        ModelUsageStats,
        OverviewStats,
        TeamPoolStats,
        TransferAuditItem,
        TransferStats,
        UserUsageStats
    )

dev\backend\app\dashboard.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    from datetime import datetime
    from decimal import Decimal
    from typing import List, Optional
>   from pydantic import BaseModel, field_validator, Body
E   ImportError: cannot import name 'Body' from 'pydantic' (C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\pydantic\__init__.py)

dev\backend\app\schemas.py:4: ImportError
---------------------------- Captured stderr setup ----------------------------
[92m14:35:52 - LiteLLM:DEBUG[0m: logging_config.py:144 - [Non-Blocking] Unable to import GenericAPILogger - LiteLLM Enterprise Feature - No module named 'litellm_enterprise'
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Using AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Creating AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - NEW SESSION: Creating new ClientSession (no shared session provided)
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Using AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Creating AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - NEW SESSION: Creating new ClientSession (no shared session provided)
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Using AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Creating AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - NEW SESSION: Creating new ClientSession (no shared session provided)
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Using AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - Creating AiohttpTransport...
[92m14:35:53 - LiteLLM:DEBUG[0m: logging_config.py:144 - NEW SESSION: Creating new ClientSession (no shared session provided)
----------------------------- Captured log setup ------------------------------
DEBUG    LiteLLM:logging_config.py:144 [Non-Blocking] Unable to import GenericAPILogger - LiteLLM Enterprise Feature - No module named 'litellm_enterprise'
DEBUG    LiteLLM:logging_config.py:144 Using AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 Creating AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 NEW SESSION: Creating new ClientSession (no shared session provided)
DEBUG    LiteLLM:logging_config.py:144 Using AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 Creating AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 NEW SESSION: Creating new ClientSession (no shared session provided)
DEBUG    LiteLLM:logging_config.py:144 Using AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 Creating AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 NEW SESSION: Creating new ClientSession (no shared session provided)
DEBUG    LiteLLM:logging_config.py:144 Using AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 Creating AiohttpTransport...
DEBUG    LiteLLM:logging_config.py:144 NEW SESSION: Creating new ClientSession (no shared session provided)
============================== warnings summary ===============================
..\..\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\config\__init__.py:1428
  C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\_pytest\config\__init__.py:1428: PytestConfigWarning: Unknown config option: asyncio_mode
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

dev/QA/Backend/Unit/test_api.py: 15 warnings
  C:\Users\Sergey\AppData\Local\Python\pythoncore-3.14-64\Lib\site-packages\litellm\litellm_core_utils\logging_utils.py:273: DeprecationWarning: 'asyncio.iscoroutinefunction' is deprecated and slated for removal in Python 3.16; use inspect.iscoroutinefunction() instead
    if asyncio.iscoroutinefunction(func):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
ERROR dev/QA/Backend/Unit/test_api.py::TestHealthEndpoint::test_health_check
======================== 16 warnings, 1 error in 3.61s ========================
