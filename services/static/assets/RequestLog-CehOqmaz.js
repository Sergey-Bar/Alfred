import{a as B,j as e}from"./index-DmO1ypIk.js";import{r}from"./vendor-CoKE50sv.js";import{a4 as k,_ as P,h as I,E as O,t as z,f as H,e as Q,af as G,ag as J,m as V,o as C,n as L}from"./icons-UwgmH0ZI.js";const X={success:e.jsx(C,{className:"w-4 h-4 text-green-600"}),error:e.jsx(L,{className:"w-4 h-4 text-red-600"}),cached:e.jsx(C,{className:"w-4 h-4 text-blue-600"}),blocked:e.jsx(V,{className:"w-4 h-4 text-yellow-600"})},_={success:"badge-green",error:"badge-red",cached:"badge-blue",blocked:"badge-yellow"};function K({request:t,onClose:d}){return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:d,children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:j=>j.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Request Details"}),e.jsx("button",{onClick:d,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Request ID"}),e.jsx("p",{className:"font-mono",children:t.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Timestamp"}),e.jsx("p",{children:new Date(t.timestamp).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"User"}),e.jsx("p",{children:t.user})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Team"}),e.jsx("p",{children:t.team})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Model"}),e.jsx("p",{className:"font-mono",children:t.model})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Provider"}),e.jsx("p",{children:t.provider})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Tokens (in/out)"}),e.jsxs("p",{children:[t.input_tokens?.toLocaleString()," / ",t.output_tokens?.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Cost"}),e.jsxs("p",{className:"font-semibold",children:["$",t.cost?.toFixed(4)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Latency"}),e.jsxs("p",{children:[t.latency_ms,"ms"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-primary-400)"},children:"Status"}),e.jsx("span",{className:`badge ${_[t.status]||"badge-gray"}`,children:t.status})]})]}),t.routing_decision&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg",style:{background:"var(--color-primary-100)"},children:[e.jsx("p",{className:"text-xs font-medium mb-1",style:{color:"var(--color-primary-400)"},children:"Routing Decision"}),e.jsx("p",{className:"text-sm",children:t.routing_decision})]}),t.cache_hit&&e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-blue-50",children:[e.jsx("p",{className:"text-xs font-medium text-blue-600 mb-1",children:"Cache Hit"}),e.jsxs("p",{className:"text-sm",children:["Similarity: ",(t.cache_similarity*100).toFixed(1),"%"]})]})]})})}):null}function q(){const[t,d]=r.useState([]),[j,f]=r.useState(!0),[y,R]=r.useState(""),[v,$]=r.useState("all"),[g,D]=r.useState("all"),[h,A]=r.useState("timestamp"),[p,N]=r.useState("desc"),[c,m]=r.useState(1),[T,b]=r.useState(null),x=20;r.useEffect(()=>{w()},[]);const w=async()=>{f(!0);try{const s=await B.fetchJson("/admin/request-log");d(Array.isArray(s)?s:s?.items||[])}catch{d([])}finally{f(!1)}},F=s=>{h===s?N(p==="asc"?"desc":"asc"):(A(s),N("desc"))},M=({field:s})=>h!==s?null:p==="asc"?e.jsx(G,{className:"w-3 h-3 inline ml-1"}):e.jsx(J,{className:"w-3 h-3 inline ml-1"}),i=t.filter(s=>{if(y){const a=y.toLowerCase();if(!s.id?.toLowerCase().includes(a)&&!s.user?.toLowerCase().includes(a)&&!s.model?.toLowerCase().includes(a)&&!s.team?.toLowerCase().includes(a))return!1}return!(v!=="all"&&s.model!==v||g!=="all"&&s.status!==g)}).sort((s,a)=>{let n=s[h],o=a[h];return typeof n=="string"&&(n=n.toLowerCase()),typeof o=="string"&&(o=o.toLowerCase()),n<o?p==="asc"?-1:1:n>o?p==="asc"?1:-1:0}),u=Math.max(1,Math.ceil(i.length/x)),S=i.slice((c-1)*x,c*x),E=[...new Set(t.map(s=>s.model))].filter(Boolean),U=()=>{const s=["id,timestamp,user,team,model,provider,input_tokens,output_tokens,cost,latency_ms,status",...i.map(l=>`${l.id},${l.timestamp},${l.user},${l.team},${l.model},${l.provider},${l.input_tokens},${l.output_tokens},${l.cost},${l.latency_ms},${l.status}`)].join(`
`),a=new Blob([s],{type:"text/csv"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download="request_log.csv",o.click(),URL.revokeObjectURL(n)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Request Log"}),e.jsxs("p",{style:{color:"var(--color-primary-500)"},children:[i.length.toLocaleString()," requests tracked"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:w,className:"btn flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"})," Refresh"]}),e.jsxs("button",{onClick:U,className:"btn flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"})," Export CSV"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Total Requests",value:t.length.toLocaleString(),color:"text-blue-600"},{label:"Success Rate",value:t.length>0?(t.filter(s=>s.status==="success").length/t.length*100).toFixed(1)+"%":"—",color:"text-green-600"},{label:"Cache Hits",value:t.filter(s=>s.status==="cached").length.toLocaleString(),color:"text-purple-600"},{label:"Avg Latency",value:t.length>0?Math.round(t.reduce((s,a)=>s+(a.latency_ms||0),0)/t.length)+"ms":"—",color:"text-orange-600"}].map(s=>e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:s.label}),e.jsx("p",{className:`text-xl font-bold ${s.color}`,children:s.value})]},s.label))}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"var(--color-primary-400)"}}),e.jsx("input",{type:"text",className:"input w-full pl-10",placeholder:"Search by request ID, user, model, team...",value:y,onChange:s=>{R(s.target.value),m(1)}})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4",style:{color:"var(--color-primary-400)"}}),e.jsxs("select",{className:"input",value:v,onChange:s=>{$(s.target.value),m(1)},children:[e.jsx("option",{value:"all",children:"All Models"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{className:"input",value:g,onChange:s=>{D(s.target.value),m(1)},children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"cached",children:"Cached"}),e.jsx("option",{value:"blocked",children:"Blocked"})]})]})]})}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{style:{background:"var(--color-primary-100)"},children:[{key:"timestamp",label:"Time"},{key:"user",label:"User"},{key:"model",label:"Model"},{key:"input_tokens",label:"Tokens"},{key:"cost",label:"Cost"},{key:"latency_ms",label:"Latency"},{key:"status",label:"Status"}].map(s=>e.jsxs("th",{className:"px-4 py-3 text-left font-medium cursor-pointer hover:bg-gray-200 select-none",onClick:()=>F(s.key),children:[s.label," ",e.jsx(M,{field:s.key})]},s.key))})}),e.jsx("tbody",{children:j?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12",children:[e.jsx(k,{className:"w-6 h-6 animate-spin mx-auto mb-2",style:{color:"var(--color-primary-400)"}}),e.jsx("p",{style:{color:"var(--color-primary-400)"},children:"Loading requests..."})]})}):S.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12",children:[e.jsx(z,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-primary-300)"}}),e.jsx("p",{style:{color:"var(--color-primary-400)"},children:"No requests found"})]})}):S.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50 cursor-pointer",style:{borderColor:"var(--color-primary-200)"},onClick:()=>b(s),children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"text-xs",children:new Date(s.timestamp).toLocaleTimeString()}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:new Date(s.timestamp).toLocaleDateString()})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"font-medium",children:s.user}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:s.team})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("code",{className:"text-xs px-2 py-1 rounded",style:{background:"var(--color-primary-100)"},children:s.model})}),e.jsxs("td",{className:"px-4 py-3 text-xs",children:[e.jsx("span",{className:"text-green-600",children:s.input_tokens?.toLocaleString()})," / ",e.jsx("span",{className:"text-blue-600",children:s.output_tokens?.toLocaleString()})]}),e.jsxs("td",{className:"px-4 py-3 font-medium",children:["$",s.cost?.toFixed(4)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:s.latency_ms>2e3?"text-red-600":s.latency_ms>1e3?"text-yellow-600":"text-green-600",children:[s.latency_ms,"ms"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`badge ${_[s.status]||""} flex items-center gap-1 w-fit`,children:[X[s.status]," ",s.status]})})]},s.id))})]})}),u>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",style:{borderColor:"var(--color-primary-200)"},children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--color-primary-500)"},children:["Showing ",(c-1)*x+1,"–",Math.min(c*x,i.length)," of ",i.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(Math.max(1,c-1)),disabled:c===1,className:"btn btn-sm",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Page ",c," of ",u]}),e.jsx("button",{onClick:()=>m(Math.min(u,c+1)),disabled:c===u,className:"btn btn-sm",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})]}),e.jsx(K,{request:T,onClose:()=>b(null)})]})}export{q as default};
