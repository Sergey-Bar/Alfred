import{a as S,j as e}from"./index-DmO1ypIk.js";import{r as d}from"./vendor-CoKE50sv.js";import{T as $,af as k,ag as D,p as L,m as M,q as f}from"./icons-UwgmH0ZI.js";import{R as C,e as T,C as A,X as F,Y as R,T as B,L as O,a as b,f as N}from"./charts-DbFJi66O.js";function P(){const c=[],m=new Date,i=3200+Math.random()*800;let l=0;for(let a=-14;a<=0;a++){const r=new Date(m);r.setDate(r.getDate()+a);const n=i+(Math.random()-.5)*1200;l+=n,c.push({date:r.toISOString().slice(5,10),actual:Math.round(l),daily:Math.round(n),type:"historical"})}const t=l;let o=t;for(let a=1;a<=16;a++){const r=new Date(m);r.setDate(r.getDate()+a);const n=i+(Math.random()-.5)*400;o+=n,c.push({date:r.toISOString().slice(5,10),projected:Math.round(o),projectedHigh:Math.round(o*1.12),projectedLow:Math.round(o*.88),daily:Math.round(n),type:"forecast"})}return{data:c,dailyBurn:Math.round(i),lastActual:Math.round(t),projected:Math.round(o)}}function U(){const[c,m]=d.useState(null),[i,l]=d.useState(!0),[t]=d.useState(15e4),[o,a]=d.useState("30d");d.useEffect(()=>{r()},[]);const r=async()=>{l(!0);try{await S.fetchJson("/intelligence/forecast")}catch{}const s=P();m(s),l(!1)};if(i||!c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-blue-500 border-t-transparent"})});const{data:n,dailyBurn:v,lastActual:p,projected:x}=c,h=v,j=Math.max(0,Math.round((t-p)/h)),u=x>t,w=(p/t*100).toFixed(1),y=(x/t*100).toFixed(1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Budget Forecast"}),e.jsx("p",{style:{color:"var(--color-primary-500)"},children:"AI-powered spend prediction based on 14-day rolling window"})]}),e.jsx("div",{className:"flex items-center gap-2",children:["7d","30d","90d"].map(s=>e.jsx("button",{onClick:()=>a(s),className:`btn btn-sm ${o===s?"btn-primary":""}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Current Spend"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",p.toLocaleString()]}),e.jsxs("p",{className:"text-xs",style:{color:"var(--color-primary-500)"},children:[w,"% of $",t.toLocaleString()," budget"]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Daily Burn Rate"}),e.jsxs("p",{className:"text-2xl font-bold flex items-center gap-1",children:["$",h.toLocaleString(),e.jsx($,{className:"w-5 h-5 text-orange-500"})]}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-500)"},children:"per day average"})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Projected Month-End"}),e.jsxs("p",{className:`text-2xl font-bold ${u?"text-red-600":"text-green-600"}`,children:["$",x.toLocaleString()]}),e.jsx("p",{className:"text-xs flex items-center gap-1",children:u?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-3 h-3 text-red-500"}),e.jsxs("span",{className:"text-red-600",children:[y,"% — Over budget!"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-3 h-3 text-green-500"}),e.jsxs("span",{className:"text-green-600",children:[y,"% of budget"]})]})})]}),e.jsxs("div",{className:"card p-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Days Until Limit"}),e.jsx("p",{className:`text-2xl font-bold ${j<7?"text-red-600":j<14?"text-yellow-600":"text-green-600"}`,children:j}),e.jsxs("p",{className:"text-xs flex items-center gap-1",style:{color:"var(--color-primary-500)"},children:[e.jsx(L,{className:"w-3 h-3"})," at current burn rate"]})]})]}),u&&e.jsxs("div",{className:"p-4 rounded-lg border border-red-200 bg-red-50 flex items-start gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-700",children:"Budget Overrun Projected"}),e.jsxs("p",{className:"text-sm text-red-600",children:["At the current burn rate of $",h.toLocaleString(),"/day, you'll exceed your $",t.toLocaleString()," budget by $",(x-t).toLocaleString(),". Consider enabling cost-based routing or reducing token limits per team."]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Spend Projection"}),e.jsx(C,{width:"100%",height:400,children:e.jsxs(T,{data:n,children:[e.jsx(A,{strokeDasharray:"3 3",stroke:"var(--color-primary-200)"}),e.jsx(F,{dataKey:"date",tick:{fontSize:12}}),e.jsx(R,{tickFormatter:s=>`$${(s/1e3).toFixed(0)}k`,tick:{fontSize:12}}),e.jsx(B,{formatter:(s,g)=>[`$${s?.toLocaleString()}`,g],labelFormatter:s=>`Date: ${s}`}),e.jsx(O,{}),e.jsx(b,{dataKey:"projectedHigh",stroke:"none",fill:"#dbeafe",fillOpacity:.4,name:"Upper bound"}),e.jsx(b,{dataKey:"projectedLow",stroke:"none",fill:"#ffffff",fillOpacity:1,name:"Lower bound"}),e.jsx(N,{dataKey:"actual",stroke:"#2563eb",strokeWidth:2,dot:!1,name:"Actual Spend"}),e.jsx(N,{dataKey:"projected",stroke:"#f97316",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"Projected"})]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs",style:{color:"var(--color-primary-400)"},children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-0.5 bg-blue-600"})," Actual"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-0.5 bg-orange-500 border-dashed",style:{borderTop:"2px dashed"}})," Forecast"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-4 h-2 bg-blue-100"})," 88–112% confidence"]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Cost Optimization Recommendations"}),e.jsx("div",{className:"space-y-3",children:[{icon:f,title:"Enable Semantic Caching",desc:"Current cache hit rate is 34%. Increasing TTL to 60min could save ~$2,400/month.",savings:"$2,400"},{icon:f,title:"Switch to Cost-Based Routing",desc:"Route non-critical requests from GPT-4o to GPT-4o-mini for 65% cost reduction on eligible traffic.",savings:"$4,800"},{icon:f,title:"Set Team Budget Caps",desc:"Top 3 teams account for 72% of spend. Implementing soft limits could reduce overuse by 15%.",savings:"$1,200"}].map((s,g)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border hover:bg-gray-50",children:[e.jsx(s.icon,{className:"w-5 h-5 text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-primary-500)"},children:s.desc})]}),e.jsxs("span",{className:"badge badge-green shrink-0",children:["Save ",s.savings,"/mo"]})]},g))})]})]})}export{U as default};
