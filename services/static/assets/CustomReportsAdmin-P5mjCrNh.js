import{j as e,a as l}from"./index-DmO1ypIk.js";import{r as i}from"./vendor-CoKE50sv.js";import"./icons-UwgmH0ZI.js";function C(){const[h,m]=i.useState([]),[r,s]=i.useState({name:"",description:"",query:"",schedule:"",format:"csv",recipients:""}),[c,u]=i.useState(""),[x,d]=i.useState({});async function p(){m(await l.listCustomReports())}i.useEffect(()=>{p()},[]);async function j(t){t.preventDefault(),await l.createCustomReport({...r,recipients:r.recipients?r.recipients.split(",").map(n=>n.trim()):void 0}),s({name:"",description:"",query:"",schedule:"",format:"csv",recipients:""}),u("Report created"),p()}async function f(t,n){d(o=>({...o,[t]:!0}));const a=await l.runCustomReport(t,{format:n});d(o=>({...o,[t]:!1})),a.output_url?window.open(a.output_url,"_blank"):u("Report run failed: "+(a.error||"Unknown error"))}return e.jsxs("div",{style:{padding:24},children:[e.jsx("h2",{children:"Custom Analytics & Reports"}),c&&e.jsx("div",{style:{color:"green",marginBottom:8},children:c}),e.jsxs("form",{onSubmit:j,style:{marginBottom:24},children:[e.jsx("input",{required:!0,placeholder:"Name",value:r.name,onChange:t=>s(n=>({...n,name:t.target.value}))}),e.jsx("input",{placeholder:"Description",value:r.description,onChange:t=>s(n=>({...n,description:t.target.value}))}),e.jsx("input",{required:!0,placeholder:"Query (SQL or DSL)",value:r.query,onChange:t=>s(n=>({...n,query:t.target.value}))}),e.jsx("input",{placeholder:"Schedule (cron)",value:r.schedule,onChange:t=>s(n=>({...n,schedule:t.target.value}))}),e.jsxs("select",{value:r.format,onChange:t=>s(n=>({...n,format:t.target.value})),children:[e.jsx("option",{value:"csv",children:"CSV"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"excel",children:"Excel"})]}),e.jsx("input",{placeholder:"Recipients (comma-separated emails)",value:r.recipients,onChange:t=>s(n=>({...n,recipients:t.target.value}))}),e.jsx("button",{type:"submit",children:"Create Report"})]}),e.jsx("h3",{children:"All Reports"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Schedule"}),e.jsx("th",{children:"Last Run"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{children:t.description}),e.jsx("td",{children:t.format}),e.jsx("td",{children:t.schedule}),e.jsx("td",{children:t.last_run?new Date(t.last_run).toLocaleString():"-"}),e.jsx("td",{children:e.jsx("button",{disabled:x[t.id],onClick:()=>f(t.id,t.format),children:"Run & Export"})})]},t.id))})]})]})}export{C as default};
