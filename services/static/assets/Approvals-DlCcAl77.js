import{j as e,b as L,a as w}from"./index-DmO1ypIk.js";import{r as a}from"./vendor-CoKE50sv.js";import{X as F,v as T,t as M,o as _,n as A,a as P}from"./icons-UwgmH0ZI.js";function $({isOpen:s,onClose:l,title:o,children:k,className:p="",showCloseButton:f=!0,size:v="md"}){const i=a.useRef(null),g=a.useRef(null),N={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl",full:"max-w-full mx-4"};a.useEffect(()=>{s?g.current=document.activeElement:g.current&&g.current.focus()},[s]);const c=a.useCallback(()=>i.current?i.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'):[],[]);if(a.useEffect(()=>{if(!s)return;const d=r=>{if(r.key==="Escape"){r.preventDefault(),l();return}if(r.key==="Tab"){const u=c();if(u.length===0)return;const b=u[0],m=u[u.length-1];r.shiftKey?document.activeElement===b&&(r.preventDefault(),m.focus()):document.activeElement===m&&(r.preventDefault(),b.focus())}};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[s,l,c]),a.useEffect(()=>{if(!s)return;const d=setTimeout(()=>{const r=c();r.length>0&&r[0].focus()},50);return()=>clearTimeout(d)},[s,c]),a.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[s]),!s)return null;const n=`modal-title-${Math.random().toString(36).substr(2,9)}`;return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":o?n:void 0,"aria-modal":"true",role:"dialog",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 transition-opacity animate-fade-in",onClick:l,"aria-hidden":"true"}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{ref:i,className:`
                        relative bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full
                        animate-scale-in border border-gray-200 dark:border-gray-700
                        ${N[v]||N.md}
                        ${p}
                    `,children:[(o||f)&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[o&&e.jsx("h2",{id:n,className:"text-lg font-semibold text-gray-900 dark:text-white",children:o}),f&&e.jsx("button",{type:"button",onClick:l,className:`text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 \r
                                               focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-1`,"aria-label":"Close modal",children:e.jsx(F,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-4",children:k})]})})]})}function K(){const{showToast:s}=L(),[l,o]=a.useState([]),[k,p]=a.useState(!0),[f,v]=a.useState(null),[i,g]=a.useState("pending"),[N,c]=a.useState(!1),[n,d]=a.useState({amount:"",reason:""}),[r,u]=a.useState(!1),[b,m]=a.useState(null);a.useEffect(()=>{j()},[]);async function j(){try{p(!0);const t=await w.getPendingApprovals(),y=(Array.isArray(t)?t:t.approvals||[]).map(x=>({...x,user_name:x.user_name||"Unknown User",user_email:x.user_email||"",requested_amount:x.requested_credits||x.requested_amount,approved_amount:x.approved_credits||x.approved_amount}));o(y)}catch(t){v(t?.message||"Failed to load approvals"),o([])}finally{p(!1)}}async function E(t){if(t.preventDefault(),!n.amount||!n.reason){s("Please enter amount and reason","error");return}try{u(!0),await w.createApprovalRequest(parseInt(n.amount),n.reason),s("Quota request submitted successfully","success"),c(!1),d({amount:"",reason:""}),j()}catch(h){s(h.message||"Failed to submit request","error")}finally{u(!1)}}async function S(t,h=null){try{m(t),await w.approveRequest(t,h),s("Request approved","success"),j()}catch(y){s(y.message||"Failed to approve request","error")}finally{m(null)}}async function C(t){const h=prompt("Reason for rejection (optional):");try{m(t),await w.rejectRequest(t,h||""),s("Request rejected","success"),j()}catch(y){s(y.message||"Failed to reject request","error")}finally{m(null)}}function D(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}const R=l.filter(t=>i==="all"?!0:t.status===i),q={pending:l.filter(t=>t.status==="pending").length,approved:l.filter(t=>t.status==="approved").length,rejected:l.filter(t=>t.status==="rejected").length};return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quota Approvals"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage quota increase requests"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn btn-primary flex items-center",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Request Quota"]})]}),f&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-900/30 text-yellow-400 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",f,". Demo data not used."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{v(null),j()},className:"btn btn-primary",children:"Retry"}),e.jsx("a",{href:"mailto:support@example.com",className:"btn btn-secondary",children:"Contact Support"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-8 w-8 text-yellow-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:q.pending}),e.jsx("p",{className:"stat-label",children:"Pending"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-8 w-8 text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:q.approved}),e.jsx("p",{className:"stat-label",children:"Approved"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-8 w-8 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:q.rejected}),e.jsx("p",{className:"stat-label",children:"Rejected"})]})]})})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"flex space-x-2",children:["pending","approved","rejected","all"].map(t=>e.jsx("button",{onClick:()=>g(t),className:`px-4 py-2 text-sm rounded-lg ${i===t?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400 font-medium":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"space-y-4",children:[R.map(t=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mr-3",children:t.user_name}),e.jsx("span",{className:`badge ${t.status==="pending"?"badge-yellow":t.status==="approved"?"badge-green":"badge-red"}`,children:t.status})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:t.user_email}),e.jsxs("div",{className:"flex items-center text-sm mb-2",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:t.reason})]}),e.jsx("p",{className:"text-xs text-gray-400",children:D(t.created_at)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:[(t.requested_credits||t.requested_amount)?.toLocaleString()," tokens"]}),t.status==="approved"&&(t.approved_credits||t.approved_amount)&&e.jsxs("p",{className:"text-sm text-green-500",children:["Approved: ",(t.approved_credits||t.approved_amount).toLocaleString()]}),t.status==="rejected"&&t.rejection_reason&&e.jsx("p",{className:"text-sm text-red-400",children:t.rejection_reason}),t.status==="pending"&&e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs("button",{onClick:()=>S(t.id,t.requested_credits||t.requested_amount),disabled:b===t.id,className:"btn btn-sm bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs("button",{onClick:()=>C(t.id),disabled:b===t.id,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})]})},t.id)),R.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:["No ",i==="all"?"":i," requests found"]})]})}),e.jsx($,{isOpen:N,onClose:()=>c(!1),title:"Request Additional Quota",children:e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount Requested (tokens)"}),e.jsx("input",{type:"number",min:"1",value:n.amount,onChange:t=>d({...n,amount:t.target.value}),className:"input w-full",placeholder:"e.g., 5000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason / Justification"}),e.jsx("textarea",{value:n.reason,onChange:t=>d({...n,reason:t.target.value}),className:"input w-full",rows:4,placeholder:"Explain why you need additional tokens...",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:r,children:r?"Submitting...":"Submit Request"})]})]})})]})}export{K as default};
