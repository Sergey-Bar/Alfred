import{b as M,a as m,j as e}from"./index-DmO1ypIk.js";import{r as n}from"./vendor-CoKE50sv.js";import{D as $}from"./DeleteConfirmDialog-DUf4Drw1.js";import{v as F,h as O,w as P,x as R}from"./icons-UwgmH0ZI.js";function B(){const{showToast:r}=M(),[v,p]=n.useState([]),[_,j]=n.useState(!0),[b,f]=n.useState(null),[x,w]=n.useState(""),[k,i]=n.useState(!1),[d,y]=n.useState(null),[C,u]=n.useState(!1),[c,h]=n.useState(null),[U,N]=n.useState(!1),[t,l]=n.useState({name:"",email:"",personal_quota:1e3,is_admin:!1});n.useEffect(()=>{o()},[]);async function o(){try{j(!0);const g=(await m.getUsers()).map(s=>({user_id:s.id,name:s.name,email:s.email,personal_quota:s.personal_quota,used_tokens:s.used_tokens,remaining_tokens:s.available_quota,usage_percentage:s.personal_quota>0?Math.round(s.used_tokens/s.personal_quota*100):0,status:s.status,on_vacation:s.status==="vacation",is_admin:!1}));p(g)}catch(a){f(a?.message||"Failed to load users"),p([])}finally{j(!1)}}const S=v.filter(a=>a.name?.toLowerCase().includes(x.toLowerCase())||a.email?.toLowerCase().includes(x.toLowerCase()));function D(){y(null),l({name:"",email:"",personal_quota:1e3,is_admin:!1}),i(!0)}function q(a){y(a),l({name:a.name,email:a.email,personal_quota:a.personal_quota,is_admin:a.is_admin||!1}),i(!0)}async function E(a){a.preventDefault();try{d?(await m.updateUser(d.user_id,t),r({type:"success",title:"User Updated",message:`${t.name} has been updated`})):(await m.createUser(t),r({type:"success",title:"User Created",message:`${t.name} has been created`})),i(!1),o()}catch(g){r({type:"error",title:"Error",message:g.message||"Failed to save user"})}}function L(a){h(a),u(!0)}async function T(){if(c){N(!0);try{await m.deleteUser(c.user_id),r({type:"success",title:"User Deleted",message:`${c.name} has been deleted`}),u(!1),h(null),o()}catch(a){r({type:"error",title:"Error",message:a.message||"Failed to delete user"})}finally{N(!1)}}}function A(a){return a>=90?"text-red-600 bg-red-100":a>=70?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100"}return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Users"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage user accounts and quotas"})]}),e.jsxs("button",{onClick:D,className:"btn btn-primary flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Add User"]})]}),b&&e.jsxs("div",{className:"mb-4 p-3 bg-orange-50 text-orange-700 border border-orange-300 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",b,". Demo data not used."]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>{f(null),o()},className:"btn btn-primary",children:"Retry"})})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search users by name or email...",className:"input w-full pl-10",value:x,onChange:a=>w(a.target.value)})]})}),e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"User"}),e.jsx("th",{children:"Quota"}),e.jsx("th",{children:"Usage"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:S.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.email})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[a.used_tokens?.toLocaleString()," / ",a.personal_quota?.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.remaining_tokens?.toLocaleString()," remaining"]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${a.usage_percentage>=90?"bg-red-500":a.usage_percentage>=70?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(a.usage_percentage,100)}%`}})}),e.jsxs("span",{className:`badge ${A(a.usage_percentage)}`,children:[a.usage_percentage,"%"]})]})}),e.jsx("td",{children:a.on_vacation?e.jsx("span",{className:"badge badge-yellow",children:"On Vacation"}):e.jsx("span",{className:"badge badge-green",children:"Active"})}),e.jsx("td",{children:a.is_admin?e.jsx("span",{className:"badge badge-blue",children:"Admin"}):e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"User"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>q(a),className:"p-1 text-gray-400 hover:text-blue-600",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>L(a),className:"p-1 text-gray-400 hover:text-red-600",children:e.jsx(R,{className:"h-5 w-5"})})]})})]},a.user_id))})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:d?"Edit User":"Add User"}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Name"}),e.jsx("input",{type:"text",className:"input",value:t.name,onChange:a=>l({...t,name:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Email"}),e.jsx("input",{type:"email",className:"input",value:t.email,onChange:a=>l({...t,email:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1",children:"Personal Quota"}),e.jsx("input",{type:"number",className:"input",value:t.personal_quota,onChange:a=>l({...t,personal_quota:parseInt(a.target.value)}),required:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_admin",className:"h-4 w-4 text-blue-600 rounded",checked:t.is_admin,onChange:a=>l({...t,is_admin:a.target.checked})}),e.jsx("label",{htmlFor:"is_admin",className:"ml-2 text-sm text-gray-700 dark:text-gray-200",children:"Administrator privileges"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:d?"Save Changes":"Create User"})]})]})]})}),e.jsx($,{isOpen:C,onClose:()=>{u(!1),h(null)},onConfirm:T,itemName:c?.name||"",itemType:"user",loading:U})]})}export{B as default};
