#ğŸš€AlfredServicesArchitecture**Project:**Alfredâ€”EnterpriseAIControl&EconomyPlatform**Purpose:**Microservicesarchitecturedocumentation**LastUpdated:**2026-02-19---##ğŸ¯OverviewAlfredusesa**hybridarchitecture**combining:-**PythonFastAPIBackend**(`src/backend/`)-Coreledger,governance,andbusinesslogic-**GoGatewayService**(`services/gateway/`)-High-performancerequestroutingandproviderintegration-**ReactFrontend**(`src/frontend/`)-AdmindashboardandmanagementUIThisarchitectureoptimizesfor:-**Performance:**Gogatewayhandleshigh-throughputLLMtraffic-**Reliability:**Pythonbackendmanagescriticalfinanciallogicwithstrongtyping-**Maintainability:**Clearseparationofconcernsbetweenroutingandgovernance---##ğŸ“ŠServiceMap```â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚AlfredPlatformâ”‚â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚â”‚â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚Frontendâ”‚â—„â”€â”€â”€â”€â–ºâ”‚Backendâ”‚â”‚Gatewayâ”‚â”‚â”‚â”‚(React/TS)â”‚â”‚(FastAPI)â”‚â—„â”€â”€â”€â”€â–ºâ”‚(Go)â”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â”‚â–¼â–¼â–¼â”‚â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚PostgreSQLDatabaseâ”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â”‚â”‚â–¼â”‚â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚RedisCacheâ”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â–¼â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚LLMProviderNetworkâ”‚â”‚(OpenAI,Anthropic,etc.)â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜```---##ğŸ—ï¸Services###1.GatewayService(Go)**Location:**`services/gateway/`**Language:**Go1.21+**Purpose:**High-performanceLLMrequestroutingandproviderintegration**KeyResponsibilities:**-**RequestRouting:**Intelligentmodelselectionandfailover-**ProviderIntegration:**Connectorsfor100+LLMproviders-**Caching:**Semanticcachingforresponsededuplication-**Observability:**Metrics,tracing,andlogging-**Security:**Ratelimiting,inputvalidation,PIIdetection**TechnologyStack:**-**Framework:**Chirouter(lightweight,fast)-**Database:**PostgreSQLviapgxdriver-**Cache:**Redisforsemanticcacheandratelimiting-**Observability:**Prometheusmetrics,OpenTelemetrytracing-**Security:**golangci-lint,inputsanitization**QuickStart:**```bashcdservices/gatewaygorun.```**Docker:**```bashdockerbuild-talfred-gateway:localservices/gateway/dockerrun-p8080:8080alfred-gateway:local```**Documentation:**[gateway/README.md](gateway/README.md)---###2.BackendService(PythonFastAPI)**Location:**`src/backend/`**Language:**Python3.11+**Purpose:**Corebusinesslogic,financialledger,andgovernance**KeyResponsibilities:**-**LedgerSystem:**Creditmanagement,walletoperations,auditlogs-**UserManagement:**Authentication,authorization,teamstructure-**Governance:**Policies,approvalworkflows,compliance-**Analytics:**Costattribution,usagereporting,ROItracking-**AdminAPI:**Dashboardendpoints,configurationmanagement**TechnologyStack:**-**Framework:**FastAPI(async,type-safe)-**ORM:**SQLAlchemy2.0-**DatabaseMigrations:**Alembic-**Validation:**Pydanticv2(strictmode)-**Security:**JWTauthentication,RBAC,PIIdetection**QuickStart:**```bashcdsrc/backenduvicornapp.main:app--reload```**Documentation:**[src/backend/README.md](../src/backend/README.md)---###3.FrontendService(React)**Location:**`src/frontend/`**Language:**TypeScript**Purpose:**AdmindashboardandmanagementUI**KeyResponsibilities:**-**Dashboard:**Usagemetrics,costanalytics,teammanagement-**UserManagement:**Createusers,managewallets,configurepolicies-**Monitoring:**Real-timerequesttracking,providerhealth-**Configuration:**Modelroutingrules,approvalworkflows**TechnologyStack:**-**Framework:**React18+Vite-**StateManagement:**ReactQuery-**UIComponents:**Customcomponentlibrary-**Build:**Vite(fastHMR)**QuickStart:**```bashcdsrc/frontendnpmrundev```**Documentation:**[src/frontend/README.md](../src/frontend/README.md)---##ğŸ”„ServiceInteractionPatterns###RequestFlow**1.UserRequestâ†’Gateway**```ClientAppâ†’GatewayServiceâ”œâ”€Ratelimitingcheck(Redis)â”œâ”€Semanticcachelookup(Redis)â””â”€Ifcachemissâ†’Forwardtoprovider```**2.GovernanceCheckâ†’Backend**```Gatewayâ†’BackendServiceâ”œâ”€ValidateAPIkeyâ”œâ”€Checkwalletbalanceâ”œâ”€Deductcredits(ledgertransaction)â””â”€Returnauthorizationdecision```**3.ProviderRequestâ†’LLM**```Gatewayâ†’LLMProviderâ”œâ”€Transformrequest(OpenAI-compatible)â”œâ”€SendtoproviderAPIâ”œâ”€Handleresponse/errorsâ””â”€Cacheresponse(semantic)```**4.Audit&Metricsâ†’Database**```Gateway/Backendâ†’PostgreSQLâ”œâ”€Logrequestmetadataâ”œâ”€Storeaudittrail(immutable)â”œâ”€Updateusagemetricsâ””â”€Recordcostattribution```###ServiceDependencies```Frontendâ””â”€â–ºBackendAPI(/api/*)â”œâ”€â–ºPostgreSQL(ledger,users,wallets)â”œâ”€â–ºRedis(sessions,cache)â””â”€â–ºGateway(healthchecks)Gatewayâ”œâ”€â–ºBackendAPI(quotavalidation)â”œâ”€â–ºPostgreSQL(auditlogs,routingrules)â”œâ”€â–ºRedis(semanticcache,ratelimits)â””â”€â–ºLLMProviders(OpenAI,Anthropic,etc.)```---##ğŸš€DevelopmentWorkflow###LocalDevelopment(AllServices)**1.StartInfrastructure:**```bashdocker-composeup-dpostgresredis```**2.StartBackend:**```bashcdsrc/backenduvicornapp.main:app--reload--port8000```**3.StartGateway:**```bashcdservices/gatewaygorun.--port8080```**4.StartFrontend:**```bashcdsrc/frontendnpmrundev--port3000```**Access:**-Frontend:http://localhost:3000-BackendAPI:http://localhost:8000/docs-Gateway:http://localhost:8080/healthz---###FullStackwithDockerCompose```bashdocker-composeup--build```Thisstartsallserviceswithpropernetworkinganddependencies.---##ğŸ§ªTesting###GatewayTests```bashcdservices/gatewaygotest./...-v```**CoverageTarget:**80%+**CurrentCoverage:**45%(T297-inprogress)###BackendTests```bashcdsrc/backendpytest-v```**CoverageTarget:**90%+**CurrentCoverage:**39%###E2ETests(AllServices)```bashnpmruntest:e2e```Testscompleterequestflowsacrossallservices.---##ğŸ“ŠPerformanceCharacteristics###GatewayService|Metric|Target|Current||------------------|-----------|----------||**P95Latency**|<150ms|~120ms||**Throughput**|10kreq/min|8kreq/min||**CacheHitRate**|>30%|28%||**Uptime**|99.9%|99.7%|###BackendService|Metric|Target|Current||----------------------|----------|---------||**APIResponse(P95)**|<200ms|~180ms||**LedgerThroughput**|10ktx/min|9ktx/min||**Uptime**|99.9%|99.8%|---##ğŸ”’Security###GatewaySecurity-**RateLimiting:**Redis-basedper-keylimits-**InputValidation:**Strictrequestschemavalidation-**PIIDetection:**Automaticredactionbeforelogging-**SecretScanning:**Pre-commithooks-**TLS:**Requiredinproduction###BackendSecurity-**Authentication:**JWT-basedwithrefreshtokens-**Authorization:**RBACwithteamhierarchy-**InputValidation:**Pydanticstrictmode(22schemas)-**SQLInjection:**Parameterizedqueriesonly-**AuditLogging:**Immutablehash-chainedlogs---##ğŸ› ï¸Deployment###Kubernetes(Production)**UsingHelm:**```bashcdtools/helmhelminstallalfred./alfred\--namespacealfred\--create-namespace\--valuesvalues-prod.yaml```**ServicesDeployed:**-`alfred-gateway`(3replicas,autoscaling)-`alfred-backend`(2replicas,autoscaling)-`alfred-frontend`(2replicas,staticserving)-`postgres`(StatefulSet,1primary+1replica)-`redis`(StatefulSet,1primary+2replicas)###DockerCompose(Development)```bashdocker-composeup-d```###CloudPlatforms**AWS:**-EKSforKubernetes-RDSforPostgreSQL-ElastiCacheforRedis-ALBforingress**GCP:**-GKEforKubernetes-CloudSQLforPostgreSQL-MemorystoreforRedis-CloudLoadBalancer**Azure:**-AKSforKubernetes-AzureDatabaseforPostgreSQL-AzureCacheforRedis-ApplicationGateway---##ğŸ“ŠMonitoring&Observability###Metrics**PrometheusEndpoints:**-Gateway:`http://gateway:8080/metrics`-Backend:`http://backend:8000/metrics`**KeyMetrics:**-`alfred_request_duration_seconds`-Requestlatencyhistogram-`alfred_requests_total`-Totalrequestscounter-`alfred_cache_hits_total`-Cachehitrate-`alfred_wallet_balance`-Teamwalletbalances-`alfred_provider_errors_total`-Providererrorrates###Dashboards**Grafana:**```bash#Importdashboardkubectlapply-fdevops/grafana/alfred-gateway-dashboard.json```**DashboardsAvailable:**1.GatewayPerformance2.LedgerOperations3.ProviderHealth4.CostAnalytics###Tracing**OpenTelemetry:**-Gateway:Automaticspancreationforeachrequest-Backend:Tracepropagationacrossservices-Export:JaegerorHoneycomb###Logging**StructuredLogging:**-Format:JSON-Fields:request_id,user_id,team_id,model,provider,cost-Aggregation:LokiorELKstack---##ğŸ”§Configuration###GatewayConfiguration**EnvironmentVariables:**```bashGATEWAY_ADDR=:8080DATABASE_URL=postgres://...REDIS_URL=redis://...ENV=productionLOG_LEVEL=info```**ConfigFile:**`services/gateway/config/config.yaml`###BackendConfiguration**EnvironmentVariables:**```bashDATABASE_URL=postgresql://...REDIS_URL=redis://...SECRET_KEY=...ENVIRONMENT=production```**ConfigFile:**`src/backend/.env`---##ğŸ›Troubleshooting###CommonIssues**Gatewaywon'tstart:**```bash#Checkdatabaseconnectionpsql$DATABASE_URL-c"SELECT1"#CheckRedisconnectionredis-cli-u$REDIS_URLPING#CheckGoversiongoversion#Shouldbe1.21+```**Backenddatabaseerrors:**```bash#Runmigrationscdsrc/backendalembic-cconfig/alembic.iniupgradehead#Verifytablesexistpythontools/inspect_db.py```**Highlatency:**```bash#Checkcachehitrateredis-cliINFOstats|grephits#Checkproviderlatencycurlhttp://gateway:8080/metrics|grepprovider_duration#CheckdatabaseconnectionsSELECTcount(*)FROMpg_stat_activity;```###Debugging**GatewayLogs:**```bashdockerlogsalfred-gateway--follow```**BackendLogs:**```bashdockerlogsalfred-backend--follow```**DatabaseQueries:**```bash#SlowquerylogSELECT*FROMpg_stat_statementsORDERBYtotal_timeDESCLIMIT10;```---##ğŸ“šAdditionalResources###Documentation-**Gateway:**[gateway/README.md](gateway/README.md)-**Backend:**[src/backend/README.md](../src/backend/README.md)-**Frontend:**[src/frontend/README.md](../src/frontend/README.md)-**Operations:**[docs/operations/PLAYBOOK.md](../docs/operations/PLAYBOOK.md)-**APIReference:**[docs/api_documentation.md](../docs/api_documentation.md)###Tools-**CLITools:**[tools/cli/](../tools/cli/)-**SDKs:**[tools/sdk/](../tools/sdk/)-**HelmCharts:**[tools/helm/](../tools/helm/)-**Terraform:**[tools/terraform/](../tools/terraform/)###Development-**Contributing:**[services/gateway/CONTRIBUTING.md](gateway/CONTRIBUTING.md)-**CodeReview:**[reviews/](../reviews/)-**Testing:**[qa/README.md](../qa/README.md)---##ğŸ¤Contributing###AddingaNewService1.Createservicedirectory:`services/<service-name>/`2.AddDockerfileanddocker-composeentry3.DocumentinthisREADME4.AddtoCI/CDpipeline5.CreateHelmchart6.Updatearchitecturediagram###ServiceStandardsAllservicesmust:-[]SupportDockerandKubernetesdeployment-[]Expose`/healthz`and`/ready`endpoints-[]ExportPrometheusmetricsat`/metrics`-[]UsestructuredJSONlogging-[]IncludecomprehensiveREADME-[]Achieve>80%testcoverage-[]Passsecurityscans(trivy,gosec,etc.)---##ğŸ“Support**Questionsaboutservices?**-**Architecture:**SergeyBar(Architect)-**Gateway:**BackendLead-**Backend:**BackendLead-**Frontend:**FrontendLead**InternalSlack:**#alfred-services---**LastUpdated:**2026-02-19**Maintainer:**EngineeringTeam**ReviewCadence:**Bi-weekly---_AlfredServicesâ€”Scalable,secure,andproduction-ready._