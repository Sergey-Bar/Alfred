packageproviderimport("bytes""context""encoding/json""fmt""io""net/http")const(togetherBaseURL="https://api.together.xyz/v1")//TogetherProviderimplementstheProviderinterfaceforTogetherAI.typeTogetherProviderstruct{configProviderConfigclient*http.Client}//NewTogetherProvidercreatesanewTogetherAIconnector.funcNewTogetherProvider(cfgProviderConfig)*TogetherProvider{ifcfg.BaseURL==""{cfg.BaseURL=togetherBaseURL}return&TogetherProvider{config:cfg,client:&http.Client{Timeout:cfg.Timeout},}}func(p*TogetherProvider)Name()string{return"together"}func(p*TogetherProvider)Models()[]string{return[]string{"meta-llama/Llama-3.3-70B-Instruct-Turbo","meta-llama/Meta-Llama-3.1-405B-Instruct-Turbo","meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo","meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo","mistralai/Mixtral-8x22B-Instruct-v0.1","Qwen/Qwen2.5-72B-Instruct-Turbo","deepseek-ai/DeepSeek-R1","google/gemma-2-27b-it",}}func(p*TogetherProvider)HealthCheck(ctxcontext.Context)HealthStatus{req,err:=http.NewRequestWithContext(ctx,http.MethodGet,p.config.BaseURL+"/models",nil)iferr!=nil{returnHealthStatus{Healthy:false,Error:err.Error()}}req.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(req)iferr!=nil{returnHealthStatus{Healthy:false,Error:err.Error()}}deferresp.Body.Close()returnHealthStatus{Healthy:resp.StatusCode==http.StatusOK,Error:fmt.Sprintf("status=%d",resp.StatusCode),}}func(p*TogetherProvider)ChatCompletion(ctxcontext.Context,req*ChatRequest)(*ChatResponse,error){body,err:=json.Marshal(req)iferr!=nil{returnnil,fmt.Errorf("together:marshal:%w",err)}httpReq,err:=http.NewRequestWithContext(ctx,http.MethodPost,p.config.BaseURL+"/chat/completions",bytes.NewReader(body))iferr!=nil{returnnil,fmt.Errorf("together:createrequest:%w",err)}httpReq.Header.Set("Content-Type","application/json")httpReq.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(httpReq)iferr!=nil{returnnil,fmt.Errorf("together:requestfailed:%w",err)}deferresp.Body.Close()ifresp.StatusCode!=http.StatusOK{respBody,_:=io.ReadAll(resp.Body)returnnil,fmt.Errorf("together:APIerror%d:%s",resp.StatusCode,string(respBody))}varresultChatResponseiferr:=json.NewDecoder(resp.Body).Decode(&result);err!=nil{returnnil,fmt.Errorf("together:decode:%w",err)}return&result,nil}func(p*TogetherProvider)ChatCompletionStream(ctxcontext.Context,req*ChatRequest)(Stream,error){req.Stream=truebody,err:=json.Marshal(req)iferr!=nil{returnnil,fmt.Errorf("together:marshalstream:%w",err)}httpReq,err:=http.NewRequestWithContext(ctx,http.MethodPost,p.config.BaseURL+"/chat/completions",bytes.NewReader(body))iferr!=nil{returnnil,fmt.Errorf("together:createstreamrequest:%w",err)}httpReq.Header.Set("Content-Type","application/json")httpReq.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(httpReq)iferr!=nil{returnnil,fmt.Errorf("together:streamfailed:%w",err)}ifresp.StatusCode!=http.StatusOK{respBody,_:=io.ReadAll(resp.Body)resp.Body.Close()returnnil,fmt.Errorf("together:streamerror%d:%s",resp.StatusCode,string(respBody))}returnNewHTTPStream(resp),nil}func(p*TogetherProvider)Embeddings(ctxcontext.Context,req*EmbeddingsRequest)(*EmbeddingsResponse,error){body,err:=json.Marshal(req)iferr!=nil{returnnil,fmt.Errorf("together:marshalembedding:%w",err)}httpReq,err:=http.NewRequestWithContext(ctx,http.MethodPost,p.config.BaseURL+"/embeddings",bytes.NewReader(body))iferr!=nil{returnnil,fmt.Errorf("together:createembeddingrequest:%w",err)}httpReq.Header.Set("Content-Type","application/json")httpReq.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(httpReq)iferr!=nil{returnnil,fmt.Errorf("together:embeddingfailed:%w",err)}deferresp.Body.Close()ifresp.StatusCode!=http.StatusOK{respBody,_:=io.ReadAll(resp.Body)returnnil,fmt.Errorf("together:embeddingerror%d:%s",resp.StatusCode,string(respBody))}varresultEmbeddingsResponseiferr:=json.NewDecoder(resp.Body).Decode(&result);err!=nil{returnnil,fmt.Errorf("together:decodeembedding:%w",err)}return&result,nil}