packageproviderimport("encoding/json""fmt""math""os""strings""sync")//ModelPricingholdsper-modeltokenpricinginUSDper1Mtokens.typeModelPricingstruct{InputPer1Mfloat64`json:"input_per_1m"`OutputPer1Mfloat64`json:"output_per_1m"`Freebool`json:"free,omitempty"`}//PricingConfigholdsallproviderpricingdata.typePricingConfigstruct{musync.RWMutexpricingmap[string]ModelPricing//key:"provider/model"orjust"model"}//DefaultPricingreturnsthebuilt-inpricingtable(Feb2026rates).funcDefaultPricing()*PricingConfig{pc:=&PricingConfig{pricing:map[string]ModelPricing{//OpenAI"openai/gpt-4o":{InputPer1M:2.50,OutputPer1M:10.00},"openai/gpt-4o-mini":{InputPer1M:0.15,OutputPer1M:0.60},"openai/gpt-4-turbo":{InputPer1M:10.00,OutputPer1M:30.00},"openai/gpt-4":{InputPer1M:30.00,OutputPer1M:60.00},"openai/gpt-3.5-turbo":{InputPer1M:0.50,OutputPer1M:1.50},"openai/o1":{InputPer1M:15.00,OutputPer1M:60.00},"openai/o1-mini":{InputPer1M:3.00,OutputPer1M:12.00},"openai/text-embedding-3-small":{InputPer1M:0.02,OutputPer1M:0.0},"openai/text-embedding-3-large":{InputPer1M:0.13,OutputPer1M:0.0},//Anthropic"anthropic/claude-3-5-sonnet-20241022":{InputPer1M:3.00,OutputPer1M:15.00},"anthropic/claude-3-5-haiku-20241022":{InputPer1M:0.80,OutputPer1M:4.00},"anthropic/claude-3-opus-20240229":{InputPer1M:15.00,OutputPer1M:75.00},"anthropic/claude-3-sonnet-20240229":{InputPer1M:3.00,OutputPer1M:15.00},"anthropic/claude-3-haiku-20240307":{InputPer1M:0.25,OutputPer1M:1.25},//Google"google/gemini-2.0-flash":{InputPer1M:0.10,OutputPer1M:0.40},"google/gemini-1.5-pro":{InputPer1M:1.25,OutputPer1M:5.00},"google/gemini-1.5-flash":{InputPer1M:0.075,OutputPer1M:0.30},"google/gemini-2.0-flash-lite":{InputPer1M:0.0,OutputPer1M:0.0,Free:true},//AzureOpenAI(samepricingasOpenAI)"azure/gpt-4o":{InputPer1M:2.50,OutputPer1M:10.00},"azure/gpt-4o-mini":{InputPer1M:0.15,OutputPer1M:0.60},"azure/gpt-4-turbo":{InputPer1M:10.00,OutputPer1M:30.00},//Mistral"mistral/mistral-large-latest":{InputPer1M:2.00,OutputPer1M:6.00},"mistral/mistral-small-latest":{InputPer1M:0.20,OutputPer1M:0.60},"mistral/codestral-latest":{InputPer1M:0.30,OutputPer1M:0.90},"mistral/mistral-embed":{InputPer1M:0.10,OutputPer1M:0.0},//Groq(hostedinference)"groq/llama-3.1-70b-versatile":{InputPer1M:0.59,OutputPer1M:0.79},"groq/llama-3.1-8b-instant":{InputPer1M:0.05,OutputPer1M:0.08},"groq/mixtral-8x7b-32768":{InputPer1M:0.24,OutputPer1M:0.24},//TogetherAI"together/meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo":{InputPer1M:0.88,OutputPer1M:0.88},"together/meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo":{InputPer1M:0.18,OutputPer1M:0.18},//Cohere"cohere/command-r-plus":{InputPer1M:2.50,OutputPer1M:10.00},"cohere/command-r":{InputPer1M:0.15,OutputPer1M:0.60},"cohere/embed-english-v3.0":{InputPer1M:0.10,OutputPer1M:0.0},},}returnpc}//LoadFromFileloadspricingoverridesfromaJSONfile.func(pc*PricingConfig)LoadFromFile(pathstring)error{data,err:=os.ReadFile(path)iferr!=nil{returnfmt.Errorf("readpricingfile:%w",err)}varoverridesmap[string]ModelPricingiferr:=json.Unmarshal(data,&overrides);err!=nil{returnfmt.Errorf("parsepricingfile:%w",err)}pc.mu.Lock()deferpc.mu.Unlock()fork,v:=rangeoverrides{pc.pricing[k]=v}returnnil}//GetPricingreturnsthepricingforamodel.Tries"provider/model"first,//thenfallsbacktojust"model"acrossallproviders.func(pc*PricingConfig)GetPricing(providerName,modelstring)(ModelPricing,bool){pc.mu.RLock()deferpc.mu.RUnlock()//Exactmatch:"openai/gpt-4o"key:=providerName+"/"+modelifp,ok:=pc.pricing[key];ok{returnp,true}//Fallback:searchallentriesformodelsuffixmatchlowerModel:=strings.ToLower(model)fork,p:=rangepc.pricing{parts:=strings.SplitN(k,"/",2)iflen(parts)==2&&strings.ToLower(parts[1])==lowerModel{returnp,true}}returnModelPricing{},false}//CalculateCostcomputesthecostforarequestgiventokencounts.func(pc*PricingConfig)CalculateCost(providerName,modelstring,inputTokens,outputTokensint)float64{pricing,found:=pc.GetPricing(providerName,model)if!found||pricing.Free{return0.0}inputCost:=(float64(inputTokens)/1_000_000.0)*pricing.InputPer1MoutputCost:=(float64(outputTokens)/1_000_000.0)*pricing.OutputPer1M//Roundto8decimalplacesforprecisiontotal:=inputCost+outputCostreturnmath.Round(total*1e8)/1e8}//EstimateCostestimatescostfrommax_tokens(pre-request).func(pc*PricingConfig)EstimateCost(providerName,modelstring,estimatedInputTokens,maxOutputTokensint)float64{returnpc.CalculateCost(providerName,model,estimatedInputTokens,maxOutputTokens)}//IsFreeModelreturnstrueifthemodelismarkedasfree.func(pc*PricingConfig)IsFreeModel(providerName,modelstring)bool{pricing,found:=pc.GetPricing(providerName,model)returnfound&&pricing.Free}//AllPricingreturnsallpricingentries(forAPIresponses).func(pc*PricingConfig)AllPricing()map[string]ModelPricing{pc.mu.RLock()deferpc.mu.RUnlock()result:=make(map[string]ModelPricing,len(pc.pricing))fork,v:=rangepc.pricing{result[k]=v}returnresult}//SetPricingupdatesoraddspricingforamodel.func(pc*PricingConfig)SetPricing(keystring,pricingModelPricing){pc.mu.Lock()deferpc.mu.Unlock()pc.pricing[key]=pricing}