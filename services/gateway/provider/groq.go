packageproviderimport("bytes""context""encoding/json""fmt""io""net/http")const(groqBaseURL="https://api.groq.com/openai/v1")//GroqProviderimplementstheProviderinterfaceforGroq.typeGroqProviderstruct{configProviderConfigclient*http.Client}//NewGroqProvidercreatesanewGroqproviderconnector.funcNewGroqProvider(cfgProviderConfig)*GroqProvider{ifcfg.BaseURL==""{cfg.BaseURL=groqBaseURL}return&GroqProvider{config:cfg,client:&http.Client{Timeout:cfg.Timeout},}}func(p*GroqProvider)Name()string{return"groq"}func(p*GroqProvider)Models()[]string{return[]string{"llama-3.3-70b-versatile","llama-3.1-8b-instant","llama-3.2-90b-vision-preview","mixtral-8x7b-32768","gemma2-9b-it","deepseek-r1-distill-llama-70b",}}func(p*GroqProvider)HealthCheck(ctxcontext.Context)HealthStatus{req,err:=http.NewRequestWithContext(ctx,http.MethodGet,p.config.BaseURL+"/models",nil)iferr!=nil{returnHealthStatus{Healthy:false,Error:err.Error()}}req.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(req)iferr!=nil{returnHealthStatus{Healthy:false,Error:err.Error()}}deferresp.Body.Close()returnHealthStatus{Healthy:resp.StatusCode==http.StatusOK,Error:fmt.Sprintf("status=%d",resp.StatusCode),}}func(p*GroqProvider)ChatCompletion(ctxcontext.Context,req*ChatRequest)(*ChatResponse,error){body,err:=json.Marshal(req)iferr!=nil{returnnil,fmt.Errorf("groq:marshal:%w",err)}httpReq,err:=http.NewRequestWithContext(ctx,http.MethodPost,p.config.BaseURL+"/chat/completions",bytes.NewReader(body))iferr!=nil{returnnil,fmt.Errorf("groq:createrequest:%w",err)}httpReq.Header.Set("Content-Type","application/json")httpReq.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(httpReq)iferr!=nil{returnnil,fmt.Errorf("groq:requestfailed:%w",err)}deferresp.Body.Close()ifresp.StatusCode!=http.StatusOK{respBody,_:=io.ReadAll(resp.Body)returnnil,fmt.Errorf("groq:APIerror%d:%s",resp.StatusCode,string(respBody))}varresultChatResponseiferr:=json.NewDecoder(resp.Body).Decode(&result);err!=nil{returnnil,fmt.Errorf("groq:decode:%w",err)}return&result,nil}func(p*GroqProvider)ChatCompletionStream(ctxcontext.Context,req*ChatRequest)(Stream,error){req.Stream=truebody,err:=json.Marshal(req)iferr!=nil{returnnil,fmt.Errorf("groq:marshalstream:%w",err)}httpReq,err:=http.NewRequestWithContext(ctx,http.MethodPost,p.config.BaseURL+"/chat/completions",bytes.NewReader(body))iferr!=nil{returnnil,fmt.Errorf("groq:createstreamrequest:%w",err)}httpReq.Header.Set("Content-Type","application/json")httpReq.Header.Set("Authorization","Bearer"+p.config.APIKey)resp,err:=p.client.Do(httpReq)iferr!=nil{returnnil,fmt.Errorf("groq:streamfailed:%w",err)}ifresp.StatusCode!=http.StatusOK{respBody,_:=io.ReadAll(resp.Body)resp.Body.Close()returnnil,fmt.Errorf("groq:streamerror%d:%s",resp.StatusCode,string(respBody))}returnNewHTTPStream(resp),nil}func(p*GroqProvider)Embeddings(ctxcontext.Context,req*EmbeddingsRequest)(*EmbeddingsResponse,error){//Groqdoesnotcurrentlyofferembeddings,butweimplementtheinterface.returnnil,fmt.Errorf("groq:embeddingsnotsupported")}