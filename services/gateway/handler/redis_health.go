packagehandlerimport("encoding/json""net/http""github.com/AlfredDev/alfred/services/gateway/redisclient")//RedisHealthHandlerreturnsanhttp.HandlerFuncthatreportsRedis//connectionhealthincludingcircuitbreakerstate.funcRedisHealthHandler(rc*redisclient.Client)http.HandlerFunc{returnfunc(whttp.ResponseWriter,r*http.Request){health:=rc.Health()w.Header().Set("Content-Type","application/json")if!health.Connected||health.DegradedMode{w.WriteHeader(http.StatusServiceUnavailable)}else{w.WriteHeader(http.StatusOK)}buf:=getBuf()deferputBuf(buf)iferr:=json.NewEncoder(buf).Encode(health);err!=nil{w.WriteHeader(http.StatusInternalServerError)_,_=w.Write([]byte(`{"error":"failedtoencodehealth"}`))return}_,_=w.Write(buf.Bytes())}}