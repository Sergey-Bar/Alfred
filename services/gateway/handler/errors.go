packagehandler//ErrorCoderepresentsastandardizedgatewayerrorcode.typeErrorCodestringconst(//AutherrorsErrCodeMissingAPIKeyErrorCode="missing_api_key"ErrCodeInvalidAPIKeyErrorCode="invalid_api_key"ErrCodeExpiredAPIKeyErrorCode="expired_api_key"ErrCodeInsufficientRoleErrorCode="insufficient_role"//RequesterrorsErrCodeInvalidJSONErrorCode="invalid_json"ErrCodeMissingModelErrorCode="missing_model"ErrCodeMissingMessagesErrorCode="missing_messages"ErrCodeInvalidToolsErrorCode="invalid_tools"ErrCodeBodyTooLargeErrorCode="body_too_large"ErrCodeInvalidRequestErrorCode="invalid_request"//ProvidererrorsErrCodeProviderNotFoundErrorCode="provider_not_found"ErrCodeProviderErrorErrorCode="provider_error"ErrCodeProviderTimeoutErrorCode="provider_timeout"ErrCodeProviderOverloadErrorCode="provider_overloaded"ErrCodeModelNotFoundErrorCode="model_not_found"ErrCodeStreamingErrorErrorCode="streaming_error"//RatelimitingErrCodeRateLimitedErrorCode="rate_limited"//Quota/walleterrorsErrCodeQuotaExceededErrorCode="quota_exceeded"ErrCodeWalletExhaustedErrorCode="wallet_exhausted"ErrCodeInsufficientCreditErrorCode="insufficient_credit"//PolicyerrorsErrCodePolicyBlockedErrorCode="policy_blocked"ErrCodeGeoRestrictedErrorCode="geo_restricted"ErrCodeEvaluationFailedErrorCode="evaluation_failed"//CRUD/lifecycleerrorsErrCodeCreateFailedErrorCode="create_failed"ErrCodeUpdateFailedErrorCode="update_failed"ErrCodeNotFoundErrorCode="not_found"ErrCodeStartFailedErrorCode="start_failed"ErrCodePauseFailedErrorCode="pause_failed"ErrCodeConcludeFailedErrorCode="conclude_failed"ErrCodeAssignFailedErrorCode="assign_failed"ErrCodeRecordFailedErrorCode="record_failed"ErrCodeInsufficientVariantsErrorCode="insufficient_variants"ErrCodeStreamingUnsupportedErrorCode="streaming_unsupported"//InternalerrorsErrCodeInternalErrorCode="internal_error")//errorCatalogmapserrorcodestoactionablehints.varerrorCatalog=map[ErrorCode]string{ErrCodeMissingAPIKey:"IncludeyourAPIkeyintheAuthorizationheader:'Authorization:Bearersk-...'orintheX-API-Keyheader.",ErrCodeInvalidAPIKey:"TheAPIkeyprovidedisnotvalid.GenerateanewkeyatyourAlfreddashboardorcheckfortypos.",ErrCodeExpiredAPIKey:"ThisAPIkeyhasexpired.GenerateanewkeyfromyourAlfreddashboard.",ErrCodeInsufficientRole:"YourAPIkeydoesnothavepermissionforthisoperation.Contactyourteamadmintoupgradeyourrole.",ErrCodeInvalidJSON:"TherequestbodyisnotvalidJSON.Checkformissingcommas,unquotedkeys,ortrailingcommas.",ErrCodeMissingModel:"The'model'fieldisrequired.Example:{\"model\":\"gpt-4o\",\"messages\":[...]}",ErrCodeMissingMessages:"The'messages'fieldisrequiredandmustbeanon-emptyarray.Example:{\"messages\":[{\"role\":\"user\",\"content\":\"Hello\"}]}",ErrCodeInvalidTools:"Tooldefinitionsaremalformed.Eachtoolmusthave'type':'function'anda'function'objectwith'name'and'parameters'.",ErrCodeBodyTooLarge:"Requestbodyexceedsthemaximumallowedsize.Reducemessagelengthorsplitintomultiplerequests.",ErrCodeInvalidRequest:"Therequestformatisinvalid.RefertotheOpenAI-compatibleAPIformat:POST/v1/chat/completionswithmodel+messages.",ErrCodeProviderNotFound:"Noproviderisconfiguredforthismodel.CheckavailablemodelsatGET/v1/models.Didyoumisspellthemodelname?",ErrCodeProviderError:"TheupstreamLLMproviderreturnedanerror.Thisisusuallytransient—retryafterafewseconds.Ifpersistent,checkproviderstatus.",ErrCodeProviderTimeout:"Theupstreamproviderdidnotrespondintime.Try:(1)reducemax_tokens,(2)useafastermodel,(3)setX-Alfred-Timeoutheaderforalongertimeout.",ErrCodeProviderOverload:"Theupstreamproviderisoverloaded.Alfredwillautomaticallyretrywithafallbackproviderifconfigured.Waitandretry.",ErrCodeModelNotFound:"Thismodelisnotavailable.Commonmodels:gpt-4o,claude-3-opus-20240229,gemini-pro.CheckGET/v1/modelsforthefulllist.",ErrCodeStreamingError:"Streamingfailedmid-response.Thepartialresponsemayhavebeensent.Retrytherequestwithstream:falsetogetacompleteresponse.",ErrCodeRateLimited:"You'veexceededyourratelimit.CurrentlimitshowninX-RateLimit-Limitheader.WaitfortheresettimeinX-RateLimit-Resetheader.",ErrCodeQuotaExceeded:"Yourusagequotahasbeenexceeded.Contactyouradmintoincreaseyourquotaorwaitforthenextbillingperiod.",ErrCodeWalletExhausted:"Yourwalletbalanceiszero.Topupyourwalletorcontactyourteamadminforadditionalcredits.",ErrCodeInsufficientCredit:"Insufficientcreditsforthisrequest.Estimatedcostexceedsremainingbalance.Useacheapermodelorrequestabudgetincrease.",ErrCodePolicyBlocked:"Thisrequestwasblockedbyanorganizationalpolicy.Checkwithyouradminforallowedmodels,timewindows,andusagepolicies.",ErrCodeGeoRestricted:"Thisrequestcannotberoutedduetodataresidencyrestrictions.Yourregionrequiresspecificproviders—contactyouradmin.",ErrCodeEvaluationFailed:"Policyevaluationfailed.TheOPApolicybundlemaybemisconfigured.Checkpolicysyntaxandcontactyouradmin.",ErrCodeCreateFailed:"Resourcecreationfailed.Verifytherequestbodymatchestheexpectedschemaandallrequiredfieldsarepresent.",ErrCodeUpdateFailed:"Resourceupdatefailed.Theresourcemayhavebeenmodifiedconcurrently—refetchandretry.",ErrCodeNotFound:"Therequestedresourcewasnotfound.VerifytheIDornameiscorrect.",ErrCodeStartFailed:"Failedtostarttheresource.Itmayalreadyberunningorinanincompatiblestate.",ErrCodePauseFailed:"Failedtopausetheresource.Itmaynotbeinarunningstate.",ErrCodeConcludeFailed:"Failedtoconcludetheresource.Itmaynotbeinarunningorpausedstate.",ErrCodeAssignFailed:"Variantassignmentfailed.VerifythevariantIDexistsandispartoftheexperiment.",ErrCodeRecordFailed:"Failedtorecordtheobservation.Ensuretheexperimentisactiveandthemetricformatisvalid.",ErrCodeInsufficientVariants:"Atleast2variantsarerequiredforthisoperation.Addmorevariantsbeforeproceeding.",ErrCodeStreamingUnsupported:"Theserverdoesnotsupportstreamingforthisendpoint.Useanon-streamingrequestinstead.",ErrCodeInternal:"Anunexpectederroroccurred.Thishasbeenloggedforinvestigation.Ifpersistent,contactsupportwiththeX-Request-IDheadervalue.",}//APIErrorrepresentsastructured,actionableAPIerrorresponse.typeAPIErrorstruct{Statusint`json:"-"`TypeErrorCode`json:"type"`Messagestring`json:"message"`Hintstring`json:"hint,omitempty"`Codestring`json:"code,omitempty"`}//NewAPIErrorcreatesanAPIErrorwiththehintauto-populatedfromthecatalog.funcNewAPIError(statusint,codeErrorCode,messagestring)*APIError{return&APIError{Status:status,Type:code,Message:message,Hint:errorCatalog[code],Code:string(code),}}//Commonpre-builterrorsforthehotpath(avoidallocations).var(ErrMissingAPIKey=NewAPIError(401,ErrCodeMissingAPIKey,"APIkeyisrequired")ErrMissingModel=NewAPIError(400,ErrCodeMissingModel,"Modelfieldisrequired")ErrMissingMsgs=NewAPIError(400,ErrCodeMissingMessages,"Messagesfieldisrequiredandmustnotbeempty"))