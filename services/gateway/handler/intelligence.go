//go:buildintelligence//+buildintelligencepackagehandlerimport("encoding/json""net/http""github.com/rs/zerolog""github.com/AlfredDev/alfred/services/gateway/intelligence")//IntelligenceHandlerprovidesHTTPhandlersforintelligencefeatures.typeIntelligenceHandlerstruct{classifier*intelligence.Classifierforecaster*intelligence.ForecasteranomalyDetector*intelligence.AnomalyDetectorfeatureTracker*intelligence.FeatureTrackerarbitrageEngine*intelligence.ArbitrageEnginetrafficRecorder*intelligence.TrafficRecorderloggerzerolog.Logger}//NewIntelligenceHandlercreatesanewintelligencehandler.funcNewIntelligenceHandler(classifier*intelligence.Classifier,forecaster*intelligence.Forecaster,anomalyDetector*intelligence.AnomalyDetector,featureTracker*intelligence.FeatureTracker,arbitrageEngine*intelligence.ArbitrageEngine,trafficRecorder*intelligence.TrafficRecorder,loggerzerolog.Logger,)*IntelligenceHandler{return&IntelligenceHandler{classifier:classifier,forecaster:forecaster,anomalyDetector:anomalyDetector,featureTracker:featureTracker,arbitrageEngine:arbitrageEngine,trafficRecorder:trafficRecorder,logger:logger,}}//ClassifyhandlesPOST/v1/intelligence/classify.func(h*IntelligenceHandler)Classify(whttp.ResponseWriter,r*http.Request){varbodystruct{Promptstring`json:"prompt"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}category:=h.classifier.Classify(body.Prompt)scores:=h.classifier.ClassifyWithScores(body.Prompt)writeJSON(w,http.StatusOK,map[string]interface{}{"category":category,"scores":scores,})}//ForecasthandlesPOST/v1/intelligence/forecast.func(h*IntelligenceHandler)Forecast(whttp.ResponseWriter,r*http.Request){varbodystruct{BudgetLimitfloat64`json:"budget_limit"`History[]intelligence.SpendDataPoint`json:"history"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}result:=h.forecaster.Forecast(body.History,body.BudgetLimit)writeJSON(w,http.StatusOK,result)}//DetectAnomalyhandlesPOST/v1/intelligence/anomaly.func(h*IntelligenceHandler)DetectAnomaly(whttp.ResponseWriter,r*http.Request){varbodystruct{Values[]float64`json:"values"`Latestfloat64`json:"latest"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}result:=h.anomalyDetector.Check(body.Values,body.Latest)writeJSON(w,http.StatusOK,result)}//RecordFeatureCosthandlesPOST/v1/intelligence/features/cost.func(h*IntelligenceHandler)RecordFeatureCost(whttp.ResponseWriter,r*http.Request){varbodystruct{FeatureIDstring`json:"feature_id"`Costfloat64`json:"cost"`Tokensint64`json:"tokens"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}h.featureTracker.Record(body.FeatureID,body.Cost,body.Tokens)writeJSON(w,http.StatusOK,map[string]string{"status":"recorded"})}//GetFeatureCostshandlesGET/v1/intelligence/features.func(h*IntelligenceHandler)GetFeatureCosts(whttp.ResponseWriter,r*http.Request){features:=h.featureTracker.GetAll()writeJSON(w,http.StatusOK,features)}//CalculateROIhandlesPOST/v1/intelligence/roi.func(h*IntelligenceHandler)CalculateROI(whttp.ResponseWriter,r*http.Request){varinputintelligence.ROIInputiferr:=json.NewDecoder(r.Body).Decode(&input);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}result:=intelligence.CalculateROI(input)writeJSON(w,http.StatusOK,result)}//CalculateEfficiencyhandlesPOST/v1/intelligence/efficiency.func(h*IntelligenceHandler)CalculateEfficiency(whttp.ResponseWriter,r*http.Request){varinputintelligence.EfficiencyInputiferr:=json.NewDecoder(r.Body).Decode(&input);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}result:=intelligence.CalculateEfficiency(input)writeJSON(w,http.StatusOK,result)}//FindArbitragehandlesGET/v1/intelligence/arbitrage.func(h*IntelligenceHandler)FindArbitrage(whttp.ResponseWriter,r*http.Request){opportunities:=h.arbitrageEngine.FindOpportunities()writeJSON(w,http.StatusOK,opportunities)}//UpdateArbitragePriceshandlesPOST/v1/intelligence/arbitrage/prices.func(h*IntelligenceHandler)UpdateArbitragePrices(whttp.ResponseWriter,r*http.Request){varbodystruct{Modelstring`json:"model"`Providerstring`json:"provider"`InputPer1Kfloat64`json:"input_per_1k"`OutputPer1Kfloat64`json:"output_per_1k"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}h.arbitrageEngine.UpdatePrices(body.Model,body.Provider,body.InputPer1K,body.OutputPer1K)writeJSON(w,http.StatusOK,map[string]string{"status":"updated"})}//RecordTraffichandlesPOST/v1/intelligence/traffic/record.func(h*IntelligenceHandler)RecordTraffic(whttp.ResponseWriter,r*http.Request){varreqintelligence.RecordedRequestiferr:=json.NewDecoder(r.Body).Decode(&req);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}h.trafficRecorder.Record(req)writeJSON(w,http.StatusOK,map[string]string{"status":"recorded"})}//SimulateTraffichandlesPOST/v1/intelligence/traffic/simulate.func(h*IntelligenceHandler)SimulateTraffic(whttp.ResponseWriter,r*http.Request){varbodystruct{AlternativeModelstring`json:"alternative_model"`}iferr:=json.NewDecoder(r.Body).Decode(&body);err!=nil{writeError(w,http.StatusBadRequest,"invalid_json",err.Error())return}result:=h.trafficRecorder.Simulate(body.AlternativeModel,h.arbitrageEngine)writeJSON(w,http.StatusOK,result)}