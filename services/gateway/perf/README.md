#GatewayPerformanceTesting&Profiling**SprintT204-T213:**PerformanceEngineeringforSub-100msP95LatencyThisdirectorycontainsperformancetesting,profiling,andoptimizationtoolsfortheAlfredAIGateway.##üéØPerformanceTargets|Metric|Target|Current|Status||----------------|---------------|-------|----------||**P50Latency**|<50ms|TBD|üîÑTesting||**P95Latency**|<100ms|TBD|üîÑTesting||**P99Latency**|<200ms|TBD|üîÑTesting||**Throughput**|10Kreq/min|TBD|üîÑTesting||**ErrorRate**|<0.1%|TBD|üîÑTesting||**MemoryUsage**|<512MB/instance|TBD|üîÑTesting|##üìãQuickStart###1.RunLoadTest```bash#Installk6(ifnotalreadyinstalled)#macOS:brewinstallk6#Windows:chocoinstallk6#Linux:snapinstallk6#SetenvironmentvariablesexportGATEWAY_URL=http://localhost:8080exportTEST_API_KEY=your-test-api-key#Runloadtestk6runload-test.js#RunwithcustomVUcountk6run--vus100--duration5mload-test.js#RunwithHTMLreportk6run--outhtml=report.htmlload-test.js```###2.EnableProfiling```bash#StartgatewaywithprofilingenabledexportALFRED_PROFILING_ENABLED=trueexportALFRED_PROFILING_TOKEN=your-secret-tokengorunmain.go#Accesspprofendpoints(requiresauthtoken)curl-H"Authorization:Beareryour-secret-token"\http://localhost:6060/debug/pprof/#CaptureCPUprofile(30seconds)curl-H"Authorization:Beareryour-secret-token"\"http://localhost:6060/debug/pprof/profile?seconds=30"\-ocpu.prof#Captureheapprofilecurl-H"Authorization:Beareryour-secret-token"\http://localhost:6060/debug/pprof/heap\-oheap.prof#Analyzewithpprofgotoolpprof-http=:8081cpu.profgotoolpprof-http=:8081heap.prof```###3.RunPerformanceAnalysis```bash#Runcomprehensiveperformanceanalysis./analyze-performance.sh#Orrunindividualsteps./profile-baseline.sh#Establishbaseline./profile-under-load.sh#Profileunderload./compare-profiles.sh#Comparebefore/after```##üî¨ProfilingTools###CPUProfiling```bash#ManualCPUprofilecapturegotest-cpuprofile=cpu.prof-bench=.gotoolpprofcpu.prof#Commandsinpprof:#top10-Showtop10functionsbyCPUtime#list<function>-Showsourcecodewithannotations#web-Generatecallgraph(requiresgraphviz)#pdf-GeneratePDFreport```###MemoryProfiling```bash#Heapallocationprofilegotest-memprofile=mem.prof-bench=.gotoolpprofmem.prof#Allocationsitesgotoolpprof-alloc_spacemem.prof#In-usememorygotoolpprof-inuse_spacemem.prof```###GoroutineProfiling```bash#Goroutinecountandstacktracescurl-H"Authorization:Bearer$TOKEN"\http://localhost:6060/debug/pprof/goroutine\-ogoroutine.profgotoolpprofgoroutine.prof```###ExecutionTracing```bash#Captureexecutiontracecurl-H"Authorization:Bearer$TOKEN"\"http://localhost:6060/debug/pprof/trace?seconds=5"\-otrace.out#Analyzetracegotooltracetrace.out```##üìäPerformanceAnalysisWorkflow###Step1:EstablishBaseline```bash#1.Startgatewayincleanstategorunmain.go#2.Runbaselineloadtestk6run--vus10--duration2mload-test.js>baseline.txt#3.Recordmetrics#-P50,P95,P99latency#-Memoryusage#-CPUusage#-Errorrate```###Step2:IdentifyBottlenecks```bash#1.EnableprofilingexportALFRED_PROFILING_ENABLED=true#2.Runloadtestwhilecapturingprofilesk6run--vus100--duration5mload-test.js&sleep30#Letloadstabilize#3.CaptureCPUprofilecurl-H"Authorization:Bearer$TOKEN"\"http://localhost:6060/debug/pprof/profile?seconds=60"\-ocpu-under-load.prof#4.Captureheapprofilecurl-H"Authorization:Bearer$TOKEN"\http://localhost:6060/debug/pprof/heap\-oheap-under-load.prof#5.Analyzeprofilesgotoolpprof-http=:8081cpu-under-load.prof```###Step3:OptimizeCommonoptimizationtargets:1.**CPUHotspots**-JSONserialization/deserialization-Requestroutinglogic-Middlewareoverhead-Databasequeries2.**MemoryAllocations**-Stringoperations-Bufferpooling-Objectreuse-GCpressure3.**I/OWait**-Databaseconnectionpooling-Redisconnectionpooling-HTTPclientpooling-Requesttimeouts4.**Concurrency**-Goroutineleaks-Lockcontention-Channelblocking-Contextcancellation###Step4:ValidateImprovements```bash#1.Applyoptimizationgitcommit-m"perf:optimize<bottleneck>"#2.Runloadtestagaink6run--vus100--duration5mload-test.js>optimized.txt#3.Compareresults./compare-results.shbaseline.txtoptimized.txt#4.Capturenewprofiles#5.Compareprofilesusingpprof-basegotoolpprof-base=cpu-baseline.profcpu-optimized.prof```##üé®FlameGraphs```bash#GenerateflamegraphfromCPUprofilegotoolpprof-http=:8081cpu.prof#Navigateto"FlameGraph"viewinbrowser#Orusepprof-flamegraph:gogetgithub.com/google/pprofpprof-http=:8081cpu.prof```##üö®PerformanceRegressionDetectionAddtoCIpipeline:```yaml#.github/workflows/performance.ymlname:PerformanceTeston:[pull_request]jobs:load-test:runs-on:ubuntu-lateststeps:-uses:actions/checkout@v3-uses:grafana/k6-action@v0.3.1with:filename:services/gateway/perf/load-test.js-name:CheckP95latencyrun:|p95=$(jq'.metrics.http_req_duration.values["p(95)"]'summary.json)if["$p95"-gt120];thenecho"‚ùåP95latency$p95msexceeds120msthreshold"exit1fi```##üìàContinuousProfilingForproductionmonitoring:```bash#UseContinuousProfilingservices:#-Pyroscope(open-source)#-Parca(CNCFproject)#-GoogleCloudProfiler#-DatadogContinuousProfiler#Example:Pyroscopeintegrationgogetgithub.com/pyroscope-io/client/pyroscope```##üîçDebuggingSlowRequests```bash#EnablerequesttracingexportALFRED_TRACE_SLOW_REQUESTS=trueexportALFRED_SLOW_REQUEST_THRESHOLD_MS=100#Checklogsforslowrequeststail-fgateway.log|grep"SLOW_REQUEST"#ExtracttraceIDandanalyzecurl-H"X-Trace-ID:<trace-id>"\http://localhost:8080/debug/trace/<trace-id>```##üìöResources-[GopprofDocumentation](https://pkg.go.dev/runtime/pprof)-[k6Documentation](https://k6.io/docs/)-[OptimizingGoPrograms](https://go.dev/doc/diagnostics)-[DaveCheney'sHighPerformanceGoWorkshop](https://dave.cheney.net/high-performance-go-workshop/gopherchina-2019.html)##üéØSprintT204-T213Tasks-[x]T204:Gatewaylatencyprofiling+bottleneckidentification-[]T205:Connectionpooltuning-[]T206:Requestpipelineoptimization-[]T207:gRPCstreamingoptimization-[]T208:Memoryallocationoptimization-[]T209:Loadtestingsuite(10Kreq/min)-[]T210:Horizontalscalingvalidation-[]T211:Cachewarmingstrategy-[]T212:CDNintegration-[]T213:PerformanceregressiondetectioninCI---**Sprint:**ExcellenceEdition(Feb19-Mar4,2026)**Goal:**Sub-100msP95latency@10Kreq/min**Owner:**BackendLead