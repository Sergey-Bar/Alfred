#!/bin/bash##SprintT204:GatewayPerformanceBaselineAnalysis##Thisscriptestablishesaperformancebaselinebeforeoptimization.#RunthisFIRST,thenuseresultstoidentifybottlenecks.#set-eSCRIPT_DIR="$(cd"$(dirname"${BASH_SOURCE[0]}")"&&pwd)"GATEWAY_DIR="$(cd"$SCRIPT_DIR/.."&&pwd)"RESULTS_DIR="$SCRIPT_DIR/results"TIMESTAMP=$(date+%Y%m%d_%H%M%S)#ColorsforoutputRED='\033[0;31m'GREEN='\033[0;32m'YELLOW='\033[1;33m'BLUE='\033[0;34m'NC='\033[0m'#NoColorecho-e"${BLUE}ðŸš€AlfredGatewayPerformanceBaselineAnalysis${NC}"echo"=================================================="echo""#Createresultsdirectorymkdir-p"$RESULTS_DIR"#Checkprerequisitesecho-e"${YELLOW}ðŸ“‹Checkingprerequisites...${NC}"if!command-vk6&>/dev/null;thenecho-e"${RED}âŒk6notfound.Installwith:${NC}"echo"macOS:brewinstallk6"echo"Windows:chocoinstallk6"echo"Linux:snapinstallk6"exit1fiif!command-vgo&>/dev/null;thenecho-e"${RED}âŒGonotfound${NC}"exit1fiecho-e"${GREEN}âœ…PrerequisitesOK${NC}"echo""#Checkifgatewayisrunningecho-e"${YELLOW}ðŸ”Checkingifgatewayisrunning...${NC}"GATEWAY_URL="${GATEWAY_URL:-http://localhost:8080}"if!curl-s-f"$GATEWAY_URL/health">/dev/null2>&1;thenecho-e"${RED}âŒGatewaynotrespondingat$GATEWAY_URL${NC}"echo"Startthegatewaywith:cd$GATEWAY_DIR&&gorunmain.go"exit1fiecho-e"${GREEN}âœ…Gatewayisrunning${NC}"echo""#Runbaselineloadtestecho-e"${YELLOW}ðŸ“ŠRunningbaselineloadtest(lightload:50VUsfor2min)...${NC}"k6run\--vus50\--duration2m\--outjson="$RESULTS_DIR/baseline_${TIMESTAMP}.json"\"$SCRIPT_DIR/load-test.js"\>"$RESULTS_DIR/baseline_${TIMESTAMP}.log"2>&1echo-e"${GREEN}âœ…Baselineloadtestcomplete${NC}"echo""#Extractkeymetricsfromresultsecho-e"${YELLOW}ðŸ“ˆExtractingmetrics...${NC}"#ParseJSONoutputforkeymetrics(requiresjq)ifcommand-vjq&>/dev/null;thenMETRICS_FILE="$RESULTS_DIR/baseline_${TIMESTAMP}.json"#Extractlatencypercentilesfromlastline(summary)SUMMARY=$(tail-1"$METRICS_FILE")P50=$(echo"$SUMMARY"|jq-r'.metrics.http_req_duration.values["p(50)"]'2>/dev/null||echo"N/A")P95=$(echo"$SUMMARY"|jq-r'.metrics.http_req_duration.values["p(95)"]'2>/dev/null||echo"N/A")P99=$(echo"$SUMMARY"|jq-r'.metrics.http_req_duration.values["p(99)"]'2>/dev/null||echo"N/A")ERROR_RATE=$(echo"$SUMMARY"|jq-r'.metrics.errors.values.rate'2>/dev/null||echo"N/A")#CreatesummaryreportREPORT_FILE="$RESULTS_DIR/baseline_summary_${TIMESTAMP}.txt"cat>"$REPORT_FILE"<<EOFAlfredGatewayPerformanceBaselineReport==========================================Date:$(date)TestDuration:2minutesVirtualUsers:50GatewayURL:$GATEWAY_URLLatencyMetrics:---------------P50:${P50}msP95:${P95}ms${P95<100&&echo"âœ…"||echo"âŒ(target:<100ms)"}P99:${P99}ms${P99<200&&echo"âœ…"||echo"âŒ(target:<200ms)"}Reliability:-----------ErrorRate:${ERROR_RATE}${ERROR_RATE<0.01&&echo"âœ…"||echo"âŒ(target:<1%)"}Status:-------EOFif(($(echo"$P95<100"|bc-l2>/dev/null||echo0)));thenecho"âœ…PASSING-P95latencymeetstarget(<100ms)">>"$REPORT_FILE"elseecho"âŒNEEDSOPTIMIZATION-P95latencyexceeds100mstarget">>"$REPORT_FILE"echo"">>"$REPORT_FILE"echo"NextSteps:">>"$REPORT_FILE"echo"1.Enableprofiling:exportALFRED_PROFILING_ENABLED=true">>"$REPORT_FILE"echo"2.Run./profile-under-load.shtocaptureCPU/memoryprofiles">>"$REPORT_FILE"echo"3.Analyzeprofileswith:gotoolpprof-http=:8081<profile-file>">>"$REPORT_FILE"echo"4.Focusontop10functionsconsumingCPUtime">>"$REPORT_FILE"ficat"$REPORT_FILE"echo""echo-e"${GREEN}âœ…Summaryreportsavedto:$REPORT_FILE${NC}"elseecho-e"${YELLOW}âš ï¸jqnotinstalled-installfordetailedmetricsparsing${NC}"echo"macOS:brewinstalljq"echo"Linux:apt-getinstalljq"fiecho""echo-e"${BLUE}ðŸ“Resultssavedto:${NC}"echo"$RESULTS_DIR/baseline_${TIMESTAMP}.json"echo"$RESULTS_DIR/baseline_${TIMESTAMP}.log"echo""#Checkifprofilingisenabledif!curl-s-fhttp://localhost:6060/health>/dev/null2>&1;thenecho-e"${YELLOW}ðŸ’¡Tip:Enableprofilingfordetailedanalysis:${NC}"echo"exportALFRED_PROFILING_ENABLED=true"echo"exportALFRED_PROFILING_TOKEN=your-secret-token"echo"gorunmain.go"echo""echo"Thenrun:./profile-under-load.sh"elseecho-e"${GREEN}âœ…Profilingserverisrunningon:6060${NC}"echo-e"${YELLOW}ðŸ’¡Nextstep:Run./profile-under-load.sh${NC}"fiecho""echo-e"${BLUE}===================================================${NC}"echo-e"${GREEN}âœ…Baselineanalysiscomplete!${NC}"echo-e"${BLUE}===================================================${NC}"