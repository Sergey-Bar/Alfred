import{b as D,a as x,j as e}from"./index-C1A5pA5l.js";import{r as t}from"./vendor-CoKE50sv.js";import{r as E,p as P,m as k,l as q,x as Q,X as U}from"./icons-iorli5jj.js";function $(){const{showToast:r}=D(),[o,j]=t.useState([]),[_,b]=t.useState(!0),[p,y]=t.useState(null),[i,R]=t.useState("pending"),[A,m]=t.useState(!1),[a,h]=t.useState({amount:"",reason:""}),[f,N]=t.useState(!1),[v,u]=t.useState(null);t.useEffect(()=>{c()},[]);async function c(){try{b(!0);const s=await x.getPendingApprovals(),d=(Array.isArray(s)?s:s.approvals||[]).map(n=>({...n,user_name:n.user_name||"Unknown User",user_email:n.user_email||"",requested_amount:n.requested_credits||n.requested_amount,approved_amount:n.approved_credits||n.approved_amount}));j(d)}catch(s){y(s?.message||"Failed to load approvals"),j([])}finally{b(!1)}}async function C(s){if(s.preventDefault(),!a.amount||!a.reason){r("Please enter amount and reason","error");return}try{N(!0),await x.createApprovalRequest(parseInt(a.amount),a.reason),r("Quota request submitted successfully","success"),m(!1),h({amount:"",reason:""}),c()}catch(l){r(l.message||"Failed to submit request","error")}finally{N(!1)}}async function S(s,l=null){try{u(s),await x.approveRequest(s,l),r("Request approved","success"),c()}catch(d){r(d.message||"Failed to approve request","error")}finally{u(null)}}async function L(s){const l=prompt("Reason for rejection (optional):");try{u(s),await x.rejectRequest(s,l||""),r("Request rejected","success"),c()}catch(d){r(d.message||"Failed to reject request","error")}finally{u(null)}}function F(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}const w=o.filter(s=>i==="all"?!0:s.status===i),g={pending:o.filter(s=>s.status==="pending").length,approved:o.filter(s=>s.status==="approved").length,rejected:o.filter(s=>s.status==="rejected").length};return _?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Quota Approvals"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage quota increase requests"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-primary flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Request Quota"]})]}),p&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-900/30 text-yellow-400 rounded-lg text-sm flex items-center justify-between",children:[e.jsxs("div",{children:["API error: ",p,". Demo data not used."]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>{y(null),c()},className:"btn btn-primary",children:"Retry"}),e.jsx("a",{href:"mailto:support@example.com",className:"btn btn-secondary",children:"Contact Support"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-8 w-8 text-yellow-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:g.pending}),e.jsx("p",{className:"stat-label",children:"Pending"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-8 w-8 text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:g.approved}),e.jsx("p",{className:"stat-label",children:"Approved"})]})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-8 w-8 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"stat-value",children:g.rejected}),e.jsx("p",{className:"stat-label",children:"Rejected"})]})]})})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"flex space-x-2",children:["pending","approved","rejected","all"].map(s=>e.jsx("button",{onClick:()=>R(s),className:`px-4 py-2 text-sm rounded-lg ${i===s?"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-400 font-medium":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"space-y-4",children:[w.map(s=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mr-3",children:s.user_name}),e.jsx("span",{className:`badge ${s.status==="pending"?"badge-yellow":s.status==="approved"?"badge-green":"badge-red"}`,children:s.status})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:s.user_email}),e.jsxs("div",{className:"flex items-center text-sm mb-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:s.reason})]}),e.jsx("p",{className:"text-xs text-gray-400",children:F(s.created_at)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:[(s.requested_credits||s.requested_amount)?.toLocaleString()," tokens"]}),s.status==="approved"&&(s.approved_credits||s.approved_amount)&&e.jsxs("p",{className:"text-sm text-green-500",children:["Approved: ",(s.approved_credits||s.approved_amount).toLocaleString()]}),s.status==="rejected"&&s.rejection_reason&&e.jsx("p",{className:"text-sm text-red-400",children:s.rejection_reason}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsxs("button",{onClick:()=>S(s.id,s.requested_credits||s.requested_amount),disabled:v===s.id,className:"btn btn-sm bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs("button",{onClick:()=>L(s.id),disabled:v===s.id,className:"btn btn-sm bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})]})},s.id)),w.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:["No ",i==="all"?"":i," requests found"]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Request Additional Quota"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(U,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Amount Requested (tokens)"}),e.jsx("input",{type:"number",min:"1",value:a.amount,onChange:s=>h({...a,amount:s.target.value}),className:"input w-full",placeholder:"e.g., 5000",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason / Justification"}),e.jsx("textarea",{value:a.reason,onChange:s=>h({...a,reason:s.target.value}),className:"input w-full",rows:4,placeholder:"Explain why you need additional tokens...",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:f,children:f?"Submitting...":"Submit Request"})]})]})]})})]})}export{$ as default};
