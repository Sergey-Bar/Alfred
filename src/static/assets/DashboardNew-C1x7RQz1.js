import{j as e,u as q,a as v}from"./index-C1A5pA5l.js";import{r as i,u as I}from"./vendor-CoKE50sv.js";import{n as Q,h as V,U as k,o as H,D as J,T as Z,p as ee,m as te,l as se,q as ae}from"./icons-iorli5jj.js";import{R as D,A as E,C as _,X as B,Y as O,T as $,a as Y,P as re,b as le,c as oe}from"./charts-Cp-wO6iQ.js";const ne=[{label:"Last 7 days",value:"7d",days:7},{label:"Last 30 days",value:"30d",days:30},{label:"This month",value:"month",days:0},{label:"This year",value:"year",days:0},{label:"Last year",value:"lastyear",days:0}];function f(a){const t=a.getDate().toString().padStart(2,"0"),l=(a.getMonth()+1).toString().padStart(2,"0"),c=a.getFullYear().toString().slice(-2);return`${t}.${l}.${c}`}function L(a){const t=new Date;return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()}function ie({value:a,onChange:t,className:l=""}){const[c,n]=i.useState(!1),[m,p]=i.useState(a||"year"),[h,j]=i.useState(new Date().getFullYear()),b=i.useRef(null),u=new Date().getFullYear(),C=Array.from({length:5},(s,x)=>u-x);i.useEffect(()=>{function s(x){b.current&&!b.current.contains(x.target)&&n(!1)}return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const F=s=>{p(s.value),t&&t({range:s.value,days:s.days,year:s.value==="lastyear"?u-1:u}),n(!1)},w=s=>{j(s),p("custom"),t&&t({range:"custom",year:s}),n(!1)},N=()=>{const s=new Date,x=L(s)?"Today":f(s);if(m==="7d"){const g=new Date(s.getTime()-6048e5);return`${f(g)}-${x}`}if(m==="30d"){const g=new Date(s.getTime()-2592e6);return`${f(g)}-${x}`}if(m==="month"){const g=new Date(s.getFullYear(),s.getMonth(),1);return`${f(g)}-${x}`}if(m==="year"){const g=new Date(u,0,1);return`${f(g)}-${x}`}if(m==="lastyear"){const g=new Date(u-1,0,1),y=new Date(u-1,11,31);return`${f(g)}-${f(y)}`}if(m==="custom"){const g=new Date(h,0,1),y=h===u?s:new Date(h,11,31),S=L(y)?"Today":f(y);return`${f(g)}-${S}`}return"Select range"};return e.jsxs("div",{className:`relative ${l}`,ref:b,children:[e.jsxs("button",{onClick:()=>n(!c),className:"flex items-center space-x-2 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:N()}),e.jsx(V,{className:`h-4 w-4 text-gray-500 dark:text-gray-400 transition-transform ${c?"rotate-180":""}`})]}),c&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-2 font-medium",children:"Quick Select"}),ne.map(s=>e.jsx("button",{onClick:()=>F(s),className:`w-full text-left px-3 py-2 text-sm rounded-lg transition-colors ${m===s.value?"bg-[#1d3557] text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:s.label},s.value))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-2 font-medium",children:"Select Year"}),e.jsx("div",{className:"flex flex-wrap gap-2 px-2",children:C.map(s=>e.jsx("button",{onClick:()=>w(s),className:`px-3 py-1 text-sm rounded-lg transition-colors ${h===s&&m==="custom"?"bg-[#1d3557] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:s},s))})]})]})]})}const M=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"];function ce({title:a,value:t,icon:l,color:c="blue",trend:n,onClick:m,subtitle:p,clickable:h=!0}){const j={blue:"bg-blue-900/50 text-blue-400",green:"bg-green-900/50 text-green-400",yellow:"bg-yellow-900/50 text-yellow-400",red:"bg-red-900/50 text-red-400",purple:"bg-purple-900/50 text-purple-400"},b=h?"cursor-pointer hover:shadow-lg hover:scale-[1.02] hover:border-blue-500":"";return e.jsxs("div",{onClick:h?m:void 0,className:`stat-card transition-all duration-200 border-2 border-transparent ${b} group`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`p-2 rounded-lg ${j[c]} transition-transform group-hover:scale-110`,children:e.jsx(l,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n!==void 0&&e.jsxs("span",{className:`text-sm font-medium ${n>0?"text-green-600":n<0?"text-red-600":"text-gray-500"}`,children:[n>0?"+":"",n,"%"]}),h&&e.jsx(ae,{className:"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"stat-value",children:t}),e.jsx("p",{className:"stat-label",children:a}),p&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p})]})]})}function T({icon:a,label:t,onClick:l,color:c="blue"}){const n={blue:"bg-blue-900/40 text-blue-300 hover:bg-blue-900/60 border border-blue-800",green:"bg-green-900/40 text-green-300 hover:bg-green-900/60 border border-green-800",purple:"bg-purple-900/40 text-purple-300 hover:bg-purple-900/60 border border-purple-800"};return e.jsxs("button",{onClick:l,className:`flex items-center px-4 py-2 rounded-lg text-sm font-semibold transition-colors shadow-sm ${n[c]}`,children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),t]})}function de(a){if(!a)return"";const t=new Date(a),l=t.getDate().toString().padStart(2,"0"),c=(t.getMonth()+1).toString().padStart(2,"0");return`${l}.${c}`}function xe(a){if(!a)return"";const t=new Date(a),l=t.getDate().toString().padStart(2,"0"),c=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getFullYear();return`${l}.${c}.${n}`}function fe(){const a=I(),{darkMode:t}=q(),[l,c]=i.useState(null),[n,m]=i.useState([]),[p,h]=i.useState([]),[j,b]=i.useState([]),[u,C]=i.useState(null),[F,w]=i.useState(!0),[N,s]=i.useState(null),[x,g]=i.useState({range:"year",year:new Date().getFullYear()}),y=l?.users_trend||0,S=l?.tokens_trend||0,U=l?.cost_trend||0,A=[{id:"users",title:"Total Users",value:l?.total_users||0,icon:k,color:"blue",trend:y,subtitle:"Click to manage users",onClick:()=>a("/users")},{id:"tokens",title:"Tokens Used",value:(l?.total_tokens_used||0).toLocaleString(),icon:H,color:"green",trend:S,subtitle:"Click for detailed breakdown",onClick:()=>a("/transfers")},{id:"cost",title:"Total Cost",value:`$${(l?.total_credits_spent||0).toFixed(2)}`,icon:J,color:"yellow",trend:U,subtitle:"Click for cost analysis",onClick:()=>a("/transfers")},{id:"teams",title:"Active Teams",value:l?.total_teams||0,icon:k,color:"purple",subtitle:"Click to manage teams",onClick:()=>a("/teams")}],[P,K]=i.useState(A);i.useEffect(()=>{K(A)},[l]),i.useEffect(()=>{R()},[x]);async function R(){try{w(!0);const r=x.range==="7d"?7:x.range==="30d"?30:365,[d,z,G,W,X]=await Promise.all([v.getOverview().catch(o=>{throw console.error("getOverview failed:",o),o}),v.getCostTrends(r).catch(o=>{throw console.error("getCostTrends failed:",o),o}),v.getModelUsage().catch(o=>{throw console.error("getModelUsage failed:",o),o}),v.getLeaderboard(10).catch(o=>{throw console.error("getLeaderboard failed:",o),o}),v.getApprovalStats().catch(o=>{throw console.error("getApprovalStats failed:",o),o})]);c(d),m((z||[]).map(o=>({...o,displayDate:de(o.date),fullDate:xe(o.date)}))),h(G||[]),b(W||[]),C(X)}catch(r){console.error("fetchData error:",r),s(r)}finally{w(!1)}}return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):N?e.jsxs("div",{className:"text-center text-red-500 p-8",children:[e.jsxs("p",{children:["Error loading dashboard: ",N.message]}),e.jsx("button",{onClick:R,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(ie,{value:x,onChange:g}),e.jsx(T,{icon:k,label:"Add User",onClick:()=>a("/users"),color:"blue"}),e.jsx(T,{icon:k,label:"Create Team",onClick:()=>a("/teams"),color:"green"}),e.jsx(T,{icon:Z,label:"View Reports",onClick:()=>a("/transfers"),color:"purple"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:P.map(r=>e.jsx(ce,{...r},r.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Token Usage Trend"})}),e.jsx(D,{width:"100%",height:300,children:e.jsxs(E,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorTokens",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:t?"#374151":"#f0f0f0"}),e.jsx(B,{dataKey:"displayDate",tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx(O,{tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"},formatter:r=>[r.toLocaleString(),"Tokens"],labelFormatter:(r,d)=>d?.[0]?.payload?.fullDate?d[0].payload.fullDate:r}),e.jsx(Y,{type:"monotone",dataKey:"tokens",stroke:"#3B82F6",fillOpacity:1,fill:"url(#colorTokens)",name:"Tokens"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Cost Trend"})}),e.jsx(D,{width:"100%",height:300,children:e.jsxs(E,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorCost",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:t?"#374151":"#f0f0f0"}),e.jsx(B,{dataKey:"displayDate",tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx(O,{tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"},tickFormatter:r=>`$${r}`}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"},formatter:r=>[`$${r.toFixed(2)}`,"Cost"],labelFormatter:(r,d)=>d?.[0]?.payload?.fullDate?d[0].payload.fullDate:r}),e.jsx(Y,{type:"monotone",dataKey:"cost",stroke:"#10B981",fillOpacity:1,fill:"url(#colorCost)",name:"Cost"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Model Usage"}),e.jsx(D,{width:"100%",height:250,children:e.jsxs(re,{children:[e.jsx(le,{data:p,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"requests",nameKey:"model",label:({model:r})=>r,children:p.map((r,d)=>e.jsx(oe,{fill:M[d%M.length]},`cell-${d}`))}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"}})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Efficiency Leaderboard"}),e.jsx("button",{onClick:()=>a("/users"),className:"text-xs text-blue-400 hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:j.slice(0,5).map((r,d)=>e.jsxs("div",{className:"flex items-center p-2 rounded-lg hover:bg-gray-700 cursor-pointer transition-colors",onClick:()=>a("/users"),children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 ${d===0?"bg-yellow-900/50 text-yellow-400":d===1?"bg-gray-600 text-gray-200":d===2?"bg-orange-900/50 text-orange-400":"bg-gray-700 text-gray-400"}`,children:d+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-white truncate",children:r.name})}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:[(r.efficiency_score*100).toFixed(0),"%"]})]},r.user_id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Approval Statistics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Pending"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:u?.total_pending||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Approved (7d)"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:u?.total_approved_7d||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Denied (7d)"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:u?.total_rejected_7d||0})]}),e.jsx("div",{className:"pt-3 border-t border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Avg. approval time: ",e.jsxs("span",{className:"font-semibold text-white",children:[u?.avg_approval_time_hours?.toFixed(1)||0,"h"]})]})})]})]})]})]})}export{fe as default};
