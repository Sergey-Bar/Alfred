import{j as e,a as N}from"./index-DmO1ypIk.js";import{r as i}from"./vendor-CoKE50sv.js";import{W as v,v as k,h as L,a2 as w,X as C,m as W,a3 as P}from"./icons-UwgmH0ZI.js";function E({wallet:s,onClose:n,onSave:p}){const[r,c]=i.useState(s.hardLimit||s.total),[l,f]=i.useState(s.softLimit||Math.floor(s.total*.8)),[m,g]=i.useState(s.alertThresholds||[50,80,95]),[o,x]=i.useState(s.circuitBreaker??!0),[h,u]=i.useState(!1),a=async()=>{u(!0);try{await N.fetchJson(`/wallets/${s.id}/limits`,{method:"PUT",body:JSON.stringify({hard_limit:r,soft_limit:l,alert_thresholds:m,circuit_breaker:o})})}catch{}p({...s,hardLimit:r,softLimit:l,alertThresholds:m,circuitBreaker:o}),u(!1),n()};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:n,children:e.jsx("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Configure Limits — ",s.name]}),e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4 p-3 rounded-lg",style:{background:"var(--color-primary-100)"},children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Current Usage"}),e.jsxs("span",{className:"font-medium",children:[s.used.toLocaleString()," / ",s.total.toLocaleString()]})]}),e.jsx("div",{className:"w-full h-2 rounded-full",style:{background:"var(--color-primary-200)"},children:e.jsx("div",{className:"h-full rounded-full bg-blue-500",style:{width:`${Math.min(s.used/s.total*100,100)}%`}})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Hard Limit (blocks all requests)"}),e.jsx("input",{type:"number",className:"input w-full",value:r,onChange:t=>c(Number(t.target.value))}),r<s.used&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Hard limit below current usage — requests will be blocked immediately"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Soft Limit (triggers alerts)"}),e.jsx("input",{type:"number",className:"input w-full",value:l,onChange:t=>f(Number(t.target.value))}),l>=r&&e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Soft limit should be below hard limit"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Alert Thresholds (%)"}),e.jsx("div",{className:"flex gap-2",children:m.map((t,j)=>e.jsx("input",{type:"number",min:0,max:100,className:"input w-20 text-center",value:t,onChange:y=>{const b=[...m];b[j]=Number(y.target.value),g(b)}},j))}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-primary-400)"},children:"Percent of hard limit at which to send alerts"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>x(t.target.checked),className:"rounded text-blue-600"}),e.jsx("span",{className:"text-sm",children:"Enable circuit breaker (auto-suspend on spend spike)"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6 pt-4 border-t",children:[e.jsx("button",{onClick:n,className:"btn",children:"Cancel"}),e.jsxs("button",{onClick:a,disabled:h,className:"btn btn-primary flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"})," ",h?"Saving...":"Save Limits"]})]})]})})})}function S({wallet:s,type:n,onEditLimits:p}){const r=s.total>0?s.used/s.total*100:0,c=r>=80,l=r>=95;return e.jsxs("div",{className:"card hover-lift",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${l?"bg-red-100":c?"bg-yellow-100":"bg-blue-100"}`,children:e.jsx(v,{className:`w-5 h-5 ${l?"text-red-600":c?"text-yellow-600":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx("span",{className:"text-xs",style:{color:"var(--color-primary-500)"},children:n})]})]}),e.jsx("span",{className:`badge ${l?"badge-red":c?"badge-yellow":"badge-green"}`,children:l?"Critical":c?"Warning":"Healthy"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsxs("span",{style:{color:"var(--color-primary-500)"},children:["Used: ",s.used.toLocaleString()," credits"]}),e.jsxs("span",{className:"font-medium",children:[r.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full h-2 rounded-full",style:{background:"var(--color-primary-200)"},children:e.jsx("div",{className:`h-full rounded-full transition-all ${l?"bg-red-500":c?"bg-yellow-500":"bg-blue-500"}`,style:{width:`${Math.min(r,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-primary-400)"},children:[e.jsx("span",{children:"0"}),e.jsxs("span",{children:[s.total.toLocaleString()," credits"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 rounded-md",style:{background:"var(--color-primary-100)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-500)"},children:"Hard Limit"}),e.jsx("p",{className:"font-semibold",children:s.hardLimit?.toLocaleString()||s.total.toLocaleString()})]}),e.jsxs("div",{className:"p-2 rounded-md",style:{background:"var(--color-primary-100)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-500)"},children:"Soft Limit"}),e.jsx("p",{className:"font-semibold",children:s.softLimit?.toLocaleString()||Math.floor(s.total*.8).toLocaleString()})]})]}),e.jsxs("button",{onClick:()=>p(s),className:"mt-3 w-full btn btn-sm flex items-center justify-center gap-1 text-xs",children:[e.jsx(w,{className:"w-3 h-3"})," Configure Limits"]})]})}function A(){const[s,n]=i.useState([]),[p,r]=i.useState([]),[c,l]=i.useState(""),[f,m]=i.useState(!0),[g,o]=i.useState(null);i.useEffect(()=>{async function a(){try{const[t,j]=await Promise.all([N.get("/users").catch(()=>({data:[]})),N.get("/teams").catch(()=>({data:[]}))]),y=(t.data||[]).map(d=>({id:d.id,name:d.name||d.email,type:"personal",total:parseFloat(d.personal_quota||1e3),used:parseFloat(d.used_tokens||0)})),b=(j.data||[]).map(d=>({id:d.id,name:d.name,type:"team",total:parseFloat(d.common_pool||1e4),used:parseFloat(d.used_pool||0)}));n([...b,...y])}catch{n(T())}m(!1)}a()},[]);const x=s.filter(a=>a.name.toLowerCase().includes(c.toLowerCase())),h=x.filter(a=>a.type==="team"),u=x.filter(a=>a.type==="personal");return f?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"skeleton h-8 w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[...Array(6)].map((a,t)=>e.jsx("div",{className:"skeleton h-48 rounded-xl"},t))})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"page-header flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-6 h-6",style:{color:"var(--color-accent-600)"}}),"Wallets & Budget"]}),e.jsx("p",{className:"subtitle",children:"Manage credit allocations across users and teams"})]}),e.jsxs("button",{className:"btn btn-primary",children:[e.jsx(k,{className:"w-4 h-4 mr-2"})," Allocate Credits"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4",style:{color:"var(--color-primary-400)"}}),e.jsx("input",{type:"text",placeholder:"Search wallets...",value:c,onChange:a=>l(a.target.value),className:"input pl-10",style:{maxWidth:400}})]}),h.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Team Pools"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(a=>e.jsx(S,{wallet:a,type:"Team Pool",onEditLimits:o},a.id))})]}),u.length>0&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Personal Wallets"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(a=>e.jsx(S,{wallet:a,type:"Personal",onEditLimits:o},a.id))})]}),x.length===0&&e.jsxs("div",{className:"empty-state",children:[e.jsx(v,{className:"icon"}),e.jsx("h3",{children:"No wallets found"}),e.jsx("p",{children:"Try adjusting your search or create a new wallet allocation."})]}),g&&e.jsx(E,{wallet:g,onClose:()=>o(null),onSave:a=>n(s.map(t=>t.id===a.id?{...t,...a}:t))})]})}function T(){return[{id:"1",name:"Engineering",type:"team",total:5e4,used:32e3},{id:"2",name:"Product",type:"team",total:25e3,used:18500},{id:"3",name:"Research",type:"team",total:15e3,used:14200},{id:"4",name:"Alice Chen",type:"personal",total:2e3,used:1200},{id:"5",name:"Bob Smith",type:"personal",total:2e3,used:400},{id:"6",name:"Carol Davis",type:"personal",total:1500,used:1480}]}export{A as default};
