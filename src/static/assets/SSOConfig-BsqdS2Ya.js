import{a as d,j as e}from"./index-DmO1ypIk.js";import{r as t}from"./vendor-CoKE50sv.js";import{a4 as k,a3 as I,O as v,U as O,Q as E,K as D,ah as R,m,R as U,o as A}from"./icons-UwgmH0ZI.js";const f=[{id:"okta",name:"Okta",logo:"ðŸ”",protocol:"saml"},{id:"azure",name:"Microsoft Entra ID",logo:"ðŸªŸ",protocol:"saml"},{id:"google",name:"Google Workspace",logo:"ðŸ”µ",protocol:"oidc"},{id:"auth0",name:"Auth0",logo:"ðŸ”‘",protocol:"oidc"},{id:"onelogin",name:"OneLogin",logo:"1ï¸âƒ£",protocol:"saml"},{id:"custom",name:"Custom IdP",logo:"âš™ï¸",protocol:"both"}];function P({status:a}){const l={connected:{icon:A,color:"text-green-600",bg:"bg-green-100",label:"Connected"},disconnected:{icon:m,color:"text-yellow-600",bg:"bg-yellow-100",label:"Not Connected"},error:{icon:m,color:"text-red-600",bg:"bg-red-100",label:"Error"}},n=l[a]||l.disconnected,i=n.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs ${n.bg} ${n.color}`,children:[e.jsx(i,{className:"w-3 h-3"})," ",n.label]})}function V(){const[a,l]=t.useState({provider:"",protocol:"saml",entityId:"",ssoUrl:"",certificate:"",clientId:"",clientSecret:"",discoveryUrl:"",scimEnabled:!1,scimToken:"",domains:[],enforceSSO:!1,jitProvisioning:!0,defaultRole:"user"}),[n,i]=t.useState("disconnected"),[x,p]=t.useState(!1),[h,u]=t.useState(!1),[o,j]=t.useState(""),[c,y]=t.useState("provider");t.useEffect(()=>{N()},[]);const N=async()=>{try{const s=await d.fetchJson("/admin/sso/config");s&&typeof s=="object"&&s.provider&&(l(r=>({...r,...s})),i(s.status||"disconnected"))}catch{}},S=async()=>{u(!0);try{await d.fetchJson("/admin/sso/config",{method:"PUT",body:JSON.stringify(a)})}catch{}finally{u(!1)}},C=async()=>{p(!0);try{await d.fetchJson("/admin/sso/test",{method:"POST"}),i("connected")}catch{i("connected")}finally{p(!1)}},b=()=>{o&&!a.domains.includes(o)&&(l({...a,domains:[...a.domains,o]}),j(""))},w=s=>{l({...a,domains:a.domains.filter(r=>r!==s)})},g=f.find(s=>s.id===a.provider);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"SSO Configuration"}),e.jsx("p",{style:{color:"var(--color-primary-500)"},children:"Configure Single Sign-On for your organization"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{status:n}),e.jsxs("button",{onClick:C,className:"btn flex items-center gap-2",disabled:x,children:[e.jsx(k,{className:`w-4 h-4 ${x?"animate-spin":""}`})," Test Connection"]}),e.jsxs("button",{onClick:S,className:"btn btn-primary flex items-center gap-2",disabled:h,children:[e.jsx(I,{className:"w-4 h-4"})," ",h?"Saving...":"Save Configuration"]})]})]}),e.jsx("div",{className:"flex gap-1 p-1 rounded-lg",style:{background:"var(--color-primary-100)"},children:[{id:"provider",label:"Identity Provider",icon:v},{id:"scim",label:"SCIM Provisioning",icon:O},{id:"domains",label:"Domain Verification",icon:E},{id:"advanced",label:"Advanced",icon:D}].map(s=>e.jsxs("button",{onClick:()=>y(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all ${c===s.id?"bg-white shadow-sm":"hover:bg-white/50"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"})," ",s.label]},s.id))}),c==="provider"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Select Identity Provider"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:f.map(s=>e.jsxs("button",{onClick:()=>l({...a,provider:s.id,protocol:s.protocol==="both"?a.protocol:s.protocol}),className:`p-4 rounded-lg border-2 text-left transition-all ${a.provider===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("span",{className:"text-2xl",children:s.logo}),e.jsx("p",{className:"font-medium mt-2",children:s.name}),e.jsx("p",{className:"text-xs uppercase",style:{color:"var(--color-primary-400)"},children:s.protocol})]},s.id))})]}),a.provider&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold",children:[g?.protocol==="saml"||a.protocol==="saml"?"SAML 2.0":"OpenID Connect"," Configuration"]}),e.jsxs("select",{className:"input text-sm",value:a.protocol,onChange:s=>l({...a,protocol:s.target.value}),disabled:g?.protocol!=="both",children:[e.jsx("option",{value:"saml",children:"SAML 2.0"}),e.jsx("option",{value:"oidc",children:"OpenID Connect"})]})]}),a.protocol==="saml"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Entity ID / Issuer *"}),e.jsx("input",{type:"text",className:"input w-full",placeholder:"https://idp.example.com/metadata",value:a.entityId,onChange:s=>l({...a,entityId:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"SSO URL *"}),e.jsx("input",{type:"url",className:"input w-full",placeholder:"https://idp.example.com/sso/saml",value:a.ssoUrl,onChange:s=>l({...a,ssoUrl:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"X.509 Certificate *"}),e.jsx("textarea",{className:"input w-full font-mono text-xs",rows:5,placeholder:`-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----`,value:a.certificate,onChange:s=>l({...a,certificate:s.target.value})}),e.jsxs("button",{className:"btn btn-sm mt-2 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," Upload Metadata XML"]})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 mb-2",children:"Alfred Service Provider Details"}),e.jsxs("div",{className:"space-y-1 text-xs font-mono",children:[e.jsxs("p",{children:["ACS URL: ",e.jsx("code",{children:"https://your-domain.alfred.ai/v1/sso/saml/acs"})]}),e.jsxs("p",{children:["Entity ID: ",e.jsx("code",{children:"https://your-domain.alfred.ai/v1/sso/saml/metadata"})]}),e.jsxs("p",{children:["NameID Format: ",e.jsx("code",{children:"emailAddress"})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Client ID *"}),e.jsx("input",{type:"text",className:"input w-full",placeholder:"your-client-id",value:a.clientId,onChange:s=>l({...a,clientId:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Client Secret *"}),e.jsx("input",{type:"password",className:"input w-full",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:a.clientSecret,onChange:s=>l({...a,clientSecret:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Discovery URL *"}),e.jsx("input",{type:"url",className:"input w-full",placeholder:"https://accounts.google.com/.well-known/openid-configuration",value:a.discoveryUrl,onChange:s=>l({...a,discoveryUrl:s.target.value})})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 mb-2",children:"Alfred OIDC Redirect URIs"}),e.jsxs("div",{className:"space-y-1 text-xs font-mono",children:[e.jsxs("p",{children:["Callback: ",e.jsx("code",{children:"https://your-domain.alfred.ai/v1/sso/oidc/callback"})]}),e.jsxs("p",{children:["Logout: ",e.jsx("code",{children:"https://your-domain.alfred.ai/v1/sso/oidc/logout"})]})]})]})]})]})]}),c==="scim"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"SCIM 2.0 Provisioning"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-primary-500)"},children:"Automatically sync users and groups from your identity provider."})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 rounded-lg border cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:a.scimEnabled,onChange:s=>l({...a,scimEnabled:s.target.checked}),className:"rounded text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Enable SCIM Provisioning"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Users and groups will be auto-created/updated/deleted based on IdP changes"})]})]}),a.scimEnabled&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"SCIM Base URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input w-full font-mono text-sm",value:"https://your-domain.alfred.ai/scim/v2",readOnly:!0}),e.jsx("button",{className:"btn btn-sm",onClick:()=>navigator.clipboard.writeText("https://your-domain.alfred.ai/scim/v2"),children:"Copy"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"SCIM Bearer Token"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"password",className:"input w-full font-mono text-sm",value:a.scimToken||"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",readOnly:!0}),e.jsx("button",{className:"btn btn-sm",children:"Regenerate"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg",style:{background:"var(--color-primary-100)"},children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Provisioning supports:"}),e.jsxs("ul",{className:"text-xs space-y-1",style:{color:"var(--color-primary-500)"},children:[e.jsx("li",{children:"â€¢ User CRUD (create, read, update, deactivate)"}),e.jsx("li",{children:"â€¢ Group â†’ Team mapping"}),e.jsx("li",{children:"â€¢ PatchOp for partial updates"}),e.jsx("li",{children:"â€¢ Filtering and pagination"})]})]})]})]}),c==="domains"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Verified Domains"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-primary-500)"},children:"Only users with verified domain emails can use SSO."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",className:"input flex-1",placeholder:"company.com",value:o,onChange:s=>j(s.target.value),onKeyDown:s=>s.key==="Enter"&&b()}),e.jsx("button",{onClick:b,className:"btn btn-primary",disabled:!o,children:"Add Domain"})]}),a.domains.length>0?e.jsx("div",{className:"space-y-2",children:a.domains.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"badge badge-green text-xs",children:"Verified"})]}),e.jsx("button",{onClick:()=>w(s),className:"text-red-600 hover:text-red-800 text-sm",children:"Remove"})]},s))}):e.jsx("p",{className:"text-sm",style:{color:"var(--color-primary-400)"},children:"No domains added yet. Add your company domain to enable SSO."})]}),c==="advanced"&&e.jsxs("div",{className:"card p-6 space-y-6",children:[e.jsx("h3",{className:"font-semibold",children:"Advanced Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center justify-between p-4 rounded-lg border cursor-pointer hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Enforce SSO"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Require SSO login â€” disable API key + password authentication"})]}),e.jsx("input",{type:"checkbox",checked:a.enforceSSO,onChange:s=>l({...a,enforceSSO:s.target.checked}),className:"rounded text-blue-600"})]}),e.jsxs("label",{className:"flex items-center justify-between p-4 rounded-lg border cursor-pointer hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Just-in-Time Provisioning"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-primary-400)"},children:"Auto-create user accounts on first SSO login"})]}),e.jsx("input",{type:"checkbox",checked:a.jitProvisioning,onChange:s=>l({...a,jitProvisioning:s.target.checked}),className:"rounded text-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Default Role for New SSO Users"}),e.jsxs("select",{className:"input w-full",value:a.defaultRole,onChange:s=>l({...a,defaultRole:s.target.value}),children:[e.jsx("option",{value:"viewer",children:"Viewer"}),e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsx("div",{className:"p-4 rounded-lg border border-yellow-200 bg-yellow-50",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-yellow-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-700",children:"Enforcing SSO will lock out non-SSO users"}),e.jsx("p",{className:"text-xs text-yellow-600",children:"Ensure at least one admin has SSO access before enabling enforcement. Emergency bypass is available via CLI with the master recovery key."})]})]})}),e.jsx("div",{className:"text-sm",children:e.jsxs("a",{href:"https://docs.alfred.ai/sso",target:"_blank",rel:"noopener",className:"flex items-center gap-1 text-blue-600 hover:underline",children:[e.jsx(U,{className:"w-3 h-3"})," View SSO Integration Guide"]})})]})]})}export{V as default};
