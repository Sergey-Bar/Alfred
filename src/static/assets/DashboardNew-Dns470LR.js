import{j as e,a as C,u as Z}from"./index-DmO1ypIk.js";import{r as n,u as J}from"./vendor-CoKE50sv.js";import{p as ee,j as te,T as I,q as se,r as M,Z as P,D as R,U as S,s as ae,t as re,o as le,n as ne,u as oe}from"./icons-UwgmH0ZI.js";import{R as D,A as B,C as O,X as L,Y,T as $,a as q,P as ie,b as ce,c as de}from"./charts-DbFJi66O.js";const xe=[{label:"Last 7 days",value:"7d",days:7},{label:"Last 30 days",value:"30d",days:30},{label:"This month",value:"month",days:0},{label:"This year",value:"year",days:0},{label:"Last year",value:"lastyear",days:0}];function v(s){const t=s.getDate().toString().padStart(2,"0"),r=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getFullYear().toString().slice(-2);return`${t}.${r}.${i}`}function U(s){const t=new Date;return s.getDate()===t.getDate()&&s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()}function me({value:s,onChange:t,className:r=""}){const[i,o]=n.useState(!1),[u,g]=n.useState(s||"year"),[d,h]=n.useState(new Date().getFullYear()),c=n.useRef(null),x=new Date().getFullYear(),y=Array.from({length:5},(a,f)=>x-f);n.useEffect(()=>{function a(f){c.current&&!c.current.contains(f.target)&&o(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const j=a=>{g(a.value),t&&t({range:a.value,days:a.days,year:a.value==="lastyear"?x-1:x}),o(!1)},w=a=>{h(a),g("custom"),t&&t({range:"custom",year:a}),o(!1)},N=()=>{const a=new Date,f=U(a)?"Today":v(a);if(u==="7d"){const b=new Date(a.getTime()-6048e5);return`${v(b)}-${f}`}if(u==="30d"){const b=new Date(a.getTime()-2592e6);return`${v(b)}-${f}`}if(u==="month"){const b=new Date(a.getFullYear(),a.getMonth(),1);return`${v(b)}-${f}`}if(u==="year"){const b=new Date(x,0,1);return`${v(b)}-${f}`}if(u==="lastyear"){const b=new Date(x-1,0,1),k=new Date(x-1,11,31);return`${v(b)}-${v(k)}`}if(u==="custom"){const b=new Date(d,0,1),k=d===x?a:new Date(d,11,31),F=U(k)?"Today":v(k);return`${v(b)}-${F}`}return"Select range"};return e.jsxs("div",{className:`relative ${r}`,ref:c,children:[e.jsxs("button",{onClick:()=>o(!i),className:"flex items-center space-x-2 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm",children:[e.jsx(ee,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:N()}),e.jsx(te,{className:`h-4 w-4 text-gray-500 dark:text-gray-400 transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50",children:[e.jsxs("div",{className:"p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-2 font-medium",children:"Quick Select"}),xe.map(a=>e.jsx("button",{onClick:()=>j(a),className:`w-full text-left px-3 py-2 text-sm rounded-lg transition-colors ${u===a.value?"bg-[#1d3557] text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:a.label},a.value))]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 px-2 mb-2 font-medium",children:"Select Year"}),e.jsx("div",{className:"flex flex-wrap gap-2 px-2",children:y.map(a=>e.jsx("button",{onClick:()=>w(a),className:`px-3 py-1 text-sm rounded-lg transition-colors ${d===a&&u==="custom"?"bg-[#1d3557] text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:a},a))})]})]})]})}function T({value:s,prefix:t="",suffix:r="",decimals:i=2}){const[o,u]=n.useState(s),g=n.useRef(s);return n.useEffect(()=>{const d=g.current,h=s,c=h-d;if(Math.abs(c)<.01){u(h);return}let x;const y=800,j=performance.now(),w=N=>{const a=Math.min((N-j)/y,1),f=a<.5?2*a*a:-1+(4-2*a)*a;u(d+c*f),a<1&&(x=requestAnimationFrame(w))};return x=requestAnimationFrame(w),g.current=h,()=>cancelAnimationFrame(x)},[s]),e.jsxs("span",{children:[t,o.toFixed(i),r]})}function ue(){const[s,t]=n.useState({totalSpent:147832.5,ratePerMinute:8.24,ratePerHour:494.4,trend:"up",trendPercent:3.2,activeRequests:42,cacheHitRate:34.2}),[r,i]=n.useState(!1);n.useEffect(()=>{const g=async()=>{try{const h=await C.fetchJson("/dashboard/overview");h?.total_credits_spent&&(t(c=>{const x=h.total_credits_spent,y=x-c.totalSpent,j=y>0?y/10*60:c.ratePerMinute;return{...c,totalSpent:x,ratePerMinute:j>0?j:c.ratePerMinute,ratePerHour:(j>0?j:c.ratePerMinute)*60,trend:y>0?"up":y<0?"down":"stable",trendPercent:c.totalSpent>0?Math.abs(y/c.totalSpent*100):0,activeRequests:h.total_requests?Math.round(h.total_requests/43800):c.activeRequests,cacheHitRate:h.cache_hit_rate?h.cache_hit_rate*100:c.cacheHitRate}}),i(!0),setTimeout(()=>i(!1),600))}catch{}};g();const d=setInterval(g,1e4);return()=>clearInterval(d)},[]),n.useEffect(()=>{const g=setInterval(()=>{t(d=>({...d,totalSpent:d.totalSpent+d.ratePerMinute/60}))},1e3);return()=>clearInterval(g)},[]);const o=s.trend==="up"?I:s.trend==="down"?se:M,u=s.trend==="up"?"text-red-400":s.trend==="down"?"text-green-400":"text-gray-400";return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-white flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-yellow-400"}),"Live Spend Ticker"]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-green-400":"bg-green-600"} transition-colors`,title:"Live polling"})]}),e.jsxs("div",{className:"text-center py-3",children:[e.jsx("div",{className:"text-3xl font-mono font-bold text-white",children:e.jsx(T,{value:s.totalSpent,prefix:"$",decimals:2})}),e.jsxs("div",{className:`flex items-center justify-center gap-1 mt-1 text-xs ${u}`,children:[e.jsx(o,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.trendPercent.toFixed(2),"% from last poll"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-blue-900/30",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-300",children:[e.jsx(R,{className:"w-3 h-3"})," Per Minute"]}),e.jsxs("p",{className:"font-mono font-semibold text-blue-100 text-sm mt-0.5",children:["$",e.jsx(T,{value:s.ratePerMinute,decimals:2})]})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-purple-900/30",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-300",children:[e.jsx(R,{className:"w-3 h-3"})," Per Hour"]}),e.jsxs("p",{className:"font-mono font-semibold text-purple-100 text-sm mt-0.5",children:["$",e.jsx(T,{value:s.ratePerHour,decimals:0})]})]})]}),e.jsxs("div",{className:"flex justify-between mt-3 pt-3 border-t border-gray-700 text-xs text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3 text-green-400"})," ",s.activeRequests," req/s"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3 text-yellow-400"})," ",s.cacheHitRate.toFixed(1),"% cache hit"]})]})]})}const H=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"];function ge({title:s,value:t,icon:r,color:i="blue",trend:o,onClick:u,subtitle:g,clickable:d=!0}){const h={blue:"bg-blue-900/50 text-blue-400",green:"bg-green-900/50 text-green-400",yellow:"bg-yellow-900/50 text-yellow-400",red:"bg-red-900/50 text-red-400",purple:"bg-purple-900/50 text-purple-400"},c=d?"cursor-pointer hover:shadow-lg hover:scale-[1.02] hover:border-blue-500":"";return e.jsxs("div",{onClick:d?u:void 0,className:`stat-card transition-all duration-200 border-2 border-transparent ${c} group`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`p-2 rounded-lg ${h[i]} transition-transform group-hover:scale-110`,children:e.jsx(r,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[o!==void 0&&e.jsxs("span",{className:`text-sm font-medium ${o>0?"text-green-600":o<0?"text-red-600":"text-gray-500"}`,children:[o>0?"+":"",o,"%"]}),d&&e.jsx(oe,{className:"h-4 w-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"stat-value",children:t}),e.jsx("p",{className:"stat-label",children:s}),g&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:g})]})]})}function A({icon:s,label:t,onClick:r,color:i="blue"}){const o={blue:"bg-blue-900/40 text-blue-300 hover:bg-blue-900/60 border border-blue-800",green:"bg-green-900/40 text-green-300 hover:bg-green-900/60 border border-green-800",purple:"bg-purple-900/40 text-purple-300 hover:bg-purple-900/60 border border-purple-800"};return e.jsxs("button",{onClick:r,className:`flex items-center px-4 py-2 rounded-lg text-sm font-semibold transition-colors shadow-sm ${o[i]}`,children:[e.jsx(s,{className:"h-4 w-4 mr-2"}),t]})}function he(s){if(!s)return"";const t=new Date(s),r=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0");return`${r}.${i}`}function fe(s){if(!s)return"";const t=new Date(s),r=t.getDate().toString().padStart(2,"0"),i=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getFullYear();return`${r}.${i}.${o}`}function ve(){const s=J(),{darkMode:t}=Z(),[r,i]=n.useState(null),[o,u]=n.useState([]),[g,d]=n.useState([]),[h,c]=n.useState([]),[x,y]=n.useState(null),[j,w]=n.useState(!0),[N,a]=n.useState(null),[f,b]=n.useState({range:"year",year:new Date().getFullYear()}),k=r?.users_trend||0,F=r?.tokens_trend||0,K=r?.cost_trend||0,_=[{id:"users",title:"Total Users",value:r?.total_users||0,icon:S,color:"blue",trend:k,subtitle:"Click to manage users",onClick:()=>s("/users")},{id:"tokens",title:"Tokens Used",value:(r?.total_tokens_used||0).toLocaleString(),icon:ae,color:"green",trend:F,subtitle:"Click for detailed breakdown",onClick:()=>s("/transfers")},{id:"cost",title:"Total Cost",value:`$${(r?.total_credits_spent||0).toFixed(2)}`,icon:R,color:"yellow",trend:K,subtitle:"Click for cost analysis",onClick:()=>s("/transfers")},{id:"teams",title:"Active Teams",value:r?.total_teams||0,icon:S,color:"purple",subtitle:"Click to manage teams",onClick:()=>s("/teams")}],[z,G]=n.useState(_);n.useEffect(()=>{G(_)},[r]),n.useEffect(()=>{E()},[f]);async function E(){try{w(!0);const l=f.range==="7d"?7:f.range==="30d"?30:365,[p,W,X,Q,V]=await Promise.all([C.getOverview().catch(m=>{throw console.error("getOverview failed:",m),m}),C.getCostTrends(l).catch(m=>{throw console.error("getCostTrends failed:",m),m}),C.getModelUsage().catch(m=>{throw console.error("getModelUsage failed:",m),m}),C.getLeaderboard(10).catch(m=>{throw console.error("getLeaderboard failed:",m),m}),C.getApprovalStats().catch(m=>{throw console.error("getApprovalStats failed:",m),m})]);i(p),u((W||[]).map(m=>({...m,displayDate:he(m.date),fullDate:fe(m.date)}))),d(X||[]),c(Q||[]),y(V)}catch(l){console.error("fetchData error:",l),a(l)}finally{w(!1)}}return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):N?e.jsxs("div",{className:"text-center text-red-500 p-8",children:[e.jsxs("p",{children:["Error loading dashboard: ",N.message]}),e.jsx("button",{onClick:E,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Dashboard"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(me,{value:f,onChange:b}),e.jsx(A,{icon:S,label:"Add User",onClick:()=>s("/users"),color:"blue"}),e.jsx(A,{icon:S,label:"Create Team",onClick:()=>s("/teams"),color:"green"}),e.jsx(A,{icon:I,label:"View Reports",onClick:()=>s("/transfers"),color:"purple"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:z.map(l=>e.jsx(ge,{...l},l.id))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsx(ue,{}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Token Usage Trend"})}),e.jsx(D,{width:"100%",height:300,children:e.jsxs(B,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorTokens",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),e.jsx(O,{strokeDasharray:"3 3",stroke:t?"#374151":"#f0f0f0"}),e.jsx(L,{dataKey:"displayDate",tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx(Y,{tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"},formatter:l=>[l.toLocaleString(),"Tokens"],labelFormatter:(l,p)=>p?.[0]?.payload?.fullDate?p[0].payload.fullDate:l}),e.jsx(q,{type:"monotone",dataKey:"tokens",stroke:"#3B82F6",fillOpacity:1,fill:"url(#colorTokens)",name:"Tokens"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Cost Trend"})}),e.jsx(D,{width:"100%",height:300,children:e.jsxs(B,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorCost",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(O,{strokeDasharray:"3 3",stroke:t?"#374151":"#f0f0f0"}),e.jsx(L,{dataKey:"displayDate",tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"}}),e.jsx(Y,{tick:{fontSize:12,fill:t?"#9CA3AF":"#6B7280"},tickFormatter:l=>`$${l}`}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"},formatter:l=>[`$${l.toFixed(2)}`,"Cost"],labelFormatter:(l,p)=>p?.[0]?.payload?.fullDate?p[0].payload.fullDate:l}),e.jsx(q,{type:"monotone",dataKey:"cost",stroke:"#10B981",fillOpacity:1,fill:"url(#colorCost)",name:"Cost"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Model Usage"}),e.jsx(D,{width:"100%",height:250,children:e.jsxs(ie,{children:[e.jsx(ce,{data:g,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"requests",nameKey:"model",label:({model:l})=>l,children:g.map((l,p)=>e.jsx(de,{fill:H[p%H.length]},`cell-${p}`))}),e.jsx($,{contentStyle:{backgroundColor:t?"#1F2937":"#ffffff",border:`1px solid ${t?"#374151":"#E5E7EB"}`,borderRadius:"8px",color:t?"#F3F4F6":"#111827"},labelStyle:{color:t?"#F3F4F6":"#111827",fontWeight:600},itemStyle:{color:t?"#9CA3AF":"#4B5563"}})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Efficiency Leaderboard"}),e.jsx("button",{onClick:()=>s("/users"),className:"text-xs text-blue-400 hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:h.slice(0,5).map((l,p)=>e.jsxs("div",{className:"flex items-center p-2 rounded-lg hover:bg-gray-700 cursor-pointer transition-colors",onClick:()=>s("/users"),children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold mr-3 ${p===0?"bg-yellow-900/50 text-yellow-400":p===1?"bg-gray-600 text-gray-200":p===2?"bg-orange-900/50 text-orange-400":"bg-gray-700 text-gray-400"}`,children:p+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-white truncate",children:l.name})}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:[(l.efficiency_score*100).toFixed(0),"%"]})]},l.user_id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Approval Statistics"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Pending"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:x?.total_pending||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Approved (7d)"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:x?.total_approved_7d||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Denied (7d)"})]}),e.jsx("span",{className:"text-lg font-semibold text-white",children:x?.total_rejected_7d||0})]}),e.jsx("div",{className:"pt-3 border-t border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-400",children:["Avg. approval time: ",e.jsxs("span",{className:"font-semibold text-white",children:[x?.avg_approval_time_hours?.toFixed(1)||0,"h"]})]})})]})]})]})]})}export{ve as default};
